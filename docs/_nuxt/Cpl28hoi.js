import{G as Ft}from"./DWlMGZOe.js";var $t={976:(ct,st,$)=>{$.d(st,{AnnotationLayer:()=>ut,FreeTextAnnotationElement:()=>B,InkAnnotationElement:()=>tt,StampAnnotationElement:()=>dt});var w=$(292),z=$(419),_=$(792);function V(et){return Math.floor(Math.max(0,Math.min(1,et))*255).toString(16).padStart(2,"0")}function P(et){return Math.max(0,Math.min(255,255*et))}class C{static CMYK_G([m,h,e,n]){return["G",1-Math.min(1,.3*m+.59*e+.11*h+n)]}static G_CMYK([m]){return["CMYK",0,0,0,1-m]}static G_RGB([m]){return["RGB",m,m,m]}static G_rgb([m]){return m=P(m),[m,m,m]}static G_HTML([m]){const h=V(m);return`#${h}${h}${h}`}static RGB_G([m,h,e]){return["G",.3*m+.59*h+.11*e]}static RGB_rgb(m){return m.map(P)}static RGB_HTML(m){return`#${m.map(V).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([m,h,e,n]){return["RGB",1-Math.min(1,m+n),1-Math.min(1,e+n),1-Math.min(1,h+n)]}static CMYK_rgb([m,h,e,n]){return[P(1-Math.min(1,m+n)),P(1-Math.min(1,e+n)),P(1-Math.min(1,h+n))]}static CMYK_HTML(m){const h=this.CMYK_RGB(m).slice(1);return this.RGB_HTML(h)}static RGB_CMYK([m,h,e]){const n=1-m,f=1-h,o=1-e,a=Math.min(n,f,o);return["CMYK",n,f,o,a]}}var x=$(284);const v=1e3,r=9,d=new WeakSet;function l(et){return{width:et[2]-et[0],height:et[3]-et[1]}}class b{static create(m){switch(m.data.annotationType){case w.AnnotationType.LINK:return new g(m);case w.AnnotationType.TEXT:return new t(m);case w.AnnotationType.WIDGET:switch(m.data.fieldType){case"Tx":return new c(m);case"Btn":return m.data.radioButton?new S(m):m.data.checkBox?new y(m):new L(m);case"Ch":return new M(m);case"Sig":return new p(m)}return new i(m);case w.AnnotationType.POPUP:return new O(m);case w.AnnotationType.FREETEXT:return new B(m);case w.AnnotationType.LINE:return new q(m);case w.AnnotationType.SQUARE:return new nt(m);case w.AnnotationType.CIRCLE:return new j(m);case w.AnnotationType.POLYLINE:return new H(m);case w.AnnotationType.CARET:return new Y(m);case w.AnnotationType.INK:return new tt(m);case w.AnnotationType.POLYGON:return new G(m);case w.AnnotationType.HIGHLIGHT:return new Z(m);case w.AnnotationType.UNDERLINE:return new at(m);case w.AnnotationType.SQUIGGLY:return new lt(m);case w.AnnotationType.STRIKEOUT:return new pt(m);case w.AnnotationType.STAMP:return new dt(m);case w.AnnotationType.FILEATTACHMENT:return new ot(m);default:return new s(m)}}}class s{#t=null;#e=!1;constructor(m,{isRenderable:h=!1,ignoreBorder:e=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=h,this.data=m.data,this.layer=m.layer,this.linkService=m.linkService,this.downloadManager=m.downloadManager,this.imageResourcesPath=m.imageResourcesPath,this.renderForms=m.renderForms,this.svgFactory=m.svgFactory,this.annotationStorage=m.annotationStorage,this.enableScripting=m.enableScripting,this.hasJSActions=m.hasJSActions,this._fieldObjects=m.fieldObjects,this.parent=m.parent,h&&(this.container=this._createContainer(e)),n&&this._createQuadrilaterals()}static _hasPopupData({titleObj:m,contentsObj:h,richText:e}){return!!(m?.str||h?.str||e?.str)}get hasPopupData(){return s._hasPopupData(this.data)}updateEdited(m){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};const{rect:h}=m;h&&this.#s(h)}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#t=null)}#s(m){const{container:{style:h},data:{rect:e,rotation:n},parent:{viewport:{rawDims:{pageWidth:f,pageHeight:o,pageX:a,pageY:u}}}}=this;e?.splice(0,4,...m);const{width:A,height:E}=l(m);h.left=`${100*(m[0]-a)/f}%`,h.top=`${100*(o-m[3]+u)/o}%`,n===0?(h.width=`${100*A/f}%`,h.height=`${100*E/o}%`):this.setRotation(n)}_createContainer(m){const{data:h,parent:{page:e,viewport:n}}=this,f=document.createElement("section");f.setAttribute("data-annotation-id",h.id),this instanceof i||(f.tabIndex=v);const{style:o}=f;if(o.zIndex=this.parent.zIndex++,h.popupRef&&f.setAttribute("aria-haspopup","dialog"),h.alternativeText&&(f.title=h.alternativeText),h.noRotate&&f.classList.add("norotate"),!h.rect||this instanceof O){const{rotation:F}=h;return!h.hasOwnCanvas&&F!==0&&this.setRotation(F,f),f}const{width:a,height:u}=l(h.rect);if(!m&&h.borderStyle.width>0){o.borderWidth=`${h.borderStyle.width}px`;const F=h.borderStyle.horizontalCornerRadius,T=h.borderStyle.verticalCornerRadius;if(F>0||T>0){const K=`calc(${F}px * var(--scale-factor)) / calc(${T}px * var(--scale-factor))`;o.borderRadius=K}else if(this instanceof S){const K=`calc(${a}px * var(--scale-factor)) / calc(${u}px * var(--scale-factor))`;o.borderRadius=K}switch(h.borderStyle.style){case w.AnnotationBorderStyleType.SOLID:o.borderStyle="solid";break;case w.AnnotationBorderStyleType.DASHED:o.borderStyle="dashed";break;case w.AnnotationBorderStyleType.BEVELED:(0,w.warn)("Unimplemented border style: beveled");break;case w.AnnotationBorderStyleType.INSET:(0,w.warn)("Unimplemented border style: inset");break;case w.AnnotationBorderStyleType.UNDERLINE:o.borderBottomStyle="solid";break}const U=h.borderColor||null;U?(this.#e=!0,o.borderColor=w.Util.makeHexColor(U[0]|0,U[1]|0,U[2]|0)):o.borderWidth=0}const A=w.Util.normalizeRect([h.rect[0],e.view[3]-h.rect[1]+e.view[1],h.rect[2],e.view[3]-h.rect[3]+e.view[1]]),{pageWidth:E,pageHeight:k,pageX:R,pageY:D}=n.rawDims;o.left=`${100*(A[0]-R)/E}%`,o.top=`${100*(A[1]-D)/k}%`;const{rotation:I}=h;return h.hasOwnCanvas||I===0?(o.width=`${100*a/E}%`,o.height=`${100*u/k}%`):this.setRotation(I,f),f}setRotation(m,h=this.container){if(!this.data.rect)return;const{pageWidth:e,pageHeight:n}=this.parent.viewport.rawDims,{width:f,height:o}=l(this.data.rect);let a,u;m%180===0?(a=100*f/e,u=100*o/n):(a=100*o/e,u=100*f/n),h.style.width=`${a}%`,h.style.height=`${u}%`,h.setAttribute("data-main-rotation",(360-m)%360)}get _commonActions(){const m=(h,e,n)=>{const f=n.detail[h],o=f[0],a=f.slice(1);n.target.style[e]=C[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[e]:C[`${o}_rgb`](a)})};return(0,w.shadow)(this,"_commonActions",{display:h=>{const{display:e}=h.detail,n=e%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:e===1||e===2})},print:h=>{this.annotationStorage.setValue(this.data.id,{noPrint:!h.detail.print})},hidden:h=>{const{hidden:e}=h.detail;this.container.style.visibility=e?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:e,noView:e})},focus:h=>{setTimeout(()=>h.target.focus({preventScroll:!1}),0)},userName:h=>{h.target.title=h.detail.userName},readonly:h=>{h.target.disabled=h.detail.readonly},required:h=>{this._setRequired(h.target,h.detail.required)},bgColor:h=>{m("bgColor","backgroundColor",h)},fillColor:h=>{m("fillColor","backgroundColor",h)},fgColor:h=>{m("fgColor","color",h)},textColor:h=>{m("textColor","color",h)},borderColor:h=>{m("borderColor","borderColor",h)},strokeColor:h=>{m("strokeColor","borderColor",h)},rotation:h=>{const e=h.detail.rotation;this.setRotation(e),this.annotationStorage.setValue(this.data.id,{rotation:e})}})}_dispatchEventFromSandbox(m,h){const e=this._commonActions;for(const n of Object.keys(h.detail))(m[n]||e[n])?.(h)}_setDefaultPropertiesFromJS(m){if(!this.enableScripting)return;const h=this.annotationStorage.getRawValue(this.data.id);if(!h)return;const e=this._commonActions;for(const[n,f]of Object.entries(h)){const o=e[n];if(o){const a={detail:{[n]:f},target:m};o(a),delete h[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:m}=this.data;if(!m)return;const[h,e,n,f]=this.data.rect;if(m.length===1){const[,{x:F,y:T},{x:U,y:K}]=m[0];if(n===F&&f===T&&h===U&&e===K)return}const{style:o}=this.container;let a;if(this.#e){const{borderColor:F,borderWidth:T}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${F}" stroke-width="${T}">`],this.container.classList.add("hasBorder")}const u=n-h,A=f-e,{svgFactory:E}=this,k=E.createElement("svg");k.classList.add("quadrilateralsContainer"),k.setAttribute("width",0),k.setAttribute("height",0);const R=E.createElement("defs");k.append(R);const D=E.createElement("clipPath"),I=`clippath_${this.data.id}`;D.setAttribute("id",I),D.setAttribute("clipPathUnits","objectBoundingBox"),R.append(D);for(const[,{x:F,y:T},{x:U,y:K}]of m){const X=E.createElement("rect"),W=(U-h)/u,rt=(f-T)/A,J=(F-U)/u,Q=(T-K)/A;X.setAttribute("x",W),X.setAttribute("y",rt),X.setAttribute("width",J),X.setAttribute("height",Q),D.append(X),a?.push(`<rect vector-effect="non-scaling-stroke" x="${W}" y="${rt}" width="${J}" height="${Q}"/>`)}this.#e&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(k),this.container.style.clipPath=`url(#${I})`}_createPopup(){const{container:m,data:h}=this;m.setAttribute("aria-haspopup","dialog");const e=new O({data:{color:h.color,titleObj:h.titleObj,modificationDate:h.modificationDate,contentsObj:h.contentsObj,richText:h.richText,parentRect:h.rect,borderStyle:0,id:`popup_${h.id}`,rotation:h.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){(0,w.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(m,h=null){const e=[];if(this._fieldObjects){const n=this._fieldObjects[m];if(n)for(const{page:f,id:o,exportValues:a}of n){if(f===-1||o===h)continue;const u=typeof a=="string"?a:null,A=document.querySelector(`[data-element-id="${o}"]`);if(A&&!d.has(A)){(0,w.warn)(`_getElementsByName - element not allowed: ${o}`);continue}e.push({id:o,exportValue:u,domElement:A})}return e}for(const n of document.getElementsByName(m)){const{exportValue:f}=n,o=n.getAttribute("data-element-id");o!==h&&d.has(n)&&e.push({id:o,exportValue:f,domElement:n})}return e}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const m=this.getElementsToTriggerPopup();if(Array.isArray(m))for(const h of m)h.classList.add("highlightArea");else m.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:m,data:{id:h}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:m,editId:h})})}}class g extends s{constructor(m,h=null){super(m,{isRenderable:!0,ignoreBorder:!!h?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=m.data.isTooltipOnly}render(){const{data:m,linkService:h}=this,e=document.createElement("a");e.setAttribute("data-element-id",m.id);let n=!1;return m.url?(h.addLinkAttributes(e,m.url,m.newWindow),n=!0):m.action?(this._bindNamedAction(e,m.action),n=!0):m.attachment?(this.#e(e,m.attachment,m.attachmentDest),n=!0):m.setOCGState?(this.#s(e,m.setOCGState),n=!0):m.dest?(this._bindLink(e,m.dest),n=!0):(m.actions&&(m.actions.Action||m.actions["Mouse Up"]||m.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(e,m),n=!0),m.resetForm?(this._bindResetFormAction(e,m.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(e,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(e),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(m,h){m.href=this.linkService.getDestinationHash(h),m.onclick=()=>(h&&this.linkService.goToDestination(h),!1),(h||h==="")&&this.#t()}_bindNamedAction(m,h){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.linkService.executeNamedAction(h),!1),this.#t()}#e(m,h,e=null){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.downloadManager?.openOrDownloadData(h.content,h.filename,e),!1),this.#t()}#s(m,h){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.linkService.executeSetOCGState(h),!1),this.#t()}_bindJSAction(m,h){m.href=this.linkService.getAnchorUrl("");const e=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(h.actions)){const f=e.get(n);f&&(m[f]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h.id,name:n}}),!1))}m.onclick||(m.onclick=()=>!1),this.#t()}_bindResetFormAction(m,h){const e=m.onclick;if(e||(m.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,w.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),e||(m.onclick=()=>!1);return}m.onclick=()=>{e?.();const{fields:n,refs:f,include:o}=h,a=[];if(n.length!==0||f.length!==0){const E=new Set(f);for(const k of n){const R=this._fieldObjects[k]||[];for(const{id:D}of R)E.add(D)}for(const k of Object.values(this._fieldObjects))for(const R of k)E.has(R.id)===o&&a.push(R)}else for(const E of Object.values(this._fieldObjects))a.push(...E);const u=this.annotationStorage,A=[];for(const E of a){const{id:k}=E;switch(A.push(k),E.type){case"text":{const D=E.defaultValue||"";u.setValue(k,{value:D});break}case"checkbox":case"radiobutton":{const D=E.defaultValue===E.exportValues;u.setValue(k,{value:D});break}case"combobox":case"listbox":{const D=E.defaultValue||"";u.setValue(k,{value:D});break}default:continue}const R=document.querySelector(`[data-element-id="${k}"]`);if(R){if(!d.has(R)){(0,w.warn)(`_bindResetFormAction - element not allowed: ${k}`);continue}}else continue;R.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:A,name:"ResetForm"}}),!1}}}class t extends s{constructor(m){super(m,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const m=document.createElement("img");return m.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",m.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),m.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(m),this.container}}class i extends s{render(){return this.container}showElementAndHideCanvas(m){this.data.hasOwnCanvas&&(m.previousSibling?.nodeName==="CANVAS"&&(m.previousSibling.hidden=!0),m.hidden=!1)}_getKeyModifier(m){return w.FeatureTest.platform.isMac?m.metaKey:m.ctrlKey}_setEventListener(m,h,e,n,f){e.includes("mouse")?m.addEventListener(e,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:f(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):m.addEventListener(e,o=>{if(e==="blur"){if(!h.focused||!o.relatedTarget)return;h.focused=!1}else if(e==="focus"){if(h.focused)return;h.focused=!0}f&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:f(o)}})})}_setEventListeners(m,h,e,n){for(const[f,o]of e)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(h||={focused:!1}),this._setEventListener(m,h,f,o,n),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(m,h,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(m,h,"focus","Focus",null))}_setBackgroundColor(m){const h=this.data.backgroundColor||null;m.style.backgroundColor=h===null?"transparent":w.Util.makeHexColor(h[0],h[1],h[2])}_setTextStyle(m){const h=["left","center","right"],{fontColor:e}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||r,f=m.style;let o;const a=2,u=A=>Math.round(10*A)/10;if(this.data.multiLine){const A=Math.abs(this.data.rect[3]-this.data.rect[1]-a),E=Math.round(A/(w.LINE_FACTOR*n))||1,k=A/E;o=Math.min(n,u(k/w.LINE_FACTOR))}else{const A=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(n,u(A/w.LINE_FACTOR))}f.fontSize=`calc(${o}px * var(--scale-factor))`,f.color=w.Util.makeHexColor(e[0],e[1],e[2]),this.data.textAlignment!==null&&(f.textAlign=h[this.data.textAlignment])}_setRequired(m,h){h?m.setAttribute("required",!0):m.removeAttribute("required"),m.setAttribute("aria-required",h)}}class c extends i{constructor(m){const h=m.renderForms||m.data.hasOwnCanvas||!m.data.hasAppearance&&!!m.data.fieldValue;super(m,{isRenderable:h})}setPropertyOnSiblings(m,h,e,n){const f=this.annotationStorage;for(const o of this._getElementsByName(m.name,m.id))o.domElement&&(o.domElement[h]=e),f.setValue(o.id,{[n]:e})}render(){const m=this.annotationStorage,h=this.data.id;this.container.classList.add("textWidgetAnnotation");let e=null;if(this.renderForms){const n=m.getValue(h,{value:this.data.fieldValue});let f=n.value||"";const o=m.getValue(h,{charLimit:this.data.maxLen}).charLimit;o&&f.length>o&&(f=f.slice(0,o));let a=n.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const u={userValue:f,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(e=document.createElement("textarea"),e.textContent=a??f,this.data.doNotScroll&&(e.style.overflowY="hidden")):(e=document.createElement("input"),e.type="text",e.setAttribute("value",a??f),this.data.doNotScroll&&(e.style.overflowX="hidden")),this.data.hasOwnCanvas&&(e.hidden=!0),d.add(e),e.setAttribute("data-element-id",h),e.disabled=this.data.readOnly,e.name=this.data.fieldName,e.tabIndex=v,this._setRequired(e,this.data.required),o&&(e.maxLength=o),e.addEventListener("input",E=>{m.setValue(h,{value:E.target.value}),this.setPropertyOnSiblings(e,"value",E.target.value,"value"),u.formattedValue=null}),e.addEventListener("resetform",E=>{const k=this.data.defaultFieldValue??"";e.value=u.userValue=k,u.formattedValue=null});let A=E=>{const{formattedValue:k}=u;k!=null&&(E.target.value=k),E.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){e.addEventListener("focus",k=>{if(u.focused)return;const{target:R}=k;u.userValue&&(R.value=u.userValue),u.lastCommittedValue=R.value,u.commitKey=1,this.data.actions?.Focus||(u.focused=!0)}),e.addEventListener("updatefromsandbox",k=>{this.showElementAndHideCanvas(k.target);const R={value(D){u.userValue=D.detail.value??"",m.setValue(h,{value:u.userValue.toString()}),D.target.value=u.userValue},formattedValue(D){const{formattedValue:I}=D.detail;u.formattedValue=I,I!=null&&D.target!==document.activeElement&&(D.target.value=I),m.setValue(h,{formattedValue:I})},selRange(D){D.target.setSelectionRange(...D.detail.selRange)},charLimit:D=>{const{charLimit:I}=D.detail,{target:F}=D;if(I===0){F.removeAttribute("maxLength");return}F.setAttribute("maxLength",I);let T=u.userValue;!T||T.length<=I||(T=T.slice(0,I),F.value=u.userValue=T,m.setValue(h,{value:T}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:F.selectionStart,selEnd:F.selectionEnd}}))}};this._dispatchEventFromSandbox(R,k)}),e.addEventListener("keydown",k=>{u.commitKey=1;let R=-1;if(k.key==="Escape"?R=0:k.key==="Enter"&&!this.data.multiLine?R=2:k.key==="Tab"&&(u.commitKey=3),R===-1)return;const{value:D}=k.target;u.lastCommittedValue!==D&&(u.lastCommittedValue=D,u.userValue=D,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:D,willCommit:!0,commitKey:R,selStart:k.target.selectionStart,selEnd:k.target.selectionEnd}}))});const E=A;A=null,e.addEventListener("blur",k=>{if(!u.focused||!k.relatedTarget)return;this.data.actions?.Blur||(u.focused=!1);const{value:R}=k.target;u.userValue=R,u.lastCommittedValue!==R&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:R,willCommit:!0,commitKey:u.commitKey,selStart:k.target.selectionStart,selEnd:k.target.selectionEnd}}),E(k)}),this.data.actions?.Keystroke&&e.addEventListener("beforeinput",k=>{u.lastCommittedValue=null;const{data:R,target:D}=k,{value:I,selectionStart:F,selectionEnd:T}=D;let U=F,K=T;switch(k.inputType){case"deleteWordBackward":{const X=I.substring(0,F).match(/\w*[^\w]*$/);X&&(U-=X[0].length);break}case"deleteWordForward":{const X=I.substring(F).match(/^[^\w]*\w*/);X&&(K+=X[0].length);break}case"deleteContentBackward":F===T&&(U-=1);break;case"deleteContentForward":F===T&&(K+=1);break}k.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:I,change:R||"",willCommit:!1,selStart:U,selEnd:K}})}),this._setEventListeners(e,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],k=>k.target.value)}if(A&&e.addEventListener("blur",A),this.data.comb){const k=(this.data.rect[2]-this.data.rect[0])/o;e.classList.add("comb"),e.style.letterSpacing=`calc(${k}px * var(--scale-factor) - 1ch)`}}else e=document.createElement("div"),e.textContent=this.data.fieldValue,e.style.verticalAlign="middle",e.style.display="table-cell",this.data.hasOwnCanvas&&(e.hidden=!0);return this._setTextStyle(e),this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class p extends i{constructor(m){super(m,{isRenderable:!!m.data.hasOwnCanvas})}}class y extends i{constructor(m){super(m,{isRenderable:m.renderForms})}render(){const m=this.annotationStorage,h=this.data,e=h.id;let n=m.getValue(e,{value:h.exportValue===h.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",m.setValue(e,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const f=document.createElement("input");return d.add(f),f.setAttribute("data-element-id",e),f.disabled=h.readOnly,this._setRequired(f,this.data.required),f.type="checkbox",f.name=h.fieldName,n&&f.setAttribute("checked",!0),f.setAttribute("exportValue",h.exportValue),f.tabIndex=v,f.addEventListener("change",o=>{const{name:a,checked:u}=o.target;for(const A of this._getElementsByName(a,e)){const E=u&&A.exportValue===h.exportValue;A.domElement&&(A.domElement.checked=E),m.setValue(A.id,{value:E})}m.setValue(e,{value:u})}),f.addEventListener("resetform",o=>{const a=h.defaultFieldValue||"Off";o.target.checked=a===h.exportValue}),this.enableScripting&&this.hasJSActions&&(f.addEventListener("updatefromsandbox",o=>{const a={value(u){u.target.checked=u.detail.value!=="Off",m.setValue(e,{value:u.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(f,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(f),this._setDefaultPropertiesFromJS(f),this.container.append(f),this.container}}class S extends i{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const m=this.annotationStorage,h=this.data,e=h.id;let n=m.getValue(e,{value:h.fieldValue===h.buttonValue}).value;if(typeof n=="string"&&(n=n!==h.buttonValue,m.setValue(e,{value:n})),n)for(const o of this._getElementsByName(h.fieldName,e))m.setValue(o.id,{value:!1});const f=document.createElement("input");if(d.add(f),f.setAttribute("data-element-id",e),f.disabled=h.readOnly,this._setRequired(f,this.data.required),f.type="radio",f.name=h.fieldName,n&&f.setAttribute("checked",!0),f.tabIndex=v,f.addEventListener("change",o=>{const{name:a,checked:u}=o.target;for(const A of this._getElementsByName(a,e))m.setValue(A.id,{value:!1});m.setValue(e,{value:u})}),f.addEventListener("resetform",o=>{const a=h.defaultFieldValue;o.target.checked=a!=null&&a===h.buttonValue}),this.enableScripting&&this.hasJSActions){const o=h.buttonValue;f.addEventListener("updatefromsandbox",a=>{const u={value:A=>{const E=o===A.detail.value;for(const k of this._getElementsByName(A.target.name)){const R=E&&k.id===e;k.domElement&&(k.domElement.checked=R),m.setValue(k.id,{value:R})}}};this._dispatchEventFromSandbox(u,a)}),this._setEventListeners(f,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(f),this._setDefaultPropertiesFromJS(f),this.container.append(f),this.container}}class L extends g{constructor(m){super(m,{ignoreBorder:m.data.hasAppearance})}render(){const m=super.render();m.classList.add("buttonWidgetAnnotation","pushButton");const h=m.lastChild;return this.enableScripting&&this.hasJSActions&&h&&(this._setDefaultPropertiesFromJS(h),h.addEventListener("updatefromsandbox",e=>{this._dispatchEventFromSandbox({},e)})),m}}class M extends i{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const m=this.annotationStorage,h=this.data.id,e=m.getValue(h,{value:this.data.fieldValue}),n=document.createElement("select");d.add(n),n.setAttribute("data-element-id",h),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=v;let f=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",E=>{const k=this.data.defaultFieldValue;for(const R of n.options)R.selected=R.value===k});for(const E of this.data.options){const k=document.createElement("option");k.textContent=E.displayValue,k.value=E.exportValue,e.value.includes(E.exportValue)&&(k.setAttribute("selected",!0),f=!1),n.append(k)}let o=null;if(f){const E=document.createElement("option");E.value=" ",E.setAttribute("hidden",!0),E.setAttribute("selected",!0),n.prepend(E),o=()=>{E.remove(),n.removeEventListener("input",o),o=null},n.addEventListener("input",o)}const a=E=>{const k=E?"value":"textContent",{options:R,multiple:D}=n;return D?Array.prototype.filter.call(R,I=>I.selected).map(I=>I[k]):R.selectedIndex===-1?null:R[R.selectedIndex][k]};let u=a(!1);const A=E=>{const k=E.target.options;return Array.prototype.map.call(k,R=>({displayValue:R.textContent,exportValue:R.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",E=>{const k={value(R){o?.();const D=R.detail.value,I=new Set(Array.isArray(D)?D:[D]);for(const F of n.options)F.selected=I.has(F.value);m.setValue(h,{value:a(!0)}),u=a(!1)},multipleSelection(R){n.multiple=!0},remove(R){const D=n.options,I=R.detail.remove;D[I].selected=!1,n.remove(I),D.length>0&&Array.prototype.findIndex.call(D,T=>T.selected)===-1&&(D[0].selected=!0),m.setValue(h,{value:a(!0),items:A(R)}),u=a(!1)},clear(R){for(;n.length!==0;)n.remove(0);m.setValue(h,{value:null,items:[]}),u=a(!1)},insert(R){const{index:D,displayValue:I,exportValue:F}=R.detail.insert,T=n.children[D],U=document.createElement("option");U.textContent=I,U.value=F,T?T.before(U):n.append(U),m.setValue(h,{value:a(!0),items:A(R)}),u=a(!1)},items(R){const{items:D}=R.detail;for(;n.length!==0;)n.remove(0);for(const I of D){const{displayValue:F,exportValue:T}=I,U=document.createElement("option");U.textContent=F,U.value=T,n.append(U)}n.options.length>0&&(n.options[0].selected=!0),m.setValue(h,{value:a(!0),items:A(R)}),u=a(!1)},indices(R){const D=new Set(R.detail.indices);for(const I of R.target.options)I.selected=D.has(I.index);m.setValue(h,{value:a(!0)}),u=a(!1)},editable(R){R.target.disabled=!R.detail.editable}};this._dispatchEventFromSandbox(k,E)}),n.addEventListener("input",E=>{const k=a(!0),R=a(!1);m.setValue(h,{value:k}),E.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:u,change:R,changeEx:k,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],E=>E.target.value)):n.addEventListener("input",function(E){m.setValue(h,{value:a(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class O extends s{constructor(m){const{data:h,elements:e}=m;super(m,{isRenderable:s._hasPopupData(h)}),this.elements=e}render(){this.container.classList.add("popupAnnotation");const m=new N({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),h=[];for(const e of this.elements)e.popup=m,h.push(e.data.id),e.addHighlightArea();return this.container.setAttribute("aria-controls",h.map(e=>`${w.AnnotationPrefix}${e}`).join(",")),this.container}}class N{#t=this.#m.bind(this);#e=this.#C.bind(this);#s=this.#w.bind(this);#n=this.#v.bind(this);#r=null;#i=null;#a=null;#l=null;#h=null;#d=null;#u=null;#c=!1;#o=null;#p=null;#g=null;#f=null;#A=!1;constructor({container:m,color:h,elements:e,titleObj:n,modificationDate:f,contentsObj:o,richText:a,parent:u,rect:A,parentRect:E,open:k}){this.#i=m,this.#f=n,this.#a=o,this.#g=a,this.#d=u,this.#r=h,this.#p=A,this.#u=E,this.#h=e,this.#l=z.PDFDateString.toDateObject(f),this.trigger=e.flatMap(R=>R.getElementsToTriggerPopup());for(const R of this.trigger)R.addEventListener("click",this.#n),R.addEventListener("mouseenter",this.#s),R.addEventListener("mouseleave",this.#e),R.classList.add("popupTriggerArea");for(const R of e)R.container?.addEventListener("keydown",this.#t);this.#i.hidden=!0,k&&this.#v()}render(){if(this.#o)return;const{page:{view:m},viewport:{rawDims:{pageWidth:h,pageHeight:e,pageX:n,pageY:f}}}=this.#d,o=this.#o=document.createElement("div");if(o.className="popup",this.#r){const X=o.style.outlineColor=w.Util.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?o.style.backgroundColor=`color-mix(in srgb, ${X} 30%, white)`:o.style.backgroundColor=w.Util.makeHexColor(...this.#r.map(rt=>Math.floor(.7*(255-rt)+rt)))}const a=document.createElement("span");a.className="header";const u=document.createElement("h1");if(a.append(u),{dir:u.dir,str:u.textContent}=this.#f,o.append(a),this.#l){const X=document.createElement("span");X.classList.add("popupDate"),X.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),X.setAttribute("data-l10n-args",JSON.stringify({date:this.#l.toLocaleDateString(),time:this.#l.toLocaleTimeString()})),a.append(X)}const A=this.#a,E=this.#g;if(E?.str&&(!A?.str||A.str===E.str))x.XfaLayer.render({xfaHtml:E.html,intent:"richText",div:o}),o.lastChild.classList.add("richText","popupContent");else{const X=this._formatContents(A);o.append(X)}let k=!!this.#u,R=k?this.#u:this.#p;for(const X of this.#h)if(!R||w.Util.intersect(X.data.rect,R)!==null){R=X.data.rect,k=!0;break}const D=w.Util.normalizeRect([R[0],m[3]-R[1]+m[1],R[2],m[3]-R[3]+m[1]]),F=k?R[2]-R[0]+5:0,T=D[0]+F,U=D[1],{style:K}=this.#i;K.left=`${100*(T-n)/h}%`,K.top=`${100*(U-f)/e}%`,this.#i.append(o)}_formatContents({str:m,dir:h}){const e=document.createElement("p");e.classList.add("popupContent"),e.dir=h;const n=m.split(/(?:\r\n?|\n)/);for(let f=0,o=n.length;f<o;++f){const a=n[f];e.append(document.createTextNode(a)),f<o-1&&e.append(document.createElement("br"))}return e}#m(m){m.altKey||m.shiftKey||m.ctrlKey||m.metaKey||(m.key==="Enter"||m.key==="Escape"&&this.#c)&&this.#v()}#v(){this.#c=!this.#c,this.#c?(this.#w(),this.#i.addEventListener("click",this.#n),this.#i.addEventListener("keydown",this.#t)):(this.#C(),this.#i.removeEventListener("click",this.#n),this.#i.removeEventListener("keydown",this.#t))}#w(){this.#o||this.render(),this.isVisible?this.#c&&this.#i.classList.add("focused"):(this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#C(){this.#i.classList.remove("focused"),!(this.#c||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#A=this.isVisible,this.#A&&(this.#i.hidden=!0)}maybeShow(){this.#A&&(this.#A=!1,this.#i.hidden=!1)}get isVisible(){return this.#i.hidden===!1}}class B extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.textContent=m.data.textContent,this.textPosition=m.data.textPosition,this.annotationEditorType=w.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const m=document.createElement("div");m.classList.add("annotationTextContent"),m.setAttribute("role","comment");for(const h of this.textContent){const e=document.createElement("span");e.textContent=h,m.append(e)}this.container.append(m)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class q extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0),f=this.#t=this.svgFactory.createElement("svg:line");return f.setAttribute("x1",m.rect[2]-m.lineCoordinates[0]),f.setAttribute("y1",m.rect[3]-m.lineCoordinates[1]),f.setAttribute("x2",m.rect[2]-m.lineCoordinates[2]),f.setAttribute("y2",m.rect[3]-m.lineCoordinates[3]),f.setAttribute("stroke-width",m.borderStyle.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),n.append(f),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class nt extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0),f=m.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",f/2),o.setAttribute("y",f/2),o.setAttribute("width",h-f),o.setAttribute("height",e-f),o.setAttribute("stroke-width",f||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class j extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0),f=m.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",h/2),o.setAttribute("cy",e/2),o.setAttribute("rx",h/2-f/2),o.setAttribute("ry",e/2-f/2),o.setAttribute("stroke-width",f||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class H extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0);let f=[];for(const a of m.vertices){const u=a.x-m.rect[0],A=m.rect[3]-a.y;f.push(u+","+A)}f=f.join(" ");const o=this.#t=this.svgFactory.createElement(this.svgElementName);return o.setAttribute("points",f),o.setAttribute("stroke-width",m.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class G extends H{constructor(m){super(m),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Y extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class tt extends s{#t=[];constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=w.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0);for(const f of m.inkLists){let o=[];for(const u of f){const A=u.x-m.rect[0],E=m.rect[3]-u.y;o.push(`${A},${E}`)}o=o.join(" ");const a=this.svgFactory.createElement(this.svgElementName);this.#t.push(a),a.setAttribute("points",o),a.setAttribute("stroke-width",m.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),!m.popupRef&&this.hasPopupData&&this._createPopup(),n.append(a)}return this.container.append(n),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Z extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class at extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class lt extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class pt extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class dt extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class ot extends s{#t=null;constructor(m){super(m,{isRenderable:!0});const{filename:h,content:e}=this.data.file;this.filename=(0,z.getFilenameFromUrl)(h,!0),this.content=e,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:h,content:e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:m,data:h}=this;let e;h.hasAppearance||h.fillAlpha===0?e=document.createElement("div"):(e=document.createElement("img"),e.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(h.name)?"paperclip":"pushpin"}.svg`,h.fillAlpha&&h.fillAlpha<1&&(e.style=`filter: opacity(${Math.round(h.fillAlpha*100)}%);`)),e.addEventListener("dblclick",this.#e.bind(this)),this.#t=e;const{isMac:n}=w.FeatureTest.platform;return m.addEventListener("keydown",f=>{f.key==="Enter"&&(n?f.metaKey:f.ctrlKey)&&this.#e()}),!h.popupRef&&this.hasPopupData?this._createPopup():e.classList.add("popupTriggerArea"),m.append(e),m}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class ut{#t=null;#e=null;#s=new Map;constructor({div:m,accessibilityManager:h,annotationCanvasMap:e,annotationEditorUIManager:n,page:f,viewport:o}){this.div=m,this.#t=h,this.#e=e,this.page=f,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=n}#n(m,h){const e=m.firstChild||m;e.id=`${w.AnnotationPrefix}${h}`,this.div.append(m),this.#t?.moveElementInDOM(this.div,m,e,!1)}async render(m){const{annotations:h}=m,e=this.div;(0,z.setLayerDimensions)(e,this.viewport);const n=new Map,f={data:null,layer:e,linkService:m.linkService,downloadManager:m.downloadManager,imageResourcesPath:m.imageResourcesPath||"",renderForms:m.renderForms!==!1,svgFactory:new z.DOMSVGFactory,annotationStorage:m.annotationStorage||new _.AnnotationStorage,enableScripting:m.enableScripting===!0,hasJSActions:m.hasJSActions,fieldObjects:m.fieldObjects,parent:this,elements:null};for(const o of h){if(o.noHTML)continue;const a=o.annotationType===w.AnnotationType.POPUP;if(a){const E=n.get(o.id);if(!E)continue;f.elements=E}else{const{width:E,height:k}=l(o.rect);if(E<=0||k<=0)continue}f.data=o;const u=b.create(f);if(!u.isRenderable)continue;if(!a&&o.popupRef){const E=n.get(o.popupRef);E?E.push(u):n.set(o.popupRef,[u])}const A=u.render();o.hidden&&(A.style.visibility="hidden"),this.#n(A,o.id),u.annotationEditorType>0&&(this.#s.set(u.data.id,u),this._annotationEditorUIManager?.renderAnnotationElement(u))}this.#r()}update({viewport:m}){const h=this.div;this.viewport=m,(0,z.setLayerDimensions)(h,{rotation:m.rotation}),this.#r(),h.hidden=!1}#r(){if(!this.#e)return;const m=this.div;for(const[h,e]of this.#e){const n=m.querySelector(`[data-annotation-id="${h}"]`);if(!n)continue;e.className="annotationContent";const{firstChild:f}=n;f?f.nodeName==="CANVAS"?f.replaceWith(e):f.classList.contains("annotationContent")?f.after(e):f.before(e):n.append(e)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(m){return this.#s.get(m)}}},792:(ct,st,$)=>{$.d(st,{AnnotationStorage:()=>P,PrintAnnotationStorage:()=>C,SerializableEmpty:()=>V});var w=$(292),z=$(310),_=$(651);const V=Object.freeze({map:null,hash:"",transfer:void 0});class P{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(v,r){const d=this.#e.get(v);return d===void 0?r:Object.assign(r,d)}getRawValue(v){return this.#e.get(v)}remove(v){if(this.#e.delete(v),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const r of this.#e.values())if(r instanceof z.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(v,r){const d=this.#e.get(v);let l=!1;if(d!==void 0)for(const[b,s]of Object.entries(r))d[b]!==s&&(l=!0,d[b]=s);else l=!0,this.#e.set(v,r);l&&this.#s(),r instanceof z.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(r.constructor._type)}has(v){return this.#e.has(v)}getAll(){return this.#e.size>0?(0,w.objectFromMap)(this.#e):null}setAll(v){for(const[r,d]of Object.entries(v))this.setValue(r,d)}get size(){return this.#e.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new C(this)}get serializable(){if(this.#e.size===0)return V;const v=new Map,r=new _.MurmurHash3_64,d=[],l=Object.create(null);let b=!1;for(const[s,g]of this.#e){const t=g instanceof z.AnnotationEditor?g.serialize(!1,l):g;t&&(v.set(s,t),r.update(`${s}:${JSON.stringify(t)}`),b||=!!t.bitmap)}if(b)for(const s of v.values())s.bitmap&&d.push(s.bitmap);return v.size>0?{map:v,hash:r.hexdigest(),transfer:d}:V}get editorStats(){let v=null;const r=new Map;for(const d of this.#e.values()){if(!(d instanceof z.AnnotationEditor))continue;const l=d.telemetryFinalData;if(!l)continue;const{type:b}=l;r.has(b)||r.set(b,Object.getPrototypeOf(d).constructor),v||=Object.create(null);const s=v[b]||=new Map;for(const[g,t]of Object.entries(l)){if(g==="type")continue;let i=s.get(g);i||(i=new Map,s.set(g,i));const c=i.get(t)??0;i.set(t,c+1)}}for(const[d,l]of r)v[d]=l.computeTelemetryFinalData(v[d]);return v}}class C extends P{#t;constructor(v){super();const{map:r,hash:d,transfer:l}=v.serializable,b=structuredClone(r,l?{transfer:l}:null);this.#t={map:b,hash:d,transfer:l}}get print(){(0,w.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}},831:(ct,st,$)=>{$.a(ct,async(w,z)=>{try{let nt=function(o){if(typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o}),typeof o!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!o.url&&!o.data&&!o.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const a=new tt,{docId:u}=a,A=o.url?H(o.url):null,E=o.data?G(o.data):null,k=o.httpHeaders||null,R=o.withCredentials===!0,D=o.password??null,I=o.range instanceof Z?o.range:null,F=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:S;let T=o.worker instanceof ot?o.worker:null;const U=o.verbosity,K=typeof o.docBaseUrl=="string"&&!(0,P.isDataScheme)(o.docBaseUrl)?o.docBaseUrl:null,X=typeof o.cMapUrl=="string"?o.cMapUrl:null,W=o.cMapPacked!==!1,rt=o.CMapReaderFactory||N,J=typeof o.standardFontDataUrl=="string"?o.standardFontDataUrl:null,Q=o.StandardFontDataFactory||q,it=o.stopAtErrors!==!0,ht=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,gt=o.isEvalSupported!==!1,bt=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!_.isNodeJS,At=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,mt=typeof o.disableFontFace=="boolean"?o.disableFontFace:_.isNodeJS,Ct=o.fontExtraProperties===!0,St=o.enableXfa===!0,Tt=o.ownerDocument||globalThis.document,vt=o.disableRange===!0,Et=o.disableStream===!0,kt=o.disableAutoFetch===!0,Lt=o.pdfBug===!0,_t=I?I.length:o.length??NaN,Ht=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!_.isNodeJS&&!mt,Mt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:rt===P.DOMCMapReaderFactory&&Q===P.DOMStandardFontDataFactory&&X&&J&&(0,P.isValidFetchUrl)(X,document.baseURI)&&(0,P.isValidFetchUrl)(J,document.baseURI),xt=o.canvasFactory||new O({ownerDocument:Tt}),wt=o.filterFactory||new B({docId:u,ownerDocument:Tt}),Bt=null;(0,_.setVerbosityLevel)(U);const Dt={canvasFactory:xt,filterFactory:wt};if(Mt||(Dt.cMapReaderFactory=new rt({baseUrl:X,isCompressed:W}),Dt.standardFontDataFactory=new Q({baseUrl:J})),!T){const Nt={verbosity:U,port:d.GlobalWorkerOptions.workerPort};T=Nt.port?ot.fromPort(Nt):new ot(Nt),a._worker=T}const It={docId:u,apiVersion:"4.2.67",data:E,password:D,disableAutoFetch:kt,rangeChunkSize:F,length:_t,docBaseUrl:K,enableXfa:St,evaluatorOptions:{maxImageSize:ht,disableFontFace:mt,ignoreErrors:it,isEvalSupported:gt,isOffscreenCanvasSupported:bt,canvasMaxAreaInBytes:At,fontExtraProperties:Ct,useSystemFonts:Ht,cMapUrl:Mt?X:null,standardFontDataUrl:Mt?J:null}},yt={ignoreErrors:it,disableFontFace:mt,fontExtraProperties:Ct,enableXfa:St,ownerDocument:Tt,disableAutoFetch:kt,pdfBug:Lt,styleElement:Bt};return T.promise.then(function(){if(a.destroyed)throw new Error("Loading aborted");const Nt=j(T,It),Ut=new Promise(function(zt){let Ot;I?Ot=new g.PDFDataTransportStream(I,{disableRange:vt,disableStream:Et}):E||(Ot=(Rt=>_.isNodeJS?function(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype}()&&(0,P.isValidFetchUrl)(Rt.url)?new t.PDFFetchStream(Rt):new c.PDFNodeStream(Rt):(0,P.isValidFetchUrl)(Rt.url)?new t.PDFFetchStream(Rt):new i.PDFNetworkStream(Rt))({url:A,length:_t,httpHeaders:k,withCredentials:R,rangeChunkSize:F,disableRange:vt,disableStream:Et})),zt(Ot)});return Promise.all([Nt,Ut]).then(function([zt,Ot]){if(a.destroyed)throw new Error("Loading aborted");const Gt=new l.MessageHandler(u,zt,T.port),Rt=new ut(Gt,a,Ot,yt,Dt);a._transport=Rt,Gt.send("Ready",null)})}).catch(a._capability.reject),a},H=function(o){if(o instanceof URL)return o.href;try{return new URL(o,window.location).href}catch{if(_.isNodeJS&&typeof o=="string")return o}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")},G=function(o){if(_.isNodeJS&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return(0,_.stringToBytes)(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")},Y=function(o){return typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0};$.d(st,{PDFDataRangeTransport:()=>Z,PDFWorker:()=>ot,build:()=>f,getDocument:()=>nt,version:()=>n});var _=$(292),V=$(792),P=$(419),C=$(10),x=$(573),v=$(923),r=$(814),d=$(164),l=$(178),b=$(62),s=$(626),g=$(585),t=$(94),i=$(457),c=$(786),p=$(50),y=w([x,c]);[x,c]=y.then?(await y)():y;const S=65536,L=100,M=5e3,O=_.isNodeJS?x.NodeCanvasFactory:P.DOMCanvasFactory,N=_.isNodeJS?x.NodeCMapReaderFactory:P.DOMCMapReaderFactory,B=_.isNodeJS?x.NodeFilterFactory:P.DOMFilterFactory,q=_.isNodeJS?x.NodeStandardFontDataFactory:P.DOMStandardFontDataFactory;async function j(o,a){if(o.destroyed)throw new Error("Worker was destroyed");const u=await o.messageHandler.sendWithPromise("GetDocRequest",a,a.data?[a.data.buffer]:null);if(o.destroyed)throw new Error("Worker was destroyed");return u}class tt{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${tt.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(a){throw this._worker?.port&&delete this._worker._pendingDestroy,a}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class Z{constructor(a,u,A=!1,E=null){this.length=a,this.initialData=u,this.progressiveDone=A,this.contentDispositionFilename=E,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(a){this._rangeListeners.push(a)}addProgressListener(a){this._progressListeners.push(a)}addProgressiveReadListener(a){this._progressiveReadListeners.push(a)}addProgressiveDoneListener(a){this._progressiveDoneListeners.push(a)}onDataRange(a,u){for(const A of this._rangeListeners)A(a,u)}onDataProgress(a,u){this._readyCapability.promise.then(()=>{for(const A of this._progressListeners)A(a,u)})}onDataProgressiveRead(a){this._readyCapability.promise.then(()=>{for(const u of this._progressiveReadListeners)u(a)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const a of this._progressiveDoneListeners)a()})}transportReady(){this._readyCapability.resolve()}requestDataRange(a,u){(0,_.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class at{constructor(a,u){this._pdfInfo=a,this._transport=u}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(a){return this._transport.getPage(a)}getPageIndex(a){return this._transport.getPageIndex(a)}getDestinations(){return this._transport.getDestinations()}getDestination(a){return this._transport.getDestination(a)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:a="display"}={}){const{renderingIntent:u}=this._transport.getRenderingIntent(a);return this._transport.getOptionalContentConfig(u)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(a=!1){return this._transport.startCleanup(a||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(a){return this._transport.cachedPageNumber(a)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class lt{#t=null;#e=!1;constructor(a,u,A,E=!1){this._pageIndex=a,this._pageInfo=u,this._transport=A,this._stats=E?new P.StatTimer:null,this._pdfBug=E,this.commonObjs=A.commonObjs,this.objs=new m,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:a,rotation:u=this.rotate,offsetX:A=0,offsetY:E=0,dontFlip:k=!1}={}){return new P.PageViewport({viewBox:this.view,scale:a,rotation:u,offsetX:A,offsetY:E,dontFlip:k})}getAnnotations({intent:a="display"}={}){const{renderingIntent:u}=this._transport.getRenderingIntent(a);return this._transport.getAnnotations(this._pageIndex,u)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:a,viewport:u,intent:A="display",annotationMode:E=_.AnnotationMode.ENABLE,transform:k=null,background:R=null,optionalContentConfigPromise:D=null,annotationCanvasMap:I=null,pageColors:F=null,printAnnotationStorage:T=null}){this._stats?.time("Overall");const U=this._transport.getRenderingIntent(A,E,T),{renderingIntent:K,cacheKey:X}=U;this.#e=!1,this.#n(),D||=this._transport.getOptionalContentConfig(K);let W=this._intentStates.get(X);W||(W=Object.create(null),this._intentStates.set(X,W)),W.streamReaderCancelTimeout&&(clearTimeout(W.streamReaderCancelTimeout),W.streamReaderCancelTimeout=null);const rt=!!(K&_.RenderingIntentFlag.PRINT);W.displayReadyCapability||(W.displayReadyCapability=Promise.withResolvers(),W.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(U));const J=ht=>{W.renderTasks.delete(Q),(this._maybeCleanupAfterRender||rt)&&(this.#e=!0),this.#s(!rt),ht?(Q.capability.reject(ht),this._abortOperatorList({intentState:W,reason:ht instanceof Error?ht:new Error(ht)})):Q.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},Q=new e({callback:J,params:{canvasContext:a,viewport:u,transform:k,background:R},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:I,operatorList:W.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!rt,pdfBug:this._pdfBug,pageColors:F});(W.renderTasks||=new Set).add(Q);const it=Q.task;return Promise.all([W.displayReadyCapability.promise,D]).then(([ht,gt])=>{if(this.destroyed){J();return}if(this._stats?.time("Rendering"),!(gt.renderingIntent&K))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");Q.initializeGraphics({transparency:ht,optionalContentConfig:gt}),Q.operatorListChanged()}).catch(J),it}getOperatorList({intent:a="display",annotationMode:u=_.AnnotationMode.ENABLE,printAnnotationStorage:A=null}={}){function E(){R.operatorList.lastChunk&&(R.opListReadCapability.resolve(R.operatorList),R.renderTasks.delete(D))}const k=this._transport.getRenderingIntent(a,u,A,!0);let R=this._intentStates.get(k.cacheKey);R||(R=Object.create(null),this._intentStates.set(k.cacheKey,R));let D;return R.opListReadCapability||(D=Object.create(null),D.operatorListChanged=E,R.opListReadCapability=Promise.withResolvers(),(R.renderTasks||=new Set).add(D),R.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(k)),R.opListReadCapability.promise}streamTextContent({includeMarkedContent:a=!1,disableNormalization:u=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:a===!0,disableNormalization:u===!0},{highWaterMark:100,size(E){return E.items.length}})}getTextContent(a={}){if(this._transport._htmlForXfa)return this.getXfa().then(A=>p.XfaText.textContent(A));const u=this.streamTextContent(a);return new Promise(function(A,E){function k(){R.read().then(function({value:I,done:F}){if(F){A(D);return}Object.assign(D.styles,I.styles),D.items.push(...I.items),k()},E)}const R=u.getReader(),D={items:[],styles:Object.create(null)};k()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const a=[];for(const u of this._intentStates.values())if(this._abortOperatorList({intentState:u,reason:new Error("Page was destroyed."),force:!0}),!u.opListReadCapability)for(const A of u.renderTasks)a.push(A.completed),A.cancel();return this.objs.clear(),this.#e=!1,this.#n(),Promise.all(a)}cleanup(a=!1){this.#e=!0;const u=this.#s(!1);return a&&u&&(this._stats&&=new P.StatTimer),u}#s(a=!1){if(this.#n(),!this.#e||this.destroyed)return!1;if(a)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},M),!1;for(const{renderTasks:u,operatorList:A}of this._intentStates.values())if(u.size>0||!A.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#n(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(a,u){const A=this._intentStates.get(u);A&&(this._stats?.timeEnd("Page Request"),A.displayReadyCapability?.resolve(a))}_renderPageChunk(a,u){for(let A=0,E=a.length;A<E;A++)u.operatorList.fnArray.push(a.fnArray[A]),u.operatorList.argsArray.push(a.argsArray[A]);u.operatorList.lastChunk=a.lastChunk,u.operatorList.separateAnnots=a.separateAnnots;for(const A of u.renderTasks)A.operatorListChanged();a.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:a,cacheKey:u,annotationStorageSerializable:A}){const{map:E,transfer:k}=A,D=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:a,cacheKey:u,annotationStorage:E},k).getReader(),I=this._intentStates.get(u);I.streamReader=D;const F=()=>{D.read().then(({value:T,done:U})=>{if(U){I.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(T,I),F())},T=>{if(I.streamReader=null,!this._transport.destroyed){if(I.operatorList){I.operatorList.lastChunk=!0;for(const U of I.renderTasks)U.operatorListChanged();this.#s(!0)}if(I.displayReadyCapability)I.displayReadyCapability.reject(T);else if(I.opListReadCapability)I.opListReadCapability.reject(T);else throw T}})};F()}_abortOperatorList({intentState:a,reason:u,force:A=!1}){if(a.streamReader){if(a.streamReaderCancelTimeout&&(clearTimeout(a.streamReaderCancelTimeout),a.streamReaderCancelTimeout=null),!A){if(a.renderTasks.size>0)return;if(u instanceof P.RenderingCancelledException){let E=L;u.extraDelay>0&&u.extraDelay<1e3&&(E+=u.extraDelay),a.streamReaderCancelTimeout=setTimeout(()=>{a.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:a,reason:u,force:!0})},E);return}}if(a.streamReader.cancel(new _.AbortException(u.message)).catch(()=>{}),a.streamReader=null,!this._transport.destroyed){for(const[E,k]of this._intentStates)if(k===a){this._intentStates.delete(E);break}this.cleanup()}}}get stats(){return this._stats}}class pt{#t=new Set;#e=Promise.resolve();postMessage(a,u){const A={data:structuredClone(a,u?{transfer:u}:null)};this.#e.then(()=>{for(const E of this.#t)E.call(this,A)})}addEventListener(a,u){this.#t.add(u)}removeEventListener(a,u){this.#t.delete(u)}terminate(){this.#t.clear()}}const dt={isWorkerDisabled:!1,fakeWorkerId:0};_.isNodeJS&&(dt.isWorkerDisabled=!0,d.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),dt.isSameOrigin=function(o,a){let u;try{if(u=new URL(o),!u.origin||u.origin==="null")return!1}catch{return!1}const A=new URL(a,u);return u.origin===A.origin},dt.createCDNWrapper=function(o){const a=`await import("${o}");`;return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))};class ot{static#t;constructor({name:a=null,port:u=null,verbosity:A=(0,_.getVerbosityLevel)()}={}){if(this.name=a,this.destroyed=!1,this.verbosity=A,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,u){if(ot.#t?.has(u))throw new Error("Cannot use more than one PDFWorker per port.");(ot.#t||=new WeakMap).set(u,this),this._initializeFromPort(u);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(a){this._port=a,this._messageHandler=new l.MessageHandler("main","worker",a),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!dt.isWorkerDisabled&&!ot.#e){let{workerSrc:a}=ot;try{dt.isSameOrigin(window.location.href,a)||(a=dt.createCDNWrapper(new URL(a,window.location).href));const u=new Worker(a,{type:"module"}),A=new l.MessageHandler("main","worker",u),E=()=>{u.removeEventListener("error",k),A.destroy(),u.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},k=()=>{this._webWorker||E()};u.addEventListener("error",k),A.on("test",D=>{if(u.removeEventListener("error",k),this.destroyed){E();return}D?(this._messageHandler=A,this._port=u,this._webWorker=u,this._readyCapability.resolve(),A.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),A.destroy(),u.terminate())}),A.on("ready",D=>{if(u.removeEventListener("error",k),this.destroyed){E();return}try{R()}catch{this._setupFakeWorker()}});const R=()=>{const D=new Uint8Array;A.send("test",D,[D.buffer])};R();return}catch{(0,_.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){dt.isWorkerDisabled||((0,_.warn)("Setting up fake worker."),dt.isWorkerDisabled=!0),ot._setupFakeWorkerGlobal.then(a=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const u=new pt;this._port=u;const A=`fake${dt.fakeWorkerId++}`,E=new l.MessageHandler(A+"_worker",A,u);a.setup(E,u);const k=new l.MessageHandler(A,A+"_worker",u);this._messageHandler=k,this._readyCapability.resolve(),k.send("configure",{verbosity:this.verbosity})}).catch(a=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${a.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),ot.#t?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(a){if(!a?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const u=this.#t?.get(a.port);if(u){if(u._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return u}return new ot(a)}static get workerSrc(){if(d.GlobalWorkerOptions.workerSrc)return d.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#e(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const a=async()=>this.#e?this.#e:(await import(this.workerSrc)).WorkerMessageHandler;return(0,_.shadow)(this,"_setupFakeWorkerGlobal",a())}}class ut{#t=new Map;#e=new Map;#s=new Map;#n=new Map;#r=null;constructor(a,u,A,E,k){this.messageHandler=a,this.loadingTask=u,this.commonObjs=new m,this.fontLoader=new C.FontLoader({ownerDocument:E.ownerDocument,styleElement:E.styleElement}),this._params=E,this.canvasFactory=k.canvasFactory,this.filterFactory=k.filterFactory,this.cMapReaderFactory=k.cMapReaderFactory,this.standardFontDataFactory=k.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=A,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#i(a,u=null){const A=this.#t.get(a);if(A)return A;const E=this.messageHandler.sendWithPromise(a,u);return this.#t.set(a,E),E}get annotationStorage(){return(0,_.shadow)(this,"annotationStorage",new V.AnnotationStorage)}getRenderingIntent(a,u=_.AnnotationMode.ENABLE,A=null,E=!1){let k=_.RenderingIntentFlag.DISPLAY,R=V.SerializableEmpty;switch(a){case"any":k=_.RenderingIntentFlag.ANY;break;case"display":break;case"print":k=_.RenderingIntentFlag.PRINT;break;default:(0,_.warn)(`getRenderingIntent - invalid intent: ${a}`)}switch(u){case _.AnnotationMode.DISABLE:k+=_.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _.AnnotationMode.ENABLE:break;case _.AnnotationMode.ENABLE_FORMS:k+=_.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _.AnnotationMode.ENABLE_STORAGE:k+=_.RenderingIntentFlag.ANNOTATIONS_STORAGE,R=(k&_.RenderingIntentFlag.PRINT&&A instanceof V.PrintAnnotationStorage?A:this.annotationStorage).serializable;break;default:(0,_.warn)(`getRenderingIntent - invalid annotationMode: ${u}`)}return E&&(k+=_.RenderingIntentFlag.OPLIST),{renderingIntent:k,cacheKey:`${k}_${R.hash}`,annotationStorageSerializable:R}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const a=[];for(const A of this.#e.values())a.push(A._destroy());this.#e.clear(),this.#s.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const u=this.messageHandler.sendWithPromise("Terminate",null);return a.push(u),Promise.all(a).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),(0,r.cleanupTextLayer)(),this._networkStream?.cancelAllRequests(new _.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:a,loadingTask:u}=this;a.on("GetReader",(A,E)=>{(0,_.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=k=>{this._lastProgress={loaded:k.loaded,total:k.total}},E.onPull=()=>{this._fullReader.read().then(function({value:k,done:R}){if(R){E.close();return}(0,_.assert)(k instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),E.enqueue(new Uint8Array(k),1,[k])}).catch(k=>{E.error(k)})},E.onCancel=k=>{this._fullReader.cancel(k),E.ready.catch(R=>{if(!this.destroyed)throw R})}}),a.on("ReaderHeadersReady",A=>{const E=Promise.withResolvers(),k=this._fullReader;return k.headersReady.then(()=>{(!k.isStreamingSupported||!k.isRangeSupported)&&(this._lastProgress&&u.onProgress?.(this._lastProgress),k.onProgress=R=>{u.onProgress?.({loaded:R.loaded,total:R.total})}),E.resolve({isStreamingSupported:k.isStreamingSupported,isRangeSupported:k.isRangeSupported,contentLength:k.contentLength})},E.reject),E.promise}),a.on("GetRangeReader",(A,E)=>{(0,_.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const k=this._networkStream.getRangeReader(A.begin,A.end);if(!k){E.close();return}E.onPull=()=>{k.read().then(function({value:R,done:D}){if(D){E.close();return}(0,_.assert)(R instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),E.enqueue(new Uint8Array(R),1,[R])}).catch(R=>{E.error(R)})},E.onCancel=R=>{k.cancel(R),E.ready.catch(D=>{if(!this.destroyed)throw D})}}),a.on("GetDoc",({pdfInfo:A})=>{this._numPages=A.numPages,this._htmlForXfa=A.htmlForXfa,delete A.htmlForXfa,u._capability.resolve(new at(A,this))}),a.on("DocException",function(A){let E;switch(A.name){case"PasswordException":E=new _.PasswordException(A.message,A.code);break;case"InvalidPDFException":E=new _.InvalidPDFException(A.message);break;case"MissingPDFException":E=new _.MissingPDFException(A.message);break;case"UnexpectedResponseException":E=new _.UnexpectedResponseException(A.message,A.status);break;case"UnknownErrorException":E=new _.UnknownErrorException(A.message,A.details);break;default:(0,_.unreachable)("DocException - expected a valid Error.")}u._capability.reject(E)}),a.on("PasswordRequest",A=>{if(this.#r=Promise.withResolvers(),u.onPassword){const E=k=>{k instanceof Error?this.#r.reject(k):this.#r.resolve({password:k})};try{u.onPassword(E,A.code)}catch(k){this.#r.reject(k)}}else this.#r.reject(new _.PasswordException(A.message,A.code));return this.#r.promise}),a.on("DataLoaded",A=>{u.onProgress?.({loaded:A.length,total:A.length}),this.downloadInfoCapability.resolve(A)}),a.on("StartRenderPage",A=>{if(this.destroyed)return;this.#e.get(A.pageIndex)._startRenderPage(A.transparency,A.cacheKey)}),a.on("commonobj",([A,E,k])=>{if(this.destroyed||this.commonObjs.has(A))return null;switch(E){case"Font":const R=this._params;if("error"in k){const T=k.error;(0,_.warn)(`Error during font loading: ${T}`),this.commonObjs.resolve(A,T);break}const D=R.pdfBug&&globalThis.FontInspector?.enabled?(T,U)=>globalThis.FontInspector.fontAdded(T,U):null,I=new C.FontFaceObject(k,{disableFontFace:R.disableFontFace,ignoreErrors:R.ignoreErrors,inspectFont:D});this.fontLoader.bind(I).catch(()=>a.sendWithPromise("FontFallback",{id:A})).finally(()=>{!R.fontExtraProperties&&I.data&&(I.data=null),this.commonObjs.resolve(A,I)});break;case"CopyLocalImage":const{imageRef:F}=k;(0,_.assert)(F,"The imageRef must be defined.");for(const T of this.#e.values())for(const[,U]of T.objs)if(U.ref===F)return U.dataLen?(this.commonObjs.resolve(A,structuredClone(U)),U.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(A,k);break;default:throw new Error(`Got unknown common object type ${E}`)}return null}),a.on("obj",([A,E,k,R])=>{if(this.destroyed)return;const D=this.#e.get(E);if(!D.objs.has(A)){if(D._intentStates.size===0){R?.bitmap?.close();return}switch(k){case"Image":D.objs.resolve(A,R),R?.dataLen>_.MAX_IMAGE_SIZE_TO_CACHE&&(D._maybeCleanupAfterRender=!0);break;case"Pattern":D.objs.resolve(A,R);break;default:throw new Error(`Got unknown object type ${k}`)}}}),a.on("DocProgress",A=>{this.destroyed||u.onProgress?.({loaded:A.loaded,total:A.total})}),a.on("FetchBuiltInCMap",A=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(A):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),a.on("FetchStandardFontData",A=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(A):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:a,transfer:u}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:this._fullReader?.filename??null},u).finally(()=>{this.annotationStorage.resetModified()})}getPage(a){if(!Number.isInteger(a)||a<=0||a>this._numPages)return Promise.reject(new Error("Invalid page request."));const u=a-1,A=this.#s.get(u);if(A)return A;const E=this.messageHandler.sendWithPromise("GetPage",{pageIndex:u}).then(k=>{if(this.destroyed)throw new Error("Transport destroyed");k.refStr&&this.#n.set(k.refStr,a);const R=new lt(u,k,this,this._params.pdfBug);return this.#e.set(u,R),R});return this.#s.set(u,E),E}getPageIndex(a){return Y(a)?this.messageHandler.sendWithPromise("GetPageIndex",{num:a.num,gen:a.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(a,u){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:a,intent:u})}getFieldObjects(){return this.#i("GetFieldObjects")}hasJSActions(){return this.#i("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(a){return typeof a!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:a})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#i("GetDocJSActions")}getPageJSActions(a){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:a})}getStructTree(a){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:a})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(a){return this.#i("GetOptionalContentConfig").then(u=>new s.OptionalContentConfig(u,a))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const a="GetMetadata",u=this.#t.get(a);if(u)return u;const A=this.messageHandler.sendWithPromise(a,null).then(E=>({info:E[0],metadata:E[1]?new b.Metadata(E[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(a,A),A}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(a=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const u of this.#e.values())if(!u.cleanup())throw new Error(`startCleanup: Page ${u.pageNumber} is currently rendering.`);this.commonObjs.clear(),a||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),(0,r.cleanupTextLayer)()}}cachedPageNumber(a){if(!Y(a))return null;const u=a.gen===0?`${a.num}R`:`${a.num}R${a.gen}`;return this.#n.get(u)??null}get loadingParams(){const{disableAutoFetch:a,enableXfa:u}=this._params;return(0,_.shadow)(this,"loadingParams",{disableAutoFetch:a,enableXfa:u})}}const et=Symbol("INITIAL_DATA");class m{#t=Object.create(null);#e(a){return this.#t[a]||={...Promise.withResolvers(),data:et}}get(a,u=null){if(u){const E=this.#e(a);return E.promise.then(()=>u(E.data)),null}const A=this.#t[a];if(!A||A.data===et)throw new Error(`Requesting object that isn't resolved yet ${a}.`);return A.data}has(a){const u=this.#t[a];return!!u&&u.data!==et}resolve(a,u=null){const A=this.#e(a);A.data=u,A.resolve()}clear(){for(const a in this.#t){const{data:u}=this.#t[a];u?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const a in this.#t){const{data:u}=this.#t[a];u!==et&&(yield[a,u])}}}class h{#t=null;constructor(a){this.#t=a,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(a=0){this.#t.cancel(null,a)}get separateAnnots(){const{separateAnnots:a}=this.#t.operatorList;if(!a)return!1;const{annotationCanvasMap:u}=this.#t;return a.form||a.canvas&&u?.size>0}}class e{static#t=new WeakSet;constructor({callback:a,params:u,objs:A,commonObjs:E,annotationCanvasMap:k,operatorList:R,pageIndex:D,canvasFactory:I,filterFactory:F,useRequestAnimationFrame:T=!1,pdfBug:U=!1,pageColors:K=null}){this.callback=a,this.params=u,this.objs=A,this.commonObjs=E,this.annotationCanvasMap=k,this.operatorListIdx=null,this.operatorList=R,this._pageIndex=D,this.canvasFactory=I,this.filterFactory=F,this._pdfBug=U,this.pageColors=K,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=T===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new h(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=u.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:a=!1,optionalContentConfig:u}){if(this.cancelled)return;if(this._canvas){if(e.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");e.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:A,viewport:E,transform:k,background:R}=this.params;this.gfx=new v.CanvasGraphics(A,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:u},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:k,viewport:E,transparency:a,background:R}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(a=null,u=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),e.#t.delete(this._canvas),this.callback(a||new P.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,u))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),e.#t.delete(this._canvas),this.callback())))}}const n="4.2.67",f="49b388101";z()}catch(S){z(S)}})},583:(ct,st,$)=>{$.d(st,{BaseCMapReaderFactory:()=>V,BaseCanvasFactory:()=>_,BaseFilterFactory:()=>z,BaseSVGFactory:()=>C,BaseStandardFontDataFactory:()=>P});var w=$(292);class z{constructor(){this.constructor===z&&(0,w.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(v){return"none"}addHCMFilter(v,r){return"none"}addHighlightHCMFilter(v,r,d,l,b){return"none"}destroy(v=!1){}}class _{constructor(){this.constructor===_&&(0,w.unreachable)("Cannot initialize BaseCanvasFactory.")}create(v,r){if(v<=0||r<=0)throw new Error("Invalid canvas size");const d=this._createCanvas(v,r);return{canvas:d,context:d.getContext("2d")}}reset(v,r,d){if(!v.canvas)throw new Error("Canvas is not specified");if(r<=0||d<=0)throw new Error("Invalid canvas size");v.canvas.width=r,v.canvas.height=d}destroy(v){if(!v.canvas)throw new Error("Canvas is not specified");v.canvas.width=0,v.canvas.height=0,v.canvas=null,v.context=null}_createCanvas(v,r){(0,w.unreachable)("Abstract method `_createCanvas` called.")}}class V{constructor({baseUrl:v=null,isCompressed:r=!0}){this.constructor===V&&(0,w.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=v,this.isCompressed=r}async fetch({name:v}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!v)throw new Error("CMap name must be specified.");const r=this.baseUrl+v+(this.isCompressed?".bcmap":""),d=this.isCompressed?w.CMapCompressionType.BINARY:w.CMapCompressionType.NONE;return this._fetchData(r,d).catch(l=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${r}`)})}_fetchData(v,r){(0,w.unreachable)("Abstract method `_fetchData` called.")}}class P{constructor({baseUrl:v=null}){this.constructor===P&&(0,w.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=v}async fetch({filename:v}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!v)throw new Error("Font filename must be specified.");const r=`${this.baseUrl}${v}`;return this._fetchData(r).catch(d=>{throw new Error(`Unable to load font data at: ${r}`)})}_fetchData(v){(0,w.unreachable)("Abstract method `_fetchData` called.")}}class C{constructor(){this.constructor===C&&(0,w.unreachable)("Cannot initialize BaseSVGFactory.")}create(v,r,d=!1){if(v<=0||r<=0)throw new Error("Invalid SVG dimensions");const l=this._createSVG("svg:svg");return l.setAttribute("version","1.1"),d||(l.setAttribute("width",`${v}px`),l.setAttribute("height",`${r}px`)),l.setAttribute("preserveAspectRatio","none"),l.setAttribute("viewBox",`0 0 ${v} ${r}`),l}createElement(v){if(typeof v!="string")throw new Error("Invalid SVG element type");return this._createSVG(v)}_createSVG(v){(0,w.unreachable)("Abstract method `_createSVG` called.")}}},923:(ct,st,$)=>{$.d(st,{CanvasGraphics:()=>m});var w=$(292),z=$(419);const _={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function V(h,e){if(!e)return;const n=e[2]-e[0],f=e[3]-e[1],o=new Path2D;o.rect(e[0],e[1],n,f),h.clip(o)}class P{constructor(){this.constructor===P&&(0,w.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,w.unreachable)("Abstract method `getPattern` called.")}}class C extends P{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let n;this._type==="axial"?n=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(n=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const f of this._colorStops)n.addColorStop(f[0],f[1]);return n}getPattern(e,n,f,o){let a;if(o===_.STROKE||o===_.FILL){const u=n.current.getClippedPathBoundingBox(o,(0,z.getCurrentTransform)(e))||[0,0,0,0],A=Math.ceil(u[2]-u[0])||1,E=Math.ceil(u[3]-u[1])||1,k=n.cachedCanvases.getCanvas("pattern",A,E,!0),R=k.context;R.clearRect(0,0,R.canvas.width,R.canvas.height),R.beginPath(),R.rect(0,0,R.canvas.width,R.canvas.height),R.translate(-u[0],-u[1]),f=w.Util.transform(f,[1,0,0,1,u[0],u[1]]),R.transform(...n.baseTransform),this.matrix&&R.transform(...this.matrix),V(R,this._bbox),R.fillStyle=this._createGradient(R),R.fill(),a=e.createPattern(k.canvas,"no-repeat");const D=new DOMMatrix(f);a.setTransform(D)}else V(e,this._bbox),a=this._createGradient(e);return a}}function x(h,e,n,f,o,a,u,A){const E=e.coords,k=e.colors,R=h.data,D=h.width*4;let I;E[n+1]>E[f+1]&&(I=n,n=f,f=I,I=a,a=u,u=I),E[f+1]>E[o+1]&&(I=f,f=o,o=I,I=u,u=A,A=I),E[n+1]>E[f+1]&&(I=n,n=f,f=I,I=a,a=u,u=I);const F=(E[n]+e.offsetX)*e.scaleX,T=(E[n+1]+e.offsetY)*e.scaleY,U=(E[f]+e.offsetX)*e.scaleX,K=(E[f+1]+e.offsetY)*e.scaleY,X=(E[o]+e.offsetX)*e.scaleX,W=(E[o+1]+e.offsetY)*e.scaleY;if(T>=W)return;const rt=k[a],J=k[a+1],Q=k[a+2],it=k[u],ht=k[u+1],gt=k[u+2],bt=k[A],At=k[A+1],mt=k[A+2],Ct=Math.round(T),St=Math.round(W);let Tt,vt,Et,kt,Lt,_t,Ht,Mt;for(let xt=Ct;xt<=St;xt++){if(xt<K){const yt=xt<T?0:(T-xt)/(T-K);Tt=F-(F-U)*yt,vt=rt-(rt-it)*yt,Et=J-(J-ht)*yt,kt=Q-(Q-gt)*yt}else{let yt;xt>W?yt=1:K===W?yt=0:yt=(K-xt)/(K-W),Tt=U-(U-X)*yt,vt=it-(it-bt)*yt,Et=ht-(ht-At)*yt,kt=gt-(gt-mt)*yt}let wt;xt<T?wt=0:xt>W?wt=1:wt=(T-xt)/(T-W),Lt=F-(F-X)*wt,_t=rt-(rt-bt)*wt,Ht=J-(J-At)*wt,Mt=Q-(Q-mt)*wt;const Bt=Math.round(Math.min(Tt,Lt)),Dt=Math.round(Math.max(Tt,Lt));let It=D*xt+Bt*4;for(let yt=Bt;yt<=Dt;yt++)wt=(Tt-yt)/(Tt-Lt),wt<0?wt=0:wt>1&&(wt=1),R[It++]=vt-(vt-_t)*wt|0,R[It++]=Et-(Et-Ht)*wt|0,R[It++]=kt-(kt-Mt)*wt|0,R[It++]=255}}function v(h,e,n){const f=e.coords,o=e.colors;let a,u;switch(e.type){case"lattice":const A=e.verticesPerRow,E=Math.floor(f.length/A)-1,k=A-1;for(a=0;a<E;a++){let R=a*A;for(let D=0;D<k;D++,R++)x(h,n,f[R],f[R+1],f[R+A],o[R],o[R+1],o[R+A]),x(h,n,f[R+A+1],f[R+1],f[R+A],o[R+A+1],o[R+1],o[R+A])}break;case"triangles":for(a=0,u=f.length;a<u;a+=3)x(h,n,f[a],f[a+1],f[a+2],o[a],o[a+1],o[a+2]);break;default:throw new Error("illegal figure")}}class r extends P{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,n,f){const A=Math.floor(this._bounds[0]),E=Math.floor(this._bounds[1]),k=Math.ceil(this._bounds[2])-A,R=Math.ceil(this._bounds[3])-E,D=Math.min(Math.ceil(Math.abs(k*e[0]*1.1)),3e3),I=Math.min(Math.ceil(Math.abs(R*e[1]*1.1)),3e3),F=k/D,T=R/I,U={coords:this._coords,colors:this._colors,offsetX:-A,offsetY:-E,scaleX:1/F,scaleY:1/T},K=D+2*2,X=I+2*2,W=f.getCanvas("mesh",K,X,!1),rt=W.context,J=rt.createImageData(D,I);if(n){const it=J.data;for(let ht=0,gt=it.length;ht<gt;ht+=4)it[ht]=n[0],it[ht+1]=n[1],it[ht+2]=n[2],it[ht+3]=255}for(const it of this._figures)v(J,it,U);return rt.putImageData(J,2,2),{canvas:W.canvas,offsetX:A-2*F,offsetY:E-2*T,scaleX:F,scaleY:T}}getPattern(e,n,f,o){V(e,this._bbox);let a;if(o===_.SHADING)a=w.Util.singularValueDecompose2dScale((0,z.getCurrentTransform)(e));else if(a=w.Util.singularValueDecompose2dScale(n.baseTransform),this.matrix){const A=w.Util.singularValueDecompose2dScale(this.matrix);a=[a[0]*A[0],a[1]*A[1]]}const u=this._createMeshCanvas(a,o===_.SHADING?null:this._background,n.cachedCanvases);return o!==_.SHADING&&(e.setTransform(...n.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(u.offsetX,u.offsetY),e.scale(u.scaleX,u.scaleY),e.createPattern(u.canvas,"no-repeat")}}class d extends P{getPattern(){return"hotpink"}}function l(h){switch(h[0]){case"RadialAxial":return new C(h);case"Mesh":return new r(h);case"Dummy":return new d}throw new Error(`Unknown IR type: ${h[0]}`)}const b={COLORED:1,UNCOLORED:2};class s{static MAX_PATTERN_SIZE=3e3;constructor(e,n,f,o,a){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=n,this.ctx=f,this.canvasGraphicsFactory=o,this.baseTransform=a}createPatternCanvas(e){const n=this.operatorList,f=this.bbox,o=this.xstep,a=this.ystep,u=this.paintType,A=this.tilingType,E=this.color,k=this.canvasGraphicsFactory;(0,w.info)("TilingType: "+A);const R=f[0],D=f[1],I=f[2],F=f[3],T=w.Util.singularValueDecompose2dScale(this.matrix),U=w.Util.singularValueDecompose2dScale(this.baseTransform),K=[T[0]*U[0],T[1]*U[1]],X=this.getSizeAndScale(o,this.ctx.canvas.width,K[0]),W=this.getSizeAndScale(a,this.ctx.canvas.height,K[1]),rt=e.cachedCanvases.getCanvas("pattern",X.size,W.size,!0),J=rt.context,Q=k.createCanvasGraphics(J);Q.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(Q,u,E);let it=R,ht=D,gt=I,bt=F;return R<0&&(it=0,gt+=Math.abs(R)),D<0&&(ht=0,bt+=Math.abs(D)),J.translate(-(X.scale*it),-(W.scale*ht)),Q.transform(X.scale,0,0,W.scale,0,0),J.save(),this.clipBbox(Q,it,ht,gt,bt),Q.baseTransform=(0,z.getCurrentTransform)(Q.ctx),Q.executeOperatorList(n),Q.endDrawing(),{canvas:rt.canvas,scaleX:X.scale,scaleY:W.scale,offsetX:it,offsetY:ht}}getSizeAndScale(e,n,f){e=Math.abs(e);const o=Math.max(s.MAX_PATTERN_SIZE,n);let a=Math.ceil(e*f);return a>=o?a=o:f=a/e,{scale:f,size:a}}clipBbox(e,n,f,o,a){const u=o-n,A=a-f;e.ctx.rect(n,f,u,A),e.current.updateRectMinMax((0,z.getCurrentTransform)(e.ctx),[n,f,o,a]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,n,f){const o=e.ctx,a=e.current;switch(n){case b.COLORED:const u=this.ctx;o.fillStyle=u.fillStyle,o.strokeStyle=u.strokeStyle,a.fillColor=u.fillStyle,a.strokeColor=u.strokeStyle;break;case b.UNCOLORED:const A=w.Util.makeHexColor(f[0],f[1],f[2]);o.fillStyle=A,o.strokeStyle=A,a.fillColor=A,a.strokeColor=A;break;default:throw new w.FormatError(`Unsupported paint type: ${n}`)}}getPattern(e,n,f,o){let a=f;o!==_.SHADING&&(a=w.Util.transform(a,n.baseTransform),this.matrix&&(a=w.Util.transform(a,this.matrix)));const u=this.createPatternCanvas(n);let A=new DOMMatrix(a);A=A.translate(u.offsetX,u.offsetY),A=A.scale(1/u.scaleX,1/u.scaleY);const E=e.createPattern(u.canvas,"repeat");return E.setTransform(A),E}}function g({src:h,srcPos:e=0,dest:n,width:f,height:o,nonBlackColor:a=4294967295,inverseDecode:u=!1}){const A=w.FeatureTest.isLittleEndian?4278190080:255,[E,k]=u?[a,A]:[A,a],R=f>>3,D=f&7,I=h.length;n=new Uint32Array(n.buffer);let F=0;for(let T=0;T<o;T++){for(const K=e+R;e<K;e++){const X=e<I?h[e]:255;n[F++]=X&128?k:E,n[F++]=X&64?k:E,n[F++]=X&32?k:E,n[F++]=X&16?k:E,n[F++]=X&8?k:E,n[F++]=X&4?k:E,n[F++]=X&2?k:E,n[F++]=X&1?k:E}if(D===0)continue;const U=e<I?h[e++]:255;for(let K=0;K<D;K++)n[F++]=U&1<<7-K?k:E}return{srcPos:e,destPos:F}}const t=16,i=100,c=4096,p=15,y=10,S=1e3,L=16;function M(h,e){if(h._removeMirroring)throw new Error("Context is already forwarding operations.");h.__originalSave=h.save,h.__originalRestore=h.restore,h.__originalRotate=h.rotate,h.__originalScale=h.scale,h.__originalTranslate=h.translate,h.__originalTransform=h.transform,h.__originalSetTransform=h.setTransform,h.__originalResetTransform=h.resetTransform,h.__originalClip=h.clip,h.__originalMoveTo=h.moveTo,h.__originalLineTo=h.lineTo,h.__originalBezierCurveTo=h.bezierCurveTo,h.__originalRect=h.rect,h.__originalClosePath=h.closePath,h.__originalBeginPath=h.beginPath,h._removeMirroring=()=>{h.save=h.__originalSave,h.restore=h.__originalRestore,h.rotate=h.__originalRotate,h.scale=h.__originalScale,h.translate=h.__originalTranslate,h.transform=h.__originalTransform,h.setTransform=h.__originalSetTransform,h.resetTransform=h.__originalResetTransform,h.clip=h.__originalClip,h.moveTo=h.__originalMoveTo,h.lineTo=h.__originalLineTo,h.bezierCurveTo=h.__originalBezierCurveTo,h.rect=h.__originalRect,h.closePath=h.__originalClosePath,h.beginPath=h.__originalBeginPath,delete h._removeMirroring},h.save=function(){e.save(),this.__originalSave()},h.restore=function(){e.restore(),this.__originalRestore()},h.translate=function(f,o){e.translate(f,o),this.__originalTranslate(f,o)},h.scale=function(f,o){e.scale(f,o),this.__originalScale(f,o)},h.transform=function(f,o,a,u,A,E){e.transform(f,o,a,u,A,E),this.__originalTransform(f,o,a,u,A,E)},h.setTransform=function(f,o,a,u,A,E){e.setTransform(f,o,a,u,A,E),this.__originalSetTransform(f,o,a,u,A,E)},h.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},h.rotate=function(f){e.rotate(f),this.__originalRotate(f)},h.clip=function(f){e.clip(f),this.__originalClip(f)},h.moveTo=function(n,f){e.moveTo(n,f),this.__originalMoveTo(n,f)},h.lineTo=function(n,f){e.lineTo(n,f),this.__originalLineTo(n,f)},h.bezierCurveTo=function(n,f,o,a,u,A){e.bezierCurveTo(n,f,o,a,u,A),this.__originalBezierCurveTo(n,f,o,a,u,A)},h.rect=function(n,f,o,a){e.rect(n,f,o,a),this.__originalRect(n,f,o,a)},h.closePath=function(){e.closePath(),this.__originalClosePath()},h.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class O{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,n,f){let o;return this.cache[e]!==void 0?(o=this.cache[e],this.canvasFactory.reset(o,n,f)):(o=this.canvasFactory.create(n,f),this.cache[e]=o),o}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const n=this.cache[e];this.canvasFactory.destroy(n),delete this.cache[e]}}}function N(h,e,n,f,o,a,u,A,E,k){const[R,D,I,F,T,U]=(0,z.getCurrentTransform)(h);if(D===0&&I===0){const W=u*R+T,rt=Math.round(W),J=A*F+U,Q=Math.round(J),it=(u+E)*R+T,ht=Math.abs(Math.round(it)-rt)||1,gt=(A+k)*F+U,bt=Math.abs(Math.round(gt)-Q)||1;return h.setTransform(Math.sign(R),0,0,Math.sign(F),rt,Q),h.drawImage(e,n,f,o,a,0,0,ht,bt),h.setTransform(R,D,I,F,T,U),[ht,bt]}if(R===0&&F===0){const W=A*I+T,rt=Math.round(W),J=u*D+U,Q=Math.round(J),it=(A+k)*I+T,ht=Math.abs(Math.round(it)-rt)||1,gt=(u+E)*D+U,bt=Math.abs(Math.round(gt)-Q)||1;return h.setTransform(0,Math.sign(D),Math.sign(I),0,rt,Q),h.drawImage(e,n,f,o,a,0,0,bt,ht),h.setTransform(R,D,I,F,T,U),[bt,ht]}h.drawImage(e,n,f,o,a,u,A,E,k);const K=Math.hypot(R,D),X=Math.hypot(I,F);return[K*E,X*k]}function B(h){const{width:e,height:n}=h;if(e>S||n>S)return null;const f=1e3,o=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),a=e+1;let u=new Uint8Array(a*(n+1)),A,E,k;const R=e+7&-8;let D=new Uint8Array(R*n),I=0;for(const X of h.data){let W=128;for(;W>0;)D[I++]=X&W?0:255,W>>=1}let F=0;for(I=0,D[I]!==0&&(u[0]=1,++F),E=1;E<e;E++)D[I]!==D[I+1]&&(u[E]=D[I]?2:1,++F),I++;for(D[I]!==0&&(u[E]=2,++F),A=1;A<n;A++){I=A*R,k=A*a,D[I-R]!==D[I]&&(u[k]=D[I]?1:8,++F);let X=(D[I]?4:0)+(D[I-R]?8:0);for(E=1;E<e;E++)X=(X>>2)+(D[I+1]?4:0)+(D[I-R+1]?8:0),o[X]&&(u[k+E]=o[X],++F),I++;if(D[I-R]!==D[I]&&(u[k+E]=D[I]?2:4,++F),F>f)return null}for(I=R*(n-1),k=A*a,D[I]!==0&&(u[k]=8,++F),E=1;E<e;E++)D[I]!==D[I+1]&&(u[k+E]=D[I]?4:8,++F),I++;if(D[I]!==0&&(u[k+E]=4,++F),F>f)return null;const T=new Int32Array([0,a,-1,0,-a,0,0,0,1]),U=new Path2D;for(A=0;F&&A<=n;A++){let X=A*a;const W=X+e;for(;X<W&&!u[X];)X++;if(X===W)continue;U.moveTo(X%a,A);const rt=X;let J=u[X];do{const Q=T[J];do X+=Q;while(!u[X]);const it=u[X];it!==5&&it!==10?(J=it,u[X]=0):(J=it&51*J>>4,u[X]&=J>>2|J<<2),U.lineTo(X%a,X/a|0),u[X]||--F}while(rt!==X);--A}return D=null,u=null,function(X){X.save(),X.scale(1/e,-1/n),X.translate(0,-n),X.fill(U),X.beginPath(),X.restore()}}class q{constructor(e,n){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=w.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=w.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=w.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,n])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,n){this.x=e,this.y=n}updatePathMinMax(e,n,f){[n,f]=w.Util.applyTransform([n,f],e),this.minX=Math.min(this.minX,n),this.minY=Math.min(this.minY,f),this.maxX=Math.max(this.maxX,n),this.maxY=Math.max(this.maxY,f)}updateRectMinMax(e,n){const f=w.Util.applyTransform(n,e),o=w.Util.applyTransform(n.slice(2),e),a=w.Util.applyTransform([n[0],n[3]],e),u=w.Util.applyTransform([n[2],n[1]],e);this.minX=Math.min(this.minX,f[0],o[0],a[0],u[0]),this.minY=Math.min(this.minY,f[1],o[1],a[1],u[1]),this.maxX=Math.max(this.maxX,f[0],o[0],a[0],u[0]),this.maxY=Math.max(this.maxY,f[1],o[1],a[1],u[1])}updateScalingPathMinMax(e,n){w.Util.scaleMinMax(e,n),this.minX=Math.min(this.minX,n[0]),this.minY=Math.min(this.minY,n[1]),this.maxX=Math.max(this.maxX,n[2]),this.maxY=Math.max(this.maxY,n[3])}updateCurvePathMinMax(e,n,f,o,a,u,A,E,k,R){const D=w.Util.bezierBoundingBox(n,f,o,a,u,A,E,k,R);R||this.updateRectMinMax(e,D)}getPathBoundingBox(e=_.FILL,n=null){const f=[this.minX,this.minY,this.maxX,this.maxY];if(e===_.STROKE){n||(0,w.unreachable)("Stroke bounding box must include transform.");const o=w.Util.singularValueDecompose2dScale(n),a=o[0]*this.lineWidth/2,u=o[1]*this.lineWidth/2;f[0]-=a,f[1]-=u,f[2]+=a,f[3]+=u}return f}updateClipFromPath(){const e=w.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=_.FILL,n=null){return w.Util.intersect(this.clipBox,this.getPathBoundingBox(e,n))}}function nt(h,e){if(typeof ImageData<"u"&&e instanceof ImageData){h.putImageData(e,0,0);return}const n=e.height,f=e.width,o=n%L,a=(n-o)/L,u=o===0?a:a+1,A=h.createImageData(f,L);let E=0,k;const R=e.data,D=A.data;let I,F,T,U;if(e.kind===w.ImageKind.GRAYSCALE_1BPP){const K=R.byteLength,X=new Uint32Array(D.buffer,0,D.byteLength>>2),W=X.length,rt=f+7>>3,J=4294967295,Q=w.FeatureTest.isLittleEndian?4278190080:255;for(I=0;I<u;I++){for(T=I<a?L:o,k=0,F=0;F<T;F++){const it=K-E;let ht=0;const gt=it>rt?f:it*8-7,bt=gt&-8;let At=0,mt=0;for(;ht<bt;ht+=8)mt=R[E++],X[k++]=mt&128?J:Q,X[k++]=mt&64?J:Q,X[k++]=mt&32?J:Q,X[k++]=mt&16?J:Q,X[k++]=mt&8?J:Q,X[k++]=mt&4?J:Q,X[k++]=mt&2?J:Q,X[k++]=mt&1?J:Q;for(;ht<gt;ht++)At===0&&(mt=R[E++],At=128),X[k++]=mt&At?J:Q,At>>=1}for(;k<W;)X[k++]=0;h.putImageData(A,0,I*L)}}else if(e.kind===w.ImageKind.RGBA_32BPP){for(F=0,U=f*L*4,I=0;I<a;I++)D.set(R.subarray(E,E+U)),E+=U,h.putImageData(A,0,F),F+=L;I<u&&(U=f*o*4,D.set(R.subarray(E,E+U)),h.putImageData(A,0,F))}else if(e.kind===w.ImageKind.RGB_24BPP)for(T=L,U=f*T,I=0;I<u;I++){for(I>=a&&(T=o,U=f*T),k=0,F=U;F--;)D[k++]=R[E++],D[k++]=R[E++],D[k++]=R[E++],D[k++]=255;h.putImageData(A,0,I*L)}else throw new Error(`bad image kind: ${e.kind}`)}function j(h,e){if(e.bitmap){h.drawImage(e.bitmap,0,0);return}const n=e.height,f=e.width,o=n%L,a=(n-o)/L,u=o===0?a:a+1,A=h.createImageData(f,L);let E=0;const k=e.data,R=A.data;for(let D=0;D<u;D++){const I=D<a?L:o;({srcPos:E}=g({src:k,srcPos:E,dest:R,width:f,height:I,nonBlackColor:0})),h.putImageData(A,0,D*L)}}function H(h,e){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const f of n)h[f]!==void 0&&(e[f]=h[f]);h.setLineDash!==void 0&&(e.setLineDash(h.getLineDash()),e.lineDashOffset=h.lineDashOffset)}function G(h){if(h.strokeStyle=h.fillStyle="#000000",h.fillRule="nonzero",h.globalAlpha=1,h.lineWidth=1,h.lineCap="butt",h.lineJoin="miter",h.miterLimit=10,h.globalCompositeOperation="source-over",h.font="10px sans-serif",h.setLineDash!==void 0&&(h.setLineDash([]),h.lineDashOffset=0),!w.isNodeJS){const{filter:e}=h;e!=="none"&&e!==""&&(h.filter="none")}}function Y(h,e,n,f){const o=h.length;for(let a=3;a<o;a+=4){const u=h[a];if(u===0)h[a-3]=e,h[a-2]=n,h[a-1]=f;else if(u<255){const A=255-u;h[a-3]=h[a-3]*u+e*A>>8,h[a-2]=h[a-2]*u+n*A>>8,h[a-1]=h[a-1]*u+f*A>>8}}}function tt(h,e,n){const f=h.length,o=1/255;for(let a=3;a<f;a+=4){const u=n?n[h[a]]:h[a];e[a]=e[a]*u*o|0}}function Z(h,e,n){const f=h.length;for(let o=3;o<f;o+=4){const a=h[o-3]*77+h[o-2]*152+h[o-1]*28;e[o]=n?e[o]*n[a>>8]>>8:e[o]*a>>16}}function at(h,e,n,f,o,a,u,A,E,k,R){const D=!!a,I=D?a[0]:0,F=D?a[1]:0,T=D?a[2]:0,U=o==="Luminosity"?Z:tt,X=Math.min(f,Math.ceil(1048576/n));for(let W=0;W<f;W+=X){const rt=Math.min(X,f-W),J=h.getImageData(A-k,W+(E-R),n,rt),Q=e.getImageData(A,W+E,n,rt);D&&Y(J.data,I,F,T),U(J.data,Q.data,u),e.putImageData(Q,A,W+E)}}function lt(h,e,n,f){const o=f[0],a=f[1],u=f[2]-o,A=f[3]-a;u===0||A===0||(at(e.context,n,u,A,e.subtype,e.backdrop,e.transferMap,o,a,e.offsetX,e.offsetY),h.save(),h.globalAlpha=1,h.globalCompositeOperation="source-over",h.setTransform(1,0,0,1,0,0),h.drawImage(n.canvas,0,0),h.restore())}function pt(h,e){if(e)return!0;const n=w.Util.singularValueDecompose2dScale(h);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const f=Math.fround((globalThis.devicePixelRatio||1)*z.PixelsPerInch.PDF_TO_CSS_UNITS);return n[0]<=f&&n[1]<=f}const dt=["butt","round","square"],ot=["miter","round","bevel"],ut={},et={};class m{constructor(e,n,f,o,a,{optionalContentConfig:u,markedContentStack:A=null},E,k){this.ctx=e,this.current=new q(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=n,this.objs=f,this.canvasFactory=o,this.filterFactory=a,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=A||[],this.optionalContentConfig=u,this.cachedCanvases=new O(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=E,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=k,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,n=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):n}beginDrawing({transform:e,viewport:n,transparency:f=!1,background:o=null}){const a=this.ctx.canvas.width,u=this.ctx.canvas.height,A=this.ctx.fillStyle;if(this.ctx.fillStyle=o||"#ffffff",this.ctx.fillRect(0,0,a,u),this.ctx.fillStyle=A,f){const E=this.cachedCanvases.getCanvas("transparent",a,u);this.compositeCtx=this.ctx,this.transparentCanvas=E.canvas,this.ctx=E.context,this.ctx.save(),this.ctx.transform(...(0,z.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),G(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=(0,z.getCurrentTransform)(this.ctx)}executeOperatorList(e,n,f,o){const a=e.argsArray,u=e.fnArray;let A=n||0;const E=a.length;if(E===A)return A;const k=E-A>y&&typeof f=="function",R=k?Date.now()+p:0;let D=0;const I=this.commonObjs,F=this.objs;let T;for(;;){if(o!==void 0&&A===o.nextBreakPoint)return o.breakIt(A,f),A;if(T=u[A],T!==w.OPS.dependency)this[T].apply(this,a[A]);else for(const U of a[A]){const K=U.startsWith("g_")?I:F;if(!K.has(U))return K.get(U,f),A}if(A++,A===E)return A;if(k&&++D>y){if(Date.now()>R)return f(),A;D=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const n of e.values())typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&(n.width=n.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const n=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=n}}}_scaleImage(e,n){const f=e.width,o=e.height;let a=Math.max(Math.hypot(n[0],n[1]),1),u=Math.max(Math.hypot(n[2],n[3]),1),A=f,E=o,k="prescale1",R,D;for(;a>2&&A>1||u>2&&E>1;){let I=A,F=E;a>2&&A>1&&(I=A>=16384?Math.floor(A/2)-1||1:Math.ceil(A/2),a/=A/I),u>2&&E>1&&(F=E>=16384?Math.floor(E/2)-1||1:Math.ceil(E)/2,u/=E/F),R=this.cachedCanvases.getCanvas(k,I,F),D=R.context,D.clearRect(0,0,I,F),D.drawImage(e,0,0,A,E,0,0,I,F),e=R.canvas,A=I,E=F,k=k==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:A,paintHeight:E}}_createMaskCanvas(e){const n=this.ctx,{width:f,height:o}=e,a=this.current.fillColor,u=this.current.patternFill,A=(0,z.getCurrentTransform)(n);let E,k,R,D;if((e.bitmap||e.data)&&e.count>1){const gt=e.bitmap||e.data.buffer;k=JSON.stringify(u?A:[A.slice(0,4),a]),E=this._cachedBitmapsMap.get(gt),E||(E=new Map,this._cachedBitmapsMap.set(gt,E));const bt=E.get(k);if(bt&&!u){const At=Math.round(Math.min(A[0],A[2])+A[4]),mt=Math.round(Math.min(A[1],A[3])+A[5]);return{canvas:bt,offsetX:At,offsetY:mt}}R=bt}R||(D=this.cachedCanvases.getCanvas("maskCanvas",f,o),j(D.context,e));let I=w.Util.transform(A,[1/f,0,0,-1/o,0,0]);I=w.Util.transform(I,[1,0,0,1,0,-o]);const[F,T,U,K]=w.Util.getAxialAlignedBoundingBox([0,0,f,o],I),X=Math.round(U-F)||1,W=Math.round(K-T)||1,rt=this.cachedCanvases.getCanvas("fillCanvas",X,W),J=rt.context,Q=F,it=T;J.translate(-Q,-it),J.transform(...I),R||(R=this._scaleImage(D.canvas,(0,z.getCurrentTransformInverse)(J)),R=R.img,E&&u&&E.set(k,R)),J.imageSmoothingEnabled=pt((0,z.getCurrentTransform)(J),e.interpolate),N(J,R,0,0,R.width,R.height,0,0,f,o),J.globalCompositeOperation="source-in";const ht=w.Util.transform((0,z.getCurrentTransformInverse)(J),[1,0,0,1,-Q,-it]);return J.fillStyle=u?a.getPattern(n,this,ht,_.FILL):a,J.fillRect(0,0,f,o),E&&!u&&(this.cachedCanvases.delete("fillCanvas"),E.set(k,rt.canvas)),{canvas:rt.canvas,offsetX:Math.round(Q),offsetY:Math.round(it)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=dt[e]}setLineJoin(e){this.ctx.lineJoin=ot[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,n){const f=this.ctx;f.setLineDash!==void 0&&(f.setLineDash(e),f.lineDashOffset=n)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[n,f]of e)switch(n){case"LW":this.setLineWidth(f);break;case"LC":this.setLineCap(f);break;case"LJ":this.setLineJoin(f);break;case"ML":this.setMiterLimit(f);break;case"D":this.setDash(f[0],f[1]);break;case"RI":this.setRenderingIntent(f);break;case"FL":this.setFlatness(f);break;case"Font":this.setFont(f[0],f[1]);break;case"CA":this.current.strokeAlpha=f;break;case"ca":this.current.fillAlpha=f,this.ctx.globalAlpha=f;break;case"BM":this.ctx.globalCompositeOperation=f;break;case"SMask":this.current.activeSMask=f?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(f);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,f="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(f,e,n);this.suspendedCtx=this.ctx,this.ctx=o.context;const a=this.ctx;a.setTransform(...(0,z.getCurrentTransform)(this.suspendedCtx)),H(this.suspendedCtx,a),M(a,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),H(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const n=this.current.activeSMask,f=this.suspendedCtx;lt(f,n,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(H(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),H(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,n,f,o,a,u){this.ctx.transform(e,n,f,o,a,u),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,n,f){const o=this.ctx,a=this.current;let u=a.x,A=a.y,E,k;const R=(0,z.getCurrentTransform)(o),D=R[0]===0&&R[3]===0||R[1]===0&&R[2]===0,I=D?f.slice(0):null;for(let F=0,T=0,U=e.length;F<U;F++)switch(e[F]|0){case w.OPS.rectangle:u=n[T++],A=n[T++];const K=n[T++],X=n[T++],W=u+K,rt=A+X;o.moveTo(u,A),K===0||X===0?o.lineTo(W,rt):(o.lineTo(W,A),o.lineTo(W,rt),o.lineTo(u,rt)),D||a.updateRectMinMax(R,[u,A,W,rt]),o.closePath();break;case w.OPS.moveTo:u=n[T++],A=n[T++],o.moveTo(u,A),D||a.updatePathMinMax(R,u,A);break;case w.OPS.lineTo:u=n[T++],A=n[T++],o.lineTo(u,A),D||a.updatePathMinMax(R,u,A);break;case w.OPS.curveTo:E=u,k=A,u=n[T+4],A=n[T+5],o.bezierCurveTo(n[T],n[T+1],n[T+2],n[T+3],u,A),a.updateCurvePathMinMax(R,E,k,n[T],n[T+1],n[T+2],n[T+3],u,A,I),T+=6;break;case w.OPS.curveTo2:E=u,k=A,o.bezierCurveTo(u,A,n[T],n[T+1],n[T+2],n[T+3]),a.updateCurvePathMinMax(R,E,k,u,A,n[T],n[T+1],n[T+2],n[T+3],I),u=n[T+2],A=n[T+3],T+=4;break;case w.OPS.curveTo3:E=u,k=A,u=n[T+2],A=n[T+3],o.bezierCurveTo(n[T],n[T+1],u,A,u,A),a.updateCurvePathMinMax(R,E,k,n[T],n[T+1],u,A,u,A,I),T+=4;break;case w.OPS.closePath:o.closePath();break}D&&a.updateScalingPathMinMax(R,I),a.setCurrentPoint(u,A)}closePath(){this.ctx.closePath()}stroke(e=!0){const n=this.ctx,f=this.current.strokeColor;n.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof f=="object"&&f?.getPattern?(n.save(),n.strokeStyle=f.getPattern(n,this,(0,z.getCurrentTransformInverse)(n),_.STROKE),this.rescaleAndStroke(!1),n.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),n.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const n=this.ctx,f=this.current.fillColor,o=this.current.patternFill;let a=!1;o&&(n.save(),n.fillStyle=f.getPattern(n,this,(0,z.getCurrentTransformInverse)(n),_.FILL),a=!0);const u=this.current.getClippedPathBoundingBox();this.contentVisible&&u!==null&&(this.pendingEOFill?(n.fill("evenodd"),this.pendingEOFill=!1):n.fill()),a&&n.restore(),e&&this.consumePath(u)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ut}eoClip(){this.pendingClip=et}beginText(){this.current.textMatrix=w.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,n=this.ctx;if(e===void 0){n.beginPath();return}n.save(),n.beginPath();for(const f of e)n.setTransform(...f.transform),n.translate(f.x,f.y),f.addToPath(n,f.fontSize);n.restore(),n.clip(),n.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,n){const f=this.commonObjs.get(e),o=this.current;if(!f)throw new Error(`Can't find font for ${e}`);if(o.fontMatrix=f.fontMatrix||w.FONT_IDENTITY_MATRIX,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&(0,w.warn)("Invalid font matrix for font "+e),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=f,this.current.fontSize=n,f.isType3Font)return;const a=f.loadedName||"sans-serif",u=f.systemFontInfo?.css||`"${a}", ${f.fallbackName}`;let A="normal";f.black?A="900":f.bold&&(A="bold");const E=f.italic?"italic":"normal";let k=n;n<t?k=t:n>i&&(k=i),this.current.fontSizeScale=n/k,this.ctx.font=`${E} ${A} ${k}px ${u}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,n){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,n){this.setLeading(-n),this.moveText(e,n)}setTextMatrix(e,n,f,o,a,u){this.current.textMatrix=[e,n,f,o,a,u],this.current.textMatrixScale=Math.hypot(e,n),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,n,f,o){const a=this.ctx,u=this.current,A=u.font,E=u.textRenderingMode,k=u.fontSize/u.fontSizeScale,R=E&w.TextRenderingMode.FILL_STROKE_MASK,D=!!(E&w.TextRenderingMode.ADD_TO_PATH_FLAG),I=u.patternFill&&!A.missingFile;let F;(A.disableFontFace||D||I)&&(F=A.getPathGenerator(this.commonObjs,e)),A.disableFontFace||I?(a.save(),a.translate(n,f),a.beginPath(),F(a,k),o&&a.setTransform(...o),(R===w.TextRenderingMode.FILL||R===w.TextRenderingMode.FILL_STROKE)&&a.fill(),(R===w.TextRenderingMode.STROKE||R===w.TextRenderingMode.FILL_STROKE)&&a.stroke(),a.restore()):((R===w.TextRenderingMode.FILL||R===w.TextRenderingMode.FILL_STROKE)&&a.fillText(e,n,f),(R===w.TextRenderingMode.STROKE||R===w.TextRenderingMode.FILL_STROKE)&&a.strokeText(e,n,f)),D&&(this.pendingTextPaths||=[]).push({transform:(0,z.getCurrentTransform)(a),x:n,y:f,fontSize:k,addToPath:F})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const n=e.getImageData(0,0,10,10).data;let f=!1;for(let o=3;o<n.length;o+=4)if(n[o]>0&&n[o]<255){f=!0;break}return(0,w.shadow)(this,"isFontSubpixelAAEnabled",f)}showText(e){const n=this.current,f=n.font;if(f.isType3Font)return this.showType3Text(e);const o=n.fontSize;if(o===0)return;const a=this.ctx,u=n.fontSizeScale,A=n.charSpacing,E=n.wordSpacing,k=n.fontDirection,R=n.textHScale*k,D=e.length,I=f.vertical,F=I?1:-1,T=f.defaultVMetrics,U=o*n.fontMatrix[0],K=n.textRenderingMode===w.TextRenderingMode.FILL&&!f.disableFontFace&&!n.patternFill;a.save(),a.transform(...n.textMatrix),a.translate(n.x,n.y+n.textRise),k>0?a.scale(R,-1):a.scale(R,1);let X;if(n.patternFill){a.save();const it=n.fillColor.getPattern(a,this,(0,z.getCurrentTransformInverse)(a),_.FILL);X=(0,z.getCurrentTransform)(a),a.restore(),a.fillStyle=it}let W=n.lineWidth;const rt=n.textMatrixScale;if(rt===0||W===0){const it=n.textRenderingMode&w.TextRenderingMode.FILL_STROKE_MASK;(it===w.TextRenderingMode.STROKE||it===w.TextRenderingMode.FILL_STROKE)&&(W=this.getSinglePixelWidth())}else W/=rt;if(u!==1&&(a.scale(u,u),W/=u),a.lineWidth=W,f.isInvalidPDFjsFont){const it=[];let ht=0;for(const gt of e)it.push(gt.unicode),ht+=gt.width;a.fillText(it.join(""),0,0),n.x+=ht*U*R,a.restore(),this.compose();return}let J=0,Q;for(Q=0;Q<D;++Q){const it=e[Q];if(typeof it=="number"){J+=F*it*o/1e3;continue}let ht=!1;const gt=(it.isSpace?E:0)+A,bt=it.fontChar,At=it.accent;let mt,Ct,St=it.width;if(I){const vt=it.vmetric||T,Et=-(it.vmetric?vt[1]:St*.5)*U,kt=vt[2]*U;St=vt?-vt[0]:St,mt=Et/u,Ct=(J+kt)/u}else mt=J/u,Ct=0;if(f.remeasure&&St>0){const vt=a.measureText(bt).width*1e3/o*u;if(St<vt&&this.isFontSubpixelAAEnabled){const Et=St/vt;ht=!0,a.save(),a.scale(Et,1),mt/=Et}else St!==vt&&(mt+=(St-vt)/2e3*o/u)}if(this.contentVisible&&(it.isInFont||f.missingFile)){if(K&&!At)a.fillText(bt,mt,Ct);else if(this.paintChar(bt,mt,Ct,X),At){const vt=mt+o*At.offset.x/u,Et=Ct-o*At.offset.y/u;this.paintChar(At.fontChar,vt,Et,X)}}const Tt=I?St*U-gt*k:St*U+gt*k;J+=Tt,ht&&a.restore()}I?n.y-=J:n.x+=J*R,a.restore(),this.compose()}showType3Text(e){const n=this.ctx,f=this.current,o=f.font,a=f.fontSize,u=f.fontDirection,A=o.vertical?1:-1,E=f.charSpacing,k=f.wordSpacing,R=f.textHScale*u,D=f.fontMatrix||w.FONT_IDENTITY_MATRIX,I=e.length,F=f.textRenderingMode===w.TextRenderingMode.INVISIBLE;let T,U,K,X;if(!(F||a===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),n.transform(...f.textMatrix),n.translate(f.x,f.y),n.scale(R,u),T=0;T<I;++T){if(U=e[T],typeof U=="number"){X=A*U*a/1e3,this.ctx.translate(X,0),f.x+=X*R;continue}const W=(U.isSpace?k:0)+E,rt=o.charProcOperatorList[U.operatorListId];if(!rt){(0,w.warn)(`Type3 character "${U.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=U,this.save(),n.scale(a,a),n.transform(...D),this.executeOperatorList(rt),this.restore()),K=w.Util.applyTransform([U.width,0],D)[0]*a+W,n.translate(K,0),f.x+=K*R}n.restore(),this.processingType3=null}}setCharWidth(e,n){}setCharWidthAndBounds(e,n,f,o,a,u){this.ctx.rect(f,o,a-f,u-o),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let n;if(e[0]==="TilingPattern"){const f=e[1],o=this.baseTransform||(0,z.getCurrentTransform)(this.ctx),a={createCanvasGraphics:u=>new m(u,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};n=new s(e,f,this.ctx,a,o)}else n=this._getPattern(e[1],e[2]);return n}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,n,f){const o=w.Util.makeHexColor(e,n,f);this.ctx.strokeStyle=o,this.current.strokeColor=o}setFillRGBColor(e,n,f){const o=w.Util.makeHexColor(e,n,f);this.ctx.fillStyle=o,this.current.fillColor=o,this.current.patternFill=!1}_getPattern(e,n=null){let f;return this.cachedPatterns.has(e)?f=this.cachedPatterns.get(e):(f=l(this.getObject(e)),this.cachedPatterns.set(e,f)),n&&(f.matrix=n),f}shadingFill(e){if(!this.contentVisible)return;const n=this.ctx;this.save();const f=this._getPattern(e);n.fillStyle=f.getPattern(n,this,(0,z.getCurrentTransformInverse)(n),_.SHADING);const o=(0,z.getCurrentTransformInverse)(n);if(o){const{width:a,height:u}=n.canvas,[A,E,k,R]=w.Util.getAxialAlignedBoundingBox([0,0,a,u],o);this.ctx.fillRect(A,E,k-A,R-E)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,w.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,w.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,n){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&e.length===6&&this.transform(...e),this.baseTransform=(0,z.getCurrentTransform)(this.ctx),n)){const f=n[2]-n[0],o=n[3]-n[1];this.ctx.rect(n[0],n[1],f,o),this.current.updateRectMinMax((0,z.getCurrentTransform)(this.ctx),n),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||(0,w.info)("TODO: Support non-isolated groups."),e.knockout&&(0,w.warn)("Knockout groups not supported.");const f=(0,z.getCurrentTransform)(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let o=w.Util.getAxialAlignedBoundingBox(e.bbox,(0,z.getCurrentTransform)(n));const a=[0,0,n.canvas.width,n.canvas.height];o=w.Util.intersect(o,a)||[0,0,0,0];const u=Math.floor(o[0]),A=Math.floor(o[1]);let E=Math.max(Math.ceil(o[2])-u,1),k=Math.max(Math.ceil(o[3])-A,1),R=1,D=1;E>c&&(R=E/c,E=c),k>c&&(D=k/c,k=c),this.current.startNewPathAndClipBox([0,0,E,k]);let I="groupAt"+this.groupLevel;e.smask&&(I+="_smask_"+this.smaskCounter++%2);const F=this.cachedCanvases.getCanvas(I,E,k),T=F.context;T.scale(1/R,1/D),T.translate(-u,-A),T.transform(...f),e.smask?this.smaskStack.push({canvas:F.canvas,context:T,offsetX:u,offsetY:A,scaleX:R,scaleY:D,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(n.setTransform(1,0,0,1,0,0),n.translate(u,A),n.scale(R,D),n.save()),H(n,T),this.ctx=T,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,f=this.groupStack.pop();if(this.ctx=f,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const o=(0,z.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...o);const a=w.Util.getAxialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o);this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(e,n,f,o,a){if(this.#t(),G(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(n)&&n.length===4){const u=n[2]-n[0],A=n[3]-n[1];if(a&&this.annotationCanvasMap){f=f.slice(),f[4]-=n[0],f[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=u,n[3]=A;const[E,k]=w.Util.singularValueDecompose2dScale((0,z.getCurrentTransform)(this.ctx)),{viewportScale:R}=this,D=Math.ceil(u*this.outputScaleX*R),I=Math.ceil(A*this.outputScaleY*R);this.annotationCanvas=this.canvasFactory.create(D,I);const{canvas:F,context:T}=this.annotationCanvas;this.annotationCanvasMap.set(e,F),this.annotationCanvas.savedCtx=this.ctx,this.ctx=T,this.ctx.save(),this.ctx.setTransform(E,0,0,-k,0,A*k),G(this.ctx)}else G(this.ctx),this.ctx.rect(n[0],n[1],u,A),this.ctx.clip(),this.endPath()}this.current=new q(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...f),this.transform(...o)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(e.data,e),e.count=n;const f=this.ctx,o=this.processingType3;if(o&&(o.compiled===void 0&&(o.compiled=B(e)),o.compiled)){o.compiled(f);return}const a=this._createMaskCanvas(e),u=a.canvas;f.save(),f.setTransform(1,0,0,1,0,0),f.drawImage(u,a.offsetX,a.offsetY),f.restore(),this.compose()}paintImageMaskXObjectRepeat(e,n,f=0,o=0,a,u){if(!this.contentVisible)return;e=this.getObject(e.data,e);const A=this.ctx;A.save();const E=(0,z.getCurrentTransform)(A);A.transform(n,f,o,a,0,0);const k=this._createMaskCanvas(e);A.setTransform(1,0,0,1,k.offsetX-E[4],k.offsetY-E[5]);for(let R=0,D=u.length;R<D;R+=2){const I=w.Util.transform(E,[n,f,o,a,u[R],u[R+1]]),[F,T]=w.Util.applyTransform([0,0],I);A.drawImage(k.canvas,F,T)}A.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const n=this.ctx,f=this.current.fillColor,o=this.current.patternFill;for(const a of e){const{data:u,width:A,height:E,transform:k}=a,R=this.cachedCanvases.getCanvas("maskCanvas",A,E),D=R.context;D.save();const I=this.getObject(u,a);j(D,I),D.globalCompositeOperation="source-in",D.fillStyle=o?f.getPattern(D,this,(0,z.getCurrentTransformInverse)(n),_.FILL):f,D.fillRect(0,0,A,E),D.restore(),n.save(),n.transform(...k),n.scale(1,-1),N(n,R.canvas,0,0,A,E,0,-1,1,1),n.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){(0,w.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(n)}paintImageXObjectRepeat(e,n,f,o){if(!this.contentVisible)return;const a=this.getObject(e);if(!a){(0,w.warn)("Dependent image isn't ready yet");return}const u=a.width,A=a.height,E=[];for(let k=0,R=o.length;k<R;k+=2)E.push({transform:[n,0,0,f,o[k],o[k+1]],x:0,y:0,w:u,h:A});this.paintInlineImageXObjectGroup(a,E)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:n,width:f,height:o}=e,a=this.cachedCanvases.getCanvas("inlineImage",f,o),u=a.context;return u.filter=this.current.transferMaps,u.drawImage(n,0,0),u.filter="none",a.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const n=e.width,f=e.height,o=this.ctx;if(this.save(),!w.isNodeJS){const{filter:A}=o;A!=="none"&&A!==""&&(o.filter="none")}o.scale(1/n,-1/f);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const E=this.cachedCanvases.getCanvas("inlineImage",n,f).context;nt(E,e),a=this.applyTransferMapsToCanvas(E)}const u=this._scaleImage(a,(0,z.getCurrentTransformInverse)(o));o.imageSmoothingEnabled=pt((0,z.getCurrentTransform)(o),e.interpolate),N(o,u.img,0,0,u.paintWidth,u.paintHeight,0,-f,n,f),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,n){if(!this.contentVisible)return;const f=this.ctx;let o;if(e.bitmap)o=e.bitmap;else{const a=e.width,u=e.height,E=this.cachedCanvases.getCanvas("inlineImage",a,u).context;nt(E,e),o=this.applyTransferMapsToCanvas(E)}for(const a of n)f.save(),f.transform(...a.transform),f.scale(1,-1),N(f,o,a.x,a.y,a.w,a.h,0,-1,1,1),f.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,n){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,n){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const f=this.ctx;this.pendingClip&&(n||(this.pendingClip===et?f.clip("evenodd"):f.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),f.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=(0,z.getCurrentTransform)(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const n=Math.abs(e[0]*e[3]-e[2]*e[1]),f=Math.hypot(e[0],e[2]),o=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(f,o)/n}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:n,b:f,c:o,d:a}=this.ctx.getTransform();let u,A;if(f===0&&o===0){const E=Math.abs(n),k=Math.abs(a);if(E===k)if(e===0)u=A=1/E;else{const R=E*e;u=A=R<1?1/R:1}else if(e===0)u=1/E,A=1/k;else{const R=E*e,D=k*e;u=R<1?1/R:1,A=D<1?1/D:1}}else{const E=Math.abs(n*a-f*o),k=Math.hypot(n,f),R=Math.hypot(o,a);if(e===0)u=R/E,A=k/E;else{const D=e*E;u=R>D?R/D:1,A=k>D?k/D:1}}this._cachedScaleForStroking[0]=u,this._cachedScaleForStroking[1]=A}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:n}=this,{lineWidth:f}=this.current,[o,a]=this.getScaleForStroking();if(n.lineWidth=f||1,o===1&&a===1){n.stroke();return}const u=n.getLineDash();if(e&&n.save(),n.scale(o,a),u.length>0){const A=Math.max(o,a);n.setLineDash(u.map(E=>E/A)),n.lineDashOffset/=A}n.stroke(),e&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const h in w.OPS)m.prototype[h]!==void 0&&(m.prototype[w.OPS[h]]=m.prototype[h])},419:(ct,st,$)=>{$.d(st,{DOMCMapReaderFactory:()=>v,DOMCanvasFactory:()=>C,DOMFilterFactory:()=>P,DOMSVGFactory:()=>d,DOMStandardFontDataFactory:()=>r,PDFDateString:()=>L,PageViewport:()=>l,PixelsPerInch:()=>V,RenderingCancelledException:()=>b,StatTimer:()=>c,fetchData:()=>x,getColorValues:()=>N,getCurrentTransform:()=>B,getCurrentTransformInverse:()=>q,getFilenameFromUrl:()=>t,getPdfFilenameFromUrl:()=>i,getRGB:()=>O,getXfaPageViewport:()=>M,isDataScheme:()=>s,isPdfFile:()=>g,isValidFetchUrl:()=>p,noContextMenu:()=>y,setLayerDimensions:()=>nt});var w=$(583),z=$(292);const _="http://www.w3.org/2000/svg";class V{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class P extends w.BaseFilterFactory{#t;#e;#s;#n;#r;#i=0;constructor({docId:H,ownerDocument:G=globalThis.document}={}){super(),this.#s=H,this.#n=G}get#a(){return this.#t||=new Map}get#l(){return this.#r||=new Map}get#h(){if(!this.#e){const H=this.#n.createElement("div"),{style:G}=H;G.visibility="hidden",G.contain="strict",G.width=G.height=0,G.position="absolute",G.top=G.left=0,G.zIndex=-1;const Y=this.#n.createElementNS(_,"svg");Y.setAttribute("width",0),Y.setAttribute("height",0),this.#e=this.#n.createElementNS(_,"defs"),H.append(Y),Y.append(this.#e),this.#n.body.append(H)}return this.#e}addFilter(H){if(!H)return"none";let G=this.#a.get(H);if(G)return G;let Y,tt,Z,at;if(H.length===1){const ot=H[0],ut=new Array(256);for(let et=0;et<256;et++)ut[et]=ot[et]/255;at=Y=tt=Z=ut.join(",")}else{const[ot,ut,et]=H,m=new Array(256),h=new Array(256),e=new Array(256);for(let n=0;n<256;n++)m[n]=ot[n]/255,h[n]=ut[n]/255,e[n]=et[n]/255;Y=m.join(","),tt=h.join(","),Z=e.join(","),at=`${Y}${tt}${Z}`}if(G=this.#a.get(at),G)return this.#a.set(H,G),G;const lt=`g_${this.#s}_transfer_map_${this.#i++}`,pt=`url(#${lt})`;this.#a.set(H,pt),this.#a.set(at,pt);const dt=this.#u(lt);return this.#o(Y,tt,Z,dt),pt}addHCMFilter(H,G){const Y=`${H}-${G}`,tt="base";let Z=this.#l.get(tt);if(Z?.key===Y||(Z?(Z.filter?.remove(),Z.key=Y,Z.url="none",Z.filter=null):(Z={key:Y,url:"none",filter:null},this.#l.set(tt,Z)),!H||!G))return Z.url;const at=this.#p(H);H=z.Util.makeHexColor(...at);const lt=this.#p(G);if(G=z.Util.makeHexColor(...lt),this.#h.style.color="",H==="#000000"&&G==="#ffffff"||H===G)return Z.url;const pt=new Array(256);for(let m=0;m<=255;m++){const h=m/255;pt[m]=h<=.03928?h/12.92:((h+.055)/1.055)**2.4}const dt=pt.join(","),ot=`g_${this.#s}_hcm_filter`,ut=Z.filter=this.#u(ot);this.#o(dt,dt,dt,ut),this.#d(ut);const et=(m,h)=>{const e=at[m]/255,n=lt[m]/255,f=new Array(h+1);for(let o=0;o<=h;o++)f[o]=e+o/h*(n-e);return f.join(",")};return this.#o(et(0,5),et(1,5),et(2,5),ut),Z.url=`url(#${ot})`,Z.url}addHighlightHCMFilter(H,G,Y,tt,Z){const at=`${G}-${Y}-${tt}-${Z}`;let lt=this.#l.get(H);if(lt?.key===at||(lt?(lt.filter?.remove(),lt.key=at,lt.url="none",lt.filter=null):(lt={key:at,url:"none",filter:null},this.#l.set(H,lt)),!G||!Y))return lt.url;const[pt,dt]=[G,Y].map(this.#p.bind(this));let ot=Math.round(.2126*pt[0]+.7152*pt[1]+.0722*pt[2]),ut=Math.round(.2126*dt[0]+.7152*dt[1]+.0722*dt[2]),[et,m]=[tt,Z].map(this.#p.bind(this));ut<ot&&([ot,ut,et,m]=[ut,ot,m,et]),this.#h.style.color="";const h=(f,o,a)=>{const u=new Array(256),A=(ut-ot)/a,E=f/255,k=(o-f)/(255*a);let R=0;for(let D=0;D<=a;D++){const I=Math.round(ot+D*A),F=E+D*k;for(let T=R;T<=I;T++)u[T]=F;R=I+1}for(let D=R;D<256;D++)u[D]=u[R-1];return u.join(",")},e=`g_${this.#s}_hcm_${H}_filter`,n=lt.filter=this.#u(e);return this.#d(n),this.#o(h(et[0],m[0],5),h(et[1],m[1],5),h(et[2],m[2],5),n),lt.url=`url(#${e})`,lt.url}destroy(H=!1){H&&this.#l.size!==0||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#i=0)}#d(H){const G=this.#n.createElementNS(_,"feColorMatrix");G.setAttribute("type","matrix"),G.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),H.append(G)}#u(H){const G=this.#n.createElementNS(_,"filter");return G.setAttribute("color-interpolation-filters","sRGB"),G.setAttribute("id",H),this.#h.append(G),G}#c(H,G,Y){const tt=this.#n.createElementNS(_,G);tt.setAttribute("type","discrete"),tt.setAttribute("tableValues",Y),H.append(tt)}#o(H,G,Y,tt){const Z=this.#n.createElementNS(_,"feComponentTransfer");tt.append(Z),this.#c(Z,"feFuncR",H),this.#c(Z,"feFuncG",G),this.#c(Z,"feFuncB",Y)}#p(H){return this.#h.style.color=H,O(getComputedStyle(this.#h).getPropertyValue("color"))}}class C extends w.BaseCanvasFactory{constructor({ownerDocument:H=globalThis.document}={}){super(),this._document=H}_createCanvas(H,G){const Y=this._document.createElement("canvas");return Y.width=H,Y.height=G,Y}}async function x(j,H="text"){if(p(j,document.baseURI)){const G=await fetch(j);if(!G.ok)throw new Error(G.statusText);switch(H){case"arraybuffer":return G.arrayBuffer();case"blob":return G.blob();case"json":return G.json()}return G.text()}return new Promise((G,Y)=>{const tt=new XMLHttpRequest;tt.open("GET",j,!0),tt.responseType=H,tt.onreadystatechange=()=>{if(tt.readyState===XMLHttpRequest.DONE){if(tt.status===200||tt.status===0){switch(H){case"arraybuffer":case"blob":case"json":G(tt.response);return}G(tt.responseText);return}Y(new Error(tt.statusText))}},tt.send(null)})}class v extends w.BaseCMapReaderFactory{_fetchData(H,G){return x(H,this.isCompressed?"arraybuffer":"text").then(Y=>({cMapData:Y instanceof ArrayBuffer?new Uint8Array(Y):(0,z.stringToBytes)(Y),compressionType:G}))}}class r extends w.BaseStandardFontDataFactory{_fetchData(H){return x(H,"arraybuffer").then(G=>new Uint8Array(G))}}class d extends w.BaseSVGFactory{_createSVG(H){return document.createElementNS(_,H)}}class l{constructor({viewBox:H,scale:G,rotation:Y,offsetX:tt=0,offsetY:Z=0,dontFlip:at=!1}){this.viewBox=H,this.scale=G,this.rotation=Y,this.offsetX=tt,this.offsetY=Z;const lt=(H[2]+H[0])/2,pt=(H[3]+H[1])/2;let dt,ot,ut,et;switch(Y%=360,Y<0&&(Y+=360),Y){case 180:dt=-1,ot=0,ut=0,et=1;break;case 90:dt=0,ot=1,ut=1,et=0;break;case 270:dt=0,ot=-1,ut=-1,et=0;break;case 0:dt=1,ot=0,ut=0,et=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}at&&(ut=-ut,et=-et);let m,h,e,n;dt===0?(m=Math.abs(pt-H[1])*G+tt,h=Math.abs(lt-H[0])*G+Z,e=(H[3]-H[1])*G,n=(H[2]-H[0])*G):(m=Math.abs(lt-H[0])*G+tt,h=Math.abs(pt-H[1])*G+Z,e=(H[2]-H[0])*G,n=(H[3]-H[1])*G),this.transform=[dt*G,ot*G,ut*G,et*G,m-dt*G*lt-ut*G*pt,h-ot*G*lt-et*G*pt],this.width=e,this.height=n}get rawDims(){const{viewBox:H}=this;return(0,z.shadow)(this,"rawDims",{pageWidth:H[2]-H[0],pageHeight:H[3]-H[1],pageX:H[0],pageY:H[1]})}clone({scale:H=this.scale,rotation:G=this.rotation,offsetX:Y=this.offsetX,offsetY:tt=this.offsetY,dontFlip:Z=!1}={}){return new l({viewBox:this.viewBox.slice(),scale:H,rotation:G,offsetX:Y,offsetY:tt,dontFlip:Z})}convertToViewportPoint(H,G){return z.Util.applyTransform([H,G],this.transform)}convertToViewportRectangle(H){const G=z.Util.applyTransform([H[0],H[1]],this.transform),Y=z.Util.applyTransform([H[2],H[3]],this.transform);return[G[0],G[1],Y[0],Y[1]]}convertToPdfPoint(H,G){return z.Util.applyInverseTransform([H,G],this.transform)}}class b extends z.BaseException{constructor(H,G=0){super(H,"RenderingCancelledException"),this.extraDelay=G}}function s(j){const H=j.length;let G=0;for(;G<H&&j[G].trim()==="";)G++;return j.substring(G,G+5).toLowerCase()==="data:"}function g(j){return typeof j=="string"&&/\.pdf$/i.test(j)}function t(j,H=!1){return H||([j]=j.split(/[#?]/,1)),j.substring(j.lastIndexOf("/")+1)}function i(j,H="document.pdf"){if(typeof j!="string")return H;if(s(j))return(0,z.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),H;const G=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Y=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,tt=G.exec(j);let Z=Y.exec(tt[1])||Y.exec(tt[2])||Y.exec(tt[3]);if(Z&&(Z=Z[0],Z.includes("%")))try{Z=Y.exec(decodeURIComponent(Z))[0]}catch{}return Z||H}class c{started=Object.create(null);times=[];time(H){H in this.started&&(0,z.warn)(`Timer is already running for ${H}`),this.started[H]=Date.now()}timeEnd(H){H in this.started||(0,z.warn)(`Timer has not been started for ${H}`),this.times.push({name:H,start:this.started[H],end:Date.now()}),delete this.started[H]}toString(){const H=[];let G=0;for(const{name:Y}of this.times)G=Math.max(Y.length,G);for(const{name:Y,start:tt,end:Z}of this.times)H.push(`${Y.padEnd(G)} ${Z-tt}ms
`);return H.join("")}}function p(j,H){try{const{protocol:G}=H?new URL(j,H):new URL(j);return G==="http:"||G==="https:"}catch{return!1}}function y(j){j.preventDefault()}let S;class L{static toDateObject(H){if(!H||typeof H!="string")return null;S||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const G=S.exec(H);if(!G)return null;const Y=parseInt(G[1],10);let tt=parseInt(G[2],10);tt=tt>=1&&tt<=12?tt-1:0;let Z=parseInt(G[3],10);Z=Z>=1&&Z<=31?Z:1;let at=parseInt(G[4],10);at=at>=0&&at<=23?at:0;let lt=parseInt(G[5],10);lt=lt>=0&&lt<=59?lt:0;let pt=parseInt(G[6],10);pt=pt>=0&&pt<=59?pt:0;const dt=G[7]||"Z";let ot=parseInt(G[8],10);ot=ot>=0&&ot<=23?ot:0;let ut=parseInt(G[9],10)||0;return ut=ut>=0&&ut<=59?ut:0,dt==="-"?(at+=ot,lt+=ut):dt==="+"&&(at-=ot,lt-=ut),new Date(Date.UTC(Y,tt,Z,at,lt,pt))}}function M(j,{scale:H=1,rotation:G=0}){const{width:Y,height:tt}=j.attributes.style,Z=[0,0,parseInt(Y),parseInt(tt)];return new l({viewBox:Z,scale:H,rotation:G})}function O(j){if(j.startsWith("#")){const H=parseInt(j.slice(1),16);return[(H&16711680)>>16,(H&65280)>>8,H&255]}return j.startsWith("rgb(")?j.slice(4,-1).split(",").map(H=>parseInt(H)):j.startsWith("rgba(")?j.slice(5,-1).split(",").map(H=>parseInt(H)).slice(0,3):((0,z.warn)(`Not a valid color format: "${j}"`),[0,0,0])}function N(j){const H=document.createElement("span");H.style.visibility="hidden",document.body.append(H);for(const G of j.keys()){H.style.color=G;const Y=window.getComputedStyle(H).color;j.set(G,O(Y))}H.remove()}function B(j){const{a:H,b:G,c:Y,d:tt,e:Z,f:at}=j.getTransform();return[H,G,Y,tt,Z,at]}function q(j){const{a:H,b:G,c:Y,d:tt,e:Z,f:at}=j.getTransform().invertSelf();return[H,G,Y,tt,Z,at]}function nt(j,H,G=!1,Y=!0){if(H instanceof l){const{pageWidth:tt,pageHeight:Z}=H.rawDims,{style:at}=j,lt=z.FeatureTest.isCSSRoundSupported,pt=`var(--scale-factor) * ${tt}px`,dt=`var(--scale-factor) * ${Z}px`,ot=lt?`round(${pt}, 1px)`:`calc(${pt})`,ut=lt?`round(${dt}, 1px)`:`calc(${dt})`;!G||H.rotation%180===0?(at.width=ot,at.height=ut):(at.width=ut,at.height=ot)}Y&&j.setAttribute("data-main-rotation",H.rotation)}},47:(ct,st,$)=>{$.d(st,{DrawLayer:()=>_});var w=$(419),z=$(292);class _{#t=null;#e=0;#s=new Map;#n=new Map;constructor({pageIndex:P}){this.pageIndex=P}setParent(P){if(!this.#t){this.#t=P;return}if(this.#t!==P){if(this.#s.size>0)for(const C of this.#s.values())C.remove(),P.append(C);this.#t=P}}static get _svgFactory(){return(0,z.shadow)(this,"_svgFactory",new w.DOMSVGFactory)}static#r(P,{x:C=0,y:x=0,width:v=1,height:r=1}={}){const{style:d}=P;d.top=`${100*x}%`,d.left=`${100*C}%`,d.width=`${100*v}%`,d.height=`${100*r}%`}#i(P){const C=_._svgFactory.create(1,1,!0);return this.#t.append(C),C.setAttribute("aria-hidden",!0),_.#r(C,P),C}#a(P,C){const x=_._svgFactory.createElement("clipPath");P.append(x);const v=`clip_${C}`;x.setAttribute("id",v),x.setAttribute("clipPathUnits","objectBoundingBox");const r=_._svgFactory.createElement("use");return x.append(r),r.setAttribute("href",`#${C}`),r.classList.add("clip"),v}highlight(P,C,x,v=!1){const r=this.#e++,d=this.#i(P.box);d.classList.add("highlight"),P.free&&d.classList.add("free");const l=_._svgFactory.createElement("defs");d.append(l);const b=_._svgFactory.createElement("path");l.append(b);const s=`path_p${this.pageIndex}_${r}`;b.setAttribute("id",s),b.setAttribute("d",P.toSVGPath()),v&&this.#n.set(r,b);const g=this.#a(l,s),t=_._svgFactory.createElement("use");return d.append(t),d.setAttribute("fill",C),d.setAttribute("fill-opacity",x),t.setAttribute("href",`#${s}`),this.#s.set(r,d),{id:r,clipPathId:`url(#${g})`}}highlightOutline(P){const C=this.#e++,x=this.#i(P.box);x.classList.add("highlightOutline");const v=_._svgFactory.createElement("defs");x.append(v);const r=_._svgFactory.createElement("path");v.append(r);const d=`path_p${this.pageIndex}_${C}`;r.setAttribute("id",d),r.setAttribute("d",P.toSVGPath()),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(P.free){x.classList.add("free");const g=_._svgFactory.createElement("mask");v.append(g),l=`mask_p${this.pageIndex}_${C}`,g.setAttribute("id",l),g.setAttribute("maskUnits","objectBoundingBox");const t=_._svgFactory.createElement("rect");g.append(t),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("fill","white");const i=_._svgFactory.createElement("use");g.append(i),i.setAttribute("href",`#${d}`),i.setAttribute("stroke","none"),i.setAttribute("fill","black"),i.setAttribute("fill-rule","nonzero"),i.classList.add("mask")}const b=_._svgFactory.createElement("use");x.append(b),b.setAttribute("href",`#${d}`),l&&b.setAttribute("mask",`url(#${l})`);const s=b.cloneNode();return x.append(s),b.classList.add("mainOutline"),s.classList.add("secondaryOutline"),this.#s.set(C,x),C}finalizeLine(P,C){const x=this.#n.get(P);this.#n.delete(P),this.updateBox(P,C.box),x.setAttribute("d",C.toSVGPath())}updateLine(P,C){this.#s.get(P).firstChild.firstChild.setAttribute("d",C.toSVGPath())}removeFreeHighlight(P){this.remove(P),this.#n.delete(P)}updatePath(P,C){this.#n.get(P).setAttribute("d",C.toSVGPath())}updateBox(P,C){_.#r(this.#s.get(P),C)}show(P,C){this.#s.get(P).classList.toggle("hidden",!C)}rotate(P,C){this.#s.get(P).setAttribute("data-main-rotation",C)}changeColor(P,C){this.#s.get(P).setAttribute("fill",C)}changeOpacity(P,C){this.#s.get(P).setAttribute("fill-opacity",C)}addClass(P,C){this.#s.get(P).classList.add(C)}removeClass(P,C){this.#s.get(P).classList.remove(C)}remove(P){this.#t!==null&&(this.#s.get(P).remove(),this.#s.delete(P))}destroy(){this.#t=null;for(const P of this.#s.values())P.remove();this.#s.clear()}}},731:(ct,st,$)=>{$.d(st,{AnnotationEditorLayer:()=>s});var w=$(292),z=$(310),_=$(830),V=$(976);const P=/\r\n?|\n/g;class C extends z.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#s=this.editorDivInput.bind(this);#n=this.editorDivKeydown.bind(this);#r=this.editorDivPaste.bind(this);#i;#a="";#l=`${this.id}-editor`;#h;#d=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=C.prototype,i=y=>y.isEmpty(),c=_.AnnotationEditorUIManager.TRANSLATE_SMALL,p=_.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,w.shadow)(this,"_keyboardManager",new _.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-c,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-p,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[c,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[p,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-c],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-p],checker:i}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,c],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,p],checker:i}]]))}static _type="freetext";static _editorType=w.AnnotationEditorType.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#i=t.color||C._defaultColor||z.AnnotationEditor._defaultLineColor,this.#h=t.fontSize||C._defaultFontSize}static initialize(t,i){z.AnnotationEditor.initialize(t,i,{strings:["pdfjs-free-text-default-content"]});const c=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(c.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,i){switch(t){case w.AnnotationEditorParamsType.FREETEXT_SIZE:C._defaultFontSize=i;break;case w.AnnotationEditorParamsType.FREETEXT_COLOR:C._defaultColor=i;break}}updateParams(t,i){switch(t){case w.AnnotationEditorParamsType.FREETEXT_SIZE:this.#u(i);break;case w.AnnotationEditorParamsType.FREETEXT_COLOR:this.#c(i);break}}static get defaultPropertiesToUpdate(){return[[w.AnnotationEditorParamsType.FREETEXT_SIZE,C._defaultFontSize],[w.AnnotationEditorParamsType.FREETEXT_COLOR,C._defaultColor||z.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[w.AnnotationEditorParamsType.FREETEXT_SIZE,this.#h],[w.AnnotationEditorParamsType.FREETEXT_COLOR,this.#i]]}#u(t){const i=p=>{this.editorDiv.style.fontSize=`calc(${p}px * var(--scale-factor))`,this.translate(0,-(p-this.#h)*this.parentScale),this.#h=p,this.#p()},c=this.#h;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#c(t){const i=p=>{this.#i=this.editorDiv.style.color=p},c=this.#i;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,i){this._uiManager.translateSelectedEditors(t,i,!0)}getInitialTranslation(){const t=this.parentScale;return[-C._internalPadding*t,-(C._internalPadding+this.#h)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(w.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#n),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#s),this.editorDiv.addEventListener("paste",this.#r))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#l),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#n),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#s),this.editorDiv.removeEventListener("paste",this.#r),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();for(const i of this.editorDiv.childNodes)t.push(C.#g(i));return t.join(`
`)}#p(){const[t,i]=this.parentDimensions;let c;if(this.isAttachedToDOM)c=this.div.getBoundingClientRect();else{const{currentLayer:p,div:y}=this,S=y.style.display,L=y.classList.contains("hidden");y.classList.remove("hidden"),y.style.display="hidden",p.div.append(this.div),c=y.getBoundingClientRect(),y.remove(),y.style.display=S,y.classList.toggle("hidden",L)}this.rotation%180===this.parentRotation%180?(this.width=c.width/t,this.height=c.height/i):(this.width=c.height/t,this.height=c.width/i),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#a,i=this.#a=this.#o().trimEnd();if(t===i)return;const c=p=>{if(this.#a=p,!p){this.remove();return}this.#f(),this._uiManager.rebuild(this),this.#p()};this.addCommands({cmd:()=>{c(i)},undo:()=>{c(t)},mustExec:!1}),this.#p()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){C._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#l),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),z.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(p=>this.editorDiv?.setAttribute("default-content",p)),this.editorDiv.contentEditable=!0;const{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#h}px * var(--scale-factor))`,c.color=this.#i,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,_.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[p,y]=this.parentDimensions;if(this.annotationElementId){const{position:S}=this.#d;let[L,M]=this.getInitialTranslation();[L,M]=this.pageTranslationToScreen(L,M);const[O,N]=this.pageDimensions,[B,q]=this.pageTranslation;let nt,j;switch(this.rotation){case 0:nt=t+(S[0]-B)/O,j=i+this.height-(S[1]-q)/N;break;case 90:nt=t+(S[0]-B)/O,j=i-(S[1]-q)/N,[L,M]=[M,-L];break;case 180:nt=t-this.width+(S[0]-B)/O,j=i-(S[1]-q)/N,[L,M]=[-L,-M];break;case 270:nt=t+(S[0]-B-this.height*N)/O,j=i+(S[1]-q-this.width*O)/N,[L,M]=[-M,L];break}this.setAt(nt*p,j*y,L,M)}else this.setAt(t*p,i*y,this.width*p,this.height*y);this.#f(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#g(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(P,"")}editorDivPaste(t){const i=t.clipboardData||window.clipboardData,{types:c}=i;if(c.length===1&&c[0]==="text/plain")return;t.preventDefault();const p=C.#m(i.getData("text")||"").replaceAll(P,`
`);if(!p)return;const y=window.getSelection();if(!y.rangeCount)return;this.editorDiv.normalize(),y.deleteFromDocument();const S=y.getRangeAt(0);if(!p.includes(`
`)){S.insertNode(document.createTextNode(p)),this.editorDiv.normalize(),y.collapseToStart();return}const{startContainer:L,startOffset:M}=S,O=[],N=[];if(L.nodeType===Node.TEXT_NODE){const nt=L.parentElement;if(N.push(L.nodeValue.slice(M).replaceAll(P,"")),nt!==this.editorDiv){let j=O;for(const H of this.editorDiv.childNodes){if(H===nt){j=N;continue}j.push(C.#g(H))}}O.push(L.nodeValue.slice(0,M).replaceAll(P,""))}else if(L===this.editorDiv){let nt=O,j=0;for(const H of this.editorDiv.childNodes)j++===M&&(nt=N),nt.push(C.#g(H))}this.#a=`${O.join(`
`)}${p}${N.join(`
`)}`,this.#f();const B=new Range;let q=O.reduce((nt,j)=>nt+j.length,0);for(const{firstChild:nt}of this.editorDiv.childNodes)if(nt.nodeType===Node.TEXT_NODE){const j=nt.nodeValue.length;if(q<=j){B.setStart(nt,q),B.setEnd(nt,q);break}q-=j}y.removeAllRanges(),y.addRange(B)}#f(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const t of this.#a.split(`
`)){const i=document.createElement("div");i.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(i)}}#A(){return this.#a.replaceAll(""," ")}static#m(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}static deserialize(t,i,c){let p=null;if(t instanceof V.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:S,fontColor:L},rect:M,rotation:O,id:N},textContent:B,textPosition:q,parent:{page:{pageNumber:nt}}}=t;if(!B||B.length===0)return null;p=t={annotationType:w.AnnotationEditorType.FREETEXT,color:Array.from(L),fontSize:S,value:B.join(`
`),position:q,pageIndex:nt-1,rect:M.slice(0),rotation:O,id:N,deleted:!1}}const y=super.deserialize(t,i,c);return y.#h=t.fontSize,y.#i=w.Util.makeHexColor(...t.color),y.#a=C.#m(t.value),y.annotationElementId=t.id||null,y.#d=p,y}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const i=C._internalPadding*this.parentScale,c=this.getRect(i,i),p=z.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#i),y={annotationType:w.AnnotationEditorType.FREETEXT,color:p,fontSize:this.#h,value:this.#A(),pageIndex:this.pageIndex,rect:c,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?y:this.annotationElementId&&!this.#v(y)?null:(y.id=this.annotationElementId,y)}#v(t){const{value:i,fontSize:c,color:p,pageIndex:y}=this.#d;return this._hasBeenMoved||t.value!==i||t.fontSize!==c||t.color.some((S,L)=>S!==p[L])||t.pageIndex!==y}renderAnnotationElement(t){const i=super.renderAnnotationElement(t);if(this.deleted)return i;const{style:c}=i;c.fontSize=`calc(${this.#h}px * var(--scale-factor))`,c.color=this.#i,i.replaceChildren();for(const y of this.#a.split(`
`)){const S=document.createElement("div");S.append(y?document.createTextNode(y):document.createElement("br")),i.append(S)}const p=C._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(p,p)}),i}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}var x=$(61),v=$(259),r=$(419);class d extends z.AnnotationEditor{#t=null;#e=0;#s;#n=null;#r=null;#i=null;#a=null;#l=0;#h=null;#d=null;#u=null;#c=!1;#o=this.#E.bind(this);#p=null;#g;#f=null;#A="";#m;#v="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _l10nPromise;static _type="highlight";static _editorType=w.AnnotationEditorType.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=d.prototype;return(0,w.shadow)(this,"_keyboardManager",new _.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||d._defaultColor,this.#m=t.thickness||d._defaultThickness,this.#g=t.opacity||d._defaultOpacity,this.#s=t.boxes||null,this.#v=t.methodOfCreation||"",this.#A=t.text||"",this._isDraggable=!1,t.highlightId>-1?(this.#c=!0,this.#C(t),this.#b()):(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#a=t.focusNode,this.#l=t.focusOffset,this.#w(),this.#b(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#c?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#m,methodOfCreation:this.#v}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new x.Outliner(this.#s,.001);this.#d=t.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#d.box;const i=new x.Outliner(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#i=i.getOutlines();const{lastPoint:c}=this.#i.box;this.#p=[(c[0]-this.x)/this.width,(c[1]-this.y)/this.height]}#C({highlightOutlines:t,highlightId:i,clipPathId:c}){this.#d=t;const p=1.5;if(this.#i=t.getNewOutline(this.#m/2+p,.0025),i>=0)this.#u=i,this.#n=c,this.parent.drawLayer.finalizeLine(i,t),this.#f=this.parent.drawLayer.highlightOutline(this.#i);else if(this.parent){const N=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#u,t),this.parent.drawLayer.updateBox(this.#u,d.#S(this.#d.box,(N-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#f,this.#i),this.parent.drawLayer.updateBox(this.#f,d.#S(this.#i.box,N))}const{x:y,y:S,width:L,height:M}=t.box;switch(this.rotation){case 0:this.x=y,this.y=S,this.width=L,this.height=M;break;case 90:{const[N,B]=this.parentDimensions;this.x=S,this.y=1-y,this.width=L*B/N,this.height=M*N/B;break}case 180:this.x=1-y,this.y=1-S,this.width=L,this.height=M;break;case 270:{const[N,B]=this.parentDimensions;this.x=1-S,this.y=y,this.width=L*B/N,this.height=M*N/B;break}}const{lastPoint:O}=this.#i.box;this.#p=[(O[0]-y)/L,(O[1]-S)/M]}static initialize(t,i){z.AnnotationEditor.initialize(t,i),d._defaultColor||=i.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,i){switch(t){case w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:d._defaultColor=i;break;case w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:d._defaultThickness=i;break}}translateInPage(t,i){}get toolbarPosition(){return this.#p}updateParams(t,i){switch(t){case w.AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#k(i);break;case w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:this.#I(i);break}}static get defaultPropertiesToUpdate(){return[[w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,d._defaultColor],[w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,d._defaultThickness]]}get propertiesToUpdate(){return[[w.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||d._defaultColor],[w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,this.#m||d._defaultThickness],[w.AnnotationEditorParamsType.HIGHLIGHT_FREE,this.#c]]}#k(t){const i=p=>{this.color=p,this.parent?.drawLayer.changeColor(this.#u,p),this.#r?.updateColor(p)},c=this.color;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#I(t){const i=this.#m,c=p=>{this.#m=p,this.#L(p)};this.addCommands({cmd:c.bind(this,t),undo:c.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(this.#r=new v.ColorPicker({editor:this}),t.addColorPicker(this.#r)),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#T())}getBaseTranslation(){return[0,0]}getRect(t,i){return super.getRect(t,i,this.#T())}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#y(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#b(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let i=!1;this.parent&&!t?this.#y():t&&(this.#b(t),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),i&&this.select()}#L(t){if(!this.#c)return;this.#C({highlightOutlines:this.#d.getNewOutline(t/2)}),this.fixAndSetPosition();const[i,c]=this.parentDimensions;this.setDims(this.width*i,this.height*c)}#y(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#b(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#n}=t.drawLayer.highlight(this.#d,this.color,this.#g),this.#f=t.drawLayer.highlightOutline(this.#i),this.#h&&(this.#h.style.clipPath=this.#n))}static#S({x:t,y:i,width:c,height:p},y){switch(y){case 90:return{x:1-i-p,y:t,width:p,height:c};case 180:return{x:1-t-c,y:1-i-p,width:c,height:p};case 270:return{x:i,y:1-t-c,width:p,height:c}}return{x:t,y:i,width:c,height:p}}rotate(t){const{drawLayer:i}=this.parent;let c;this.#c?(t=(t-this.rotation+360)%360,c=d.#S(this.#d.box,t)):c=d.#S(this,t),i.rotate(this.#u,t),i.rotate(this.#f,t),i.updateBox(this.#u,c),i.updateBox(this.#f,d.#S(this.#i.box,t))}render(){if(this.div)return this.div;const t=super.render();this.#A&&(t.setAttribute("aria-label",this.#A),t.setAttribute("role","mark")),this.#c?t.classList.add("free"):this.div.addEventListener("keydown",this.#o);const i=this.#h=document.createElement("div");t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=this.#n;const[c,p]=this.parentDimensions;return this.setDims(this.width*c,this.height*p),(0,_.bindEvents)(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.parent.drawLayer.addClass(this.#f,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#f,"hovered")}#E(t){d._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#R(!0);break;case 1:case 3:this.#R(!1);break}}#R(t){if(!this.#t)return;const i=window.getSelection();t?i.setPosition(this.#t,this.#e):i.setPosition(this.#a,this.#l)}select(){super.select(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"hovered"),this.parent?.drawLayer.addClass(this.#f,"selected"))}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"selected"),this.#c||this.#R(!1))}get _mustFixPosition(){return!this.#c}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.show(this.#u,t),this.parent.drawLayer.show(this.#f,t))}#T(){return this.#c?this.rotation:0}#M(){if(this.#c)return null;const[t,i]=this.pageDimensions,c=this.#s,p=new Array(c.length*8);let y=0;for(const{x:S,y:L,width:M,height:O}of c){const N=S*t,B=(1-L-O)*i;p[y]=p[y+4]=N,p[y+1]=p[y+3]=B,p[y+2]=p[y+6]=N+M*t,p[y+5]=p[y+7]=B+O*i,y+=8}return p}#F(t){return this.#d.serialize(t,this.#T())}static startHighlighting(t,i,{target:c,x:p,y}){const{x:S,y:L,width:M,height:O}=c.getBoundingClientRect(),N=j=>{this.#_(t,j)},B={capture:!0,passive:!1},q=j=>{j.preventDefault(),j.stopPropagation()},nt=j=>{c.removeEventListener("pointermove",N),window.removeEventListener("blur",nt),window.removeEventListener("pointerup",nt),window.removeEventListener("pointerdown",q,B),window.removeEventListener("contextmenu",r.noContextMenu),this.#P(t,j)};window.addEventListener("blur",nt),window.addEventListener("pointerup",nt),window.addEventListener("pointerdown",q,B),window.addEventListener("contextmenu",r.noContextMenu),c.addEventListener("pointermove",N),this._freeHighlight=new x.FreeOutliner({x:p,y},[S,L,M,O],t.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static#_(t,i){this._freeHighlight.add(i)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#P(t,i){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(t,i,c){const p=super.deserialize(t,i,c),{rect:[y,S,L,M],color:O,quadPoints:N}=t;p.color=w.Util.makeHexColor(...O),p.#g=t.opacity;const[B,q]=p.pageDimensions;p.width=(L-y)/B,p.height=(M-S)/q;const nt=p.#s=[];for(let j=0;j<N.length;j+=8)nt.push({x:(N[4]-L)/B,y:(M-(1-N[j+5]))/q,width:(N[j+2]-N[j])/B,height:(N[j+5]-N[j+1])/q});return p.#w(),p}serialize(t=!1){if(this.isEmpty()||t)return null;const i=this.getRect(0,0),c=z.AnnotationEditor._colorManager.convert(this.color);return{annotationType:w.AnnotationEditorType.HIGHLIGHT,color:c,opacity:this.#g,thickness:this.#m,quadPoints:this.#M(),outlines:this.#F(i),pageIndex:this.pageIndex,rect:i,rotation:this.#T(),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}class l extends z.AnnotationEditor{#t=0;#e=0;#s=this.canvasPointermove.bind(this);#n=this.canvasPointerleave.bind(this);#r=this.canvasPointerup.bind(this);#i=this.canvasPointerdown.bind(this);#a=null;#l=new Path2D;#h=!1;#d=!1;#u=!1;#c=null;#o=0;#p=0;#g=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=w.AnnotationEditorType.INK;constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t,i){z.AnnotationEditor.initialize(t,i)}static updateDefaultParams(t,i){switch(t){case w.AnnotationEditorParamsType.INK_THICKNESS:l._defaultThickness=i;break;case w.AnnotationEditorParamsType.INK_COLOR:l._defaultColor=i;break;case w.AnnotationEditorParamsType.INK_OPACITY:l._defaultOpacity=i/100;break}}updateParams(t,i){switch(t){case w.AnnotationEditorParamsType.INK_THICKNESS:this.#f(i);break;case w.AnnotationEditorParamsType.INK_COLOR:this.#A(i);break;case w.AnnotationEditorParamsType.INK_OPACITY:this.#m(i);break}}static get defaultPropertiesToUpdate(){return[[w.AnnotationEditorParamsType.INK_THICKNESS,l._defaultThickness],[w.AnnotationEditorParamsType.INK_COLOR,l._defaultColor||z.AnnotationEditor._defaultLineColor],[w.AnnotationEditorParamsType.INK_OPACITY,Math.round(l._defaultOpacity*100)]]}get propertiesToUpdate(){return[[w.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||l._defaultThickness],[w.AnnotationEditorParamsType.INK_COLOR,this.color||l._defaultColor||z.AnnotationEditor._defaultLineColor],[w.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??l._defaultOpacity))]]}#f(t){const i=p=>{this.thickness=p,this.#N()},c=this.thickness;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#A(t){const i=p=>{this.color=p,this.#E()},c=this.color;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#m(t){const i=p=>{this.opacity=p,this.#E()};t/=100;const c=this.opacity;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#T(),this.#M()),this.isAttachedToDOM||(this.parent.add(this),this.#F()),this.#N()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#a&&(clearTimeout(this.#a),this.#a=null),this.#c.disconnect(),this.#c=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,i]=this.parentDimensions,c=this.width*t,p=this.height*i;this.setDimensions(c,p)}enableEditMode(){this.#h||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#i))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#i))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#v(){const{parentRotation:t,parentDimensions:[i,c]}=this;switch(t){case 90:return[0,c,c,i];case 180:return[i,c,i,c];case 270:return[i,0,c,i];default:return[0,0,i,c]}}#w(){const{ctx:t,color:i,opacity:c,thickness:p,parentScale:y,scaleFactor:S}=this;t.lineWidth=p*y/S,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${i}${(0,_.opacityToHex)(c)}`}#C(t,i){this.canvas.addEventListener("contextmenu",r.noContextMenu),this.canvas.addEventListener("pointerleave",this.#n),this.canvas.addEventListener("pointermove",this.#s),this.canvas.addEventListener("pointerup",this.#r),this.canvas.removeEventListener("pointerdown",this.#i),this.isEditing=!0,this.#u||(this.#u=!0,this.#F(),this.thickness||=l._defaultThickness,this.color||=l._defaultColor||z.AnnotationEditor._defaultLineColor,this.opacity??=l._defaultOpacity),this.currentPath.push([t,i]),this.#d=!1,this.#w(),this.#g=()=>{this.#y(),this.#g&&window.requestAnimationFrame(this.#g)},window.requestAnimationFrame(this.#g)}#k(t,i){const[c,p]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===c&&i===p)return;const y=this.currentPath;let S=this.#l;if(y.push([t,i]),this.#d=!0,y.length<=2){S.moveTo(...y[0]),S.lineTo(t,i);return}y.length===3&&(this.#l=S=new Path2D,S.moveTo(...y[0])),this.#b(S,...y.at(-3),...y.at(-2),t,i)}#I(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#l.lineTo(...t)}#L(t,i){this.#g=null,t=Math.min(Math.max(t,0),this.canvas.width),i=Math.min(Math.max(i,0),this.canvas.height),this.#k(t,i),this.#I();let c;if(this.currentPath.length!==1)c=this.#S();else{const M=[t,i];c=[[M,M.slice(),M.slice(),M]]}const p=this.#l,y=this.currentPath;this.currentPath=[],this.#l=new Path2D;const S=()=>{this.allRawPaths.push(y),this.paths.push(c),this.bezierPath2D.push(p),this._uiManager.rebuild(this)},L=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#T(),this.#M()),this.#N())};this.addCommands({cmd:S,undo:L,mustExec:!0})}#y(){if(!this.#d)return;this.#d=!1;const t=Math.ceil(this.thickness*this.parentScale),i=this.currentPath.slice(-3),c=i.map(S=>S[0]),p=i.map(S=>S[1]);Math.min(...c)-t,Math.max(...c)+t,Math.min(...p)-t,Math.max(...p)+t;const{ctx:y}=this;y.save(),y.clearRect(0,0,this.canvas.width,this.canvas.height);for(const S of this.bezierPath2D)y.stroke(S);y.stroke(this.#l),y.restore()}#b(t,i,c,p,y,S,L){const M=(i+p)/2,O=(c+y)/2,N=(p+S)/2,B=(y+L)/2;t.bezierCurveTo(M+2*(p-M)/3,O+2*(y-O)/3,N+2*(p-N)/3,B+2*(y-B)/3,N,B)}#S(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const i=[];let c,[p,y]=t[0];for(c=1;c<t.length-2;c++){const[q,nt]=t[c],[j,H]=t[c+1],G=(q+j)/2,Y=(nt+H)/2,tt=[p+2*(q-p)/3,y+2*(nt-y)/3],Z=[G+2*(q-G)/3,Y+2*(nt-Y)/3];i.push([[p,y],tt,Z,[G,Y]]),[p,y]=[G,Y]}const[S,L]=t[c],[M,O]=t[c+1],N=[p+2*(S-p)/3,y+2*(L-y)/3],B=[M+2*(S-M)/3,O+2*(L-O)/3];return i.push([[p,y],N,B,[M,O]]),i}#E(){if(this.isEmpty()){this.#P();return}this.#w();const{canvas:t,ctx:i}=this;i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height),this.#P();for(const c of this.bezierPath2D)i.stroke(c)}commit(){this.#h||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#h=!0,this.div.classList.add("disabled"),this.#N(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#h||(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#C(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#k(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#R(t)}canvasPointerleave(t){this.#R(t)}#R(t){this.canvas.removeEventListener("pointerleave",this.#n),this.canvas.removeEventListener("pointermove",this.#s),this.canvas.removeEventListener("pointerup",this.#r),this.canvas.addEventListener("pointerdown",this.#i),this.#a&&clearTimeout(this.#a),this.#a=setTimeout(()=>{this.#a=null,this.canvas.removeEventListener("contextmenu",r.noContextMenu)},10),this.#L(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#T(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#M(){this.#c=new ResizeObserver(t=>{const i=t[0].contentRect;i.width&&i.height&&this.setDimensions(i.width,i.height)}),this.#c.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#h}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[c,p,y,S]=this.#v();if(this.setAt(c,p,0,0),this.setDims(y,S),this.#T(),this.width){const[L,M]=this.parentDimensions;this.setAspectRatio(this.width*L,this.height*M),this.setAt(t*L,i*M,this.width*L,this.height*M),this.#u=!0,this.#F(),this.setDims(this.width*L,this.height*M),this.#E(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#M(),this.div}#F(){if(!this.#u)return;const[t,i]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*i),this.#P()}setDimensions(t,i){const c=Math.round(t),p=Math.round(i);if(this.#o===c&&this.#p===p)return;this.#o=c,this.#p=p,this.canvas.style.visibility="hidden";const[y,S]=this.parentDimensions;this.width=t/y,this.height=i/S,this.fixAndSetPosition(),this.#h&&this.#_(t,i),this.#F(),this.#E(),this.canvas.style.visibility="visible",this.fixDims()}#_(t,i){const c=this.#B(),p=(t-c)/this.#e,y=(i-c)/this.#t;this.scaleFactor=Math.min(p,y)}#P(){const t=this.#B()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#D(t){const i=new Path2D;for(let c=0,p=t.length;c<p;c++){const[y,S,L,M]=t[c];c===0&&i.moveTo(...y),i.bezierCurveTo(S[0],S[1],L[0],L[1],M[0],M[1])}return i}static#G(t,i,c){const[p,y,S,L]=i;switch(c){case 0:for(let M=0,O=t.length;M<O;M+=2)t[M]+=p,t[M+1]=L-t[M+1];break;case 90:for(let M=0,O=t.length;M<O;M+=2){const N=t[M];t[M]=t[M+1]+p,t[M+1]=N+y}break;case 180:for(let M=0,O=t.length;M<O;M+=2)t[M]=S-t[M],t[M+1]+=y;break;case 270:for(let M=0,O=t.length;M<O;M+=2){const N=t[M];t[M]=S-t[M+1],t[M+1]=L-N}break;default:throw new Error("Invalid rotation")}return t}static#$(t,i,c){const[p,y,S,L]=i;switch(c){case 0:for(let M=0,O=t.length;M<O;M+=2)t[M]-=p,t[M+1]=L-t[M+1];break;case 90:for(let M=0,O=t.length;M<O;M+=2){const N=t[M];t[M]=t[M+1]-y,t[M+1]=N-p}break;case 180:for(let M=0,O=t.length;M<O;M+=2)t[M]=S-t[M],t[M+1]-=y;break;case 270:for(let M=0,O=t.length;M<O;M+=2){const N=t[M];t[M]=L-t[M+1],t[M+1]=S-N}break;default:throw new Error("Invalid rotation")}return t}#X(t,i,c,p){const y=[],S=this.thickness/2,L=t*i+S,M=t*c+S;for(const O of this.paths){const N=[],B=[];for(let q=0,nt=O.length;q<nt;q++){const[j,H,G,Y]=O[q];if(j[0]===Y[0]&&j[1]===Y[1]&&nt===1){const et=t*j[0]+L,m=t*j[1]+M;N.push(et,m),B.push(et,m);break}const tt=t*j[0]+L,Z=t*j[1]+M,at=t*H[0]+L,lt=t*H[1]+M,pt=t*G[0]+L,dt=t*G[1]+M,ot=t*Y[0]+L,ut=t*Y[1]+M;q===0&&(N.push(tt,Z),B.push(tt,Z)),N.push(at,lt,pt,dt,ot,ut),B.push(at,lt),q===nt-1&&B.push(ot,ut)}y.push({bezier:l.#G(N,p,this.rotation),points:l.#G(B,p,this.rotation)})}return y}#V(){let t=1/0,i=-1/0,c=1/0,p=-1/0;for(const y of this.paths)for(const[S,L,M,O]of y){const N=w.Util.bezierBoundingBox(...S,...L,...M,...O);t=Math.min(t,N[0]),c=Math.min(c,N[1]),i=Math.max(i,N[2]),p=Math.max(p,N[3])}return[t,c,i,p]}#B(){return this.#h?Math.ceil(this.thickness*this.parentScale):0}#N(t=!1){if(this.isEmpty())return;if(!this.#h){this.#E();return}const i=this.#V(),c=this.#B();this.#e=Math.max(z.AnnotationEditor.MIN_SIZE,i[2]-i[0]),this.#t=Math.max(z.AnnotationEditor.MIN_SIZE,i[3]-i[1]);const p=Math.ceil(c+this.#e*this.scaleFactor),y=Math.ceil(c+this.#t*this.scaleFactor),[S,L]=this.parentDimensions;this.width=p/S,this.height=y/L,this.setAspectRatio(p,y);const M=this.translationX,O=this.translationY;this.translationX=-i[0],this.translationY=-i[1],this.#F(),this.#E(),this.#o=p,this.#p=y,this.setDims(p,y);const N=t?c/this.scaleFactor/2:0;this.translate(M-this.translationX-N,O-this.translationY-N)}static deserialize(t,i,c){if(t instanceof V.InkAnnotationElement)return null;const p=super.deserialize(t,i,c);p.thickness=t.thickness,p.color=w.Util.makeHexColor(...t.color),p.opacity=t.opacity;const[y,S]=p.pageDimensions,L=p.width*y,M=p.height*S,O=p.parentScale,N=t.thickness/2;p.#h=!0,p.#o=Math.round(L),p.#p=Math.round(M);const{paths:B,rect:q,rotation:nt}=t;for(let{bezier:H}of B){H=l.#$(H,q,nt);const G=[];p.paths.push(G);let Y=O*(H[0]-N),tt=O*(H[1]-N);for(let at=2,lt=H.length;at<lt;at+=6){const pt=O*(H[at]-N),dt=O*(H[at+1]-N),ot=O*(H[at+2]-N),ut=O*(H[at+3]-N),et=O*(H[at+4]-N),m=O*(H[at+5]-N);G.push([[Y,tt],[pt,dt],[ot,ut],[et,m]]),Y=et,tt=m}const Z=this.#D(G);p.bezierPath2D.push(Z)}const j=p.#V();return p.#e=Math.max(z.AnnotationEditor.MIN_SIZE,j[2]-j[0]),p.#t=Math.max(z.AnnotationEditor.MIN_SIZE,j[3]-j[1]),p.#_(L,M),p}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),i=z.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:w.AnnotationEditorType.INK,color:i,thickness:this.thickness,opacity:this.opacity,paths:this.#X(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class b extends z.AnnotationEditor{#t=null;#e=null;#s=null;#n=null;#r=null;#i="";#a=null;#l=null;#h=null;#d=!1;#u=!1;static _type="stamp";static _editorType=w.AnnotationEditorType.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#r=t.bitmapFile}static initialize(t,i){z.AnnotationEditor.initialize(t,i)}static get supportedTypes(){const t=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,w.shadow)(this,"supportedTypes",t.map(i=>`image/${i}`))}static get supportedTypesStr(){return(0,w.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,i){i.pasteEditor(w.AnnotationEditorType.STAMP,{bitmapFile:t.getAsFile()})}#c(t,i=!1){if(!t){this.remove();return}this.#t=t.bitmap,i||(this.#e=t.id,this.#d=t.isSvg),t.file&&(this.#i=t.file.name),this.#g()}#o(){this.#s=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#p(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#c(i,!0)).finally(()=>this.#o());return}if(this.#n){const i=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(i).then(c=>this.#c(c)).finally(()=>this.#o());return}if(this.#r){const i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(i).then(c=>this.#c(c)).finally(()=>this.#o());return}const t=document.createElement("input");t.type="file",t.accept=b.supportedTypesStr,this.#s=new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const c=await this._uiManager.imageManager.getFromFile(t.files[0]);this.#c(c)}i()}),t.addEventListener("cancel",()=>{this.remove(),i()})}).finally(()=>this.#o()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#l?.disconnect(),this.#l=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#p();return}super.rebuild(),this.div!==null&&(this.#e&&this.#a===null&&this.#p(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#n||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let t,i;if(this.width&&(t=this.x,i=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),this.#t?this.#g():this.#p(),this.width){const[c,p]=this.parentDimensions;this.setAt(t*c,i*p,this.width*c,this.height*p)}return this.div}#g(){const{div:t}=this;let{width:i,height:c}=this.#t;const[p,y]=this.pageDimensions,S=.75;if(this.width)i=this.width*p,c=this.height*y;else if(i>S*p||c>S*y){const N=Math.min(S*p/i,S*y/c);i*=N,c*=N}const[L,M]=this.parentDimensions;this.setDims(i*L/p,c*M/y),this._uiManager.enableWaiting(!1);const O=this.#a=document.createElement("canvas");t.append(O),t.hidden=!1,this.#m(i,c),this.#w(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&O.setAttribute("aria-label",this.#i)}#f(t,i){const[c,p]=this.parentDimensions;this.width=t/c,this.height=i/p,this.setDims(t,i),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#h!==null&&clearTimeout(this.#h);const y=200;this.#h=setTimeout(()=>{this.#h=null,this.#m(t,i)},y)}#A(t,i){const{width:c,height:p}=this.#t;let y=c,S=p,L=this.#t;for(;y>2*t||S>2*i;){const M=y,O=S;y>2*t&&(y=y>=16384?Math.floor(y/2)-1:Math.ceil(y/2)),S>2*i&&(S=S>=16384?Math.floor(S/2)-1:Math.ceil(S/2));const N=new OffscreenCanvas(y,S);N.getContext("2d").drawImage(L,0,0,M,O,0,0,y,S),L=N.transferToImageBitmap()}return L}#m(t,i){t=Math.ceil(t),i=Math.ceil(i);const c=this.#a;if(!c||c.width===t&&c.height===i)return;c.width=t,c.height=i;const p=this.#d?this.#t:this.#A(t,i);if(this._uiManager.hasMLManager&&!this.hasAltText()){const S=new OffscreenCanvas(t,i);S.getContext("2d").drawImage(p,0,0,p.width,p.height,0,0,t,i),S.convertToBlob().then(M=>{const O=new FileReader;O.onload=()=>{const N=O.result;this._uiManager.mlGuess({service:"image-to-text",request:{imageData:N}}).then(B=>{const q=B?.output||"";this.parent&&q&&!this.hasAltText()&&(this.altTextData={altText:q,decorative:!1})})},O.readAsDataURL(M)})}const y=c.getContext("2d");y.filter=this._uiManager.hcmFilter,y.drawImage(p,0,0,p.width,p.height,0,0,t,i)}getImageForAltText(){return this.#a}#v(t){if(t){if(this.#d){const p=this._uiManager.imageManager.getSvgUrl(this.#e);if(p)return p}const i=document.createElement("canvas");return{width:i.width,height:i.height}=this.#t,i.getContext("2d").drawImage(this.#t,0,0),i.toDataURL()}if(this.#d){const[i,c]=this.pageDimensions,p=Math.round(this.width*i*r.PixelsPerInch.PDF_TO_CSS_UNITS),y=Math.round(this.height*c*r.PixelsPerInch.PDF_TO_CSS_UNITS),S=new OffscreenCanvas(p,y);return S.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,p,y),S.transferToImageBitmap()}return structuredClone(this.#t)}#w(){this.#l=new ResizeObserver(t=>{const i=t[0].contentRect;i.width&&i.height&&this.#f(i.width,i.height)}),this.#l.observe(this.div)}static deserialize(t,i,c){if(t instanceof V.StampAnnotationElement)return null;const p=super.deserialize(t,i,c),{rect:y,bitmapUrl:S,bitmapId:L,isSvg:M,accessibilityData:O}=t;L&&c.imageManager.isValidId(L)?p.#e=L:p.#n=S,p.#d=M;const[N,B]=p.pageDimensions;return p.width=(y[2]-y[0])/N,p.height=(y[3]-y[1])/B,O&&(p.altTextData=O),p}serialize(t=!1,i=null){if(this.isEmpty())return null;const c={annotationType:w.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#d,structTreeParentId:this._structTreeParentId};if(t)return c.bitmapUrl=this.#v(!0),c.accessibilityData=this.altTextData,c;const{decorative:p,altText:y}=this.altTextData;if(!p&&y&&(c.accessibilityData={type:"Figure",alt:y}),i===null)return c;i.stamps||=new Map;const S=this.#d?(c.rect[2]-c.rect[0])*(c.rect[3]-c.rect[1]):null;if(!i.stamps.has(this.#e))i.stamps.set(this.#e,{area:S,serialized:c}),c.bitmap=this.#v(!1);else if(this.#d){const L=i.stamps.get(this.#e);S>L.area&&(L.area=S,L.serialized.bitmap.close(),L.serialized.bitmap=this.#v(!1))}return c}}class s{#t;#e=!1;#s=null;#n=null;#r=null;#i=null;#a=null;#l=new Map;#h=!1;#d=!1;#u=!1;#c=null;#o;static _initialized=!1;static#p=new Map([C,l,b,d].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:i,div:c,accessibilityManager:p,annotationLayer:y,drawLayer:S,textLayer:L,viewport:M,l10n:O}){const N=[...s.#p.values()];if(!s._initialized){s._initialized=!0;for(const B of N)B.initialize(O,t)}t.registerEditorTypes(N),this.#o=t,this.pageIndex=i,this.div=c,this.#t=p,this.#s=y,this.viewport=M,this.#c=L,this.drawLayer=S,this.#o.addLayer(this)}get isEmpty(){return this.#l.size===0}get isInvisible(){return this.isEmpty&&this.#o.getMode()===w.AnnotationEditorType.NONE}updateToolbar(t){this.#o.updateToolbar(t)}updateMode(t=this.#o.getMode()){switch(this.#v(),t){case w.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case w.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case w.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:i}=this.div;for(const c of s.#p.values())i.toggle(`${c._type}Editing`,t===c._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#c?.div}addInkEditorIfNeeded(t){if(this.#o.getMode()!==w.AnnotationEditorType.INK)return;if(!t){for(const c of this.#l.values())if(c.isEmpty()){c.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(t){this.#o.setEditingState(t)}addCommands(t){this.#o.addCommands(t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.div.classList.toggle("disabled",!t)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const c of this.#l.values())c.enableEditing(),c.show(!0),c.annotationElementId&&(this.#o.removeChangedExistingAnnotation(c),t.add(c.annotationElementId));if(!this.#s)return;const i=this.#s.getEditableAnnotations();for(const c of i){if(c.hide(),this.#o.isDeletedAnnotationElement(c.data.id)||t.has(c.data.id))continue;const p=this.deserialize(c);p&&(this.addOrRebuild(p),p.enableEditing())}}disable(){this.#u=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,i=new Map;for(const p of this.#l.values())if(p.disableEditing(),!!p.annotationElementId){if(p.serialize()!==null){t.set(p.annotationElementId,p);continue}else i.set(p.annotationElementId,p);this.getEditableAnnotation(p.annotationElementId)?.show(),p.remove()}if(this.#s){const p=this.#s.getEditableAnnotations();for(const y of p){const{id:S}=y.data;if(this.#o.isDeletedAnnotationElement(S))continue;let L=i.get(S);if(L){L.resetAnnotationElement(y),L.show(!1),y.show();continue}L=t.get(S),L&&(this.#o.addChangedExistingAnnotation(L),L.renderAnnotationElement(y),L.show(!1)),y.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:c}=this.div;for(const p of s.#p.values())c.remove(`${p._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#u=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#o.getActive()!==t&&this.#o.setActiveEditor(t)}enableTextSelection(){this.div.tabIndex=-1,this.#c?.div&&!this.#i&&(this.#i=this.#g.bind(this),this.#c.div.addEventListener("pointerdown",this.#i),this.#c.div.classList.add("highlighting"))}disableTextSelection(){this.div.tabIndex=0,this.#c?.div&&this.#i&&(this.#c.div.removeEventListener("pointerdown",this.#i),this.#i=null,this.#c.div.classList.remove("highlighting"))}#g(t){if(this.#o.unselectAll(),t.target===this.#c.div){const{isMac:i}=w.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#o.showAllEditors("highlight",!0,!0),this.#c.div.classList.add("free"),d.startHighlighting(this,this.#o.direction==="ltr",t),this.#c.div.addEventListener("pointerup",()=>{this.#c.div.classList.remove("free")},{once:!0}),t.preventDefault()}}enableClick(){this.#r||(this.#r=this.pointerdown.bind(this),this.#n=this.pointerup.bind(this),this.div.addEventListener("pointerdown",this.#r),this.div.addEventListener("pointerup",this.#n))}disableClick(){this.#r&&(this.div.removeEventListener("pointerdown",this.#r),this.div.removeEventListener("pointerup",this.#n),this.#r=null,this.#n=null)}attach(t){this.#l.set(t.id,t);const{annotationElementId:i}=t;i&&this.#o.isDeletedAnnotationElement(i)&&this.#o.removeDeletedAnnotationElement(t)}detach(t){this.#l.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#u&&t.annotationElementId&&this.#o.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#o.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,this.#d||this.addInkEditorIfNeeded(!1)}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#o.addDeletedAnnotationElement(t.annotationElementId),z.AnnotationEditor.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#o.addEditor(t),this.attach(t),!t.isAttachedToDOM){const i=t.render();this.div.append(i),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),this.#o.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:i}=document;t.div.contains(i)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0}),i.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const i=()=>t._uiManager.rebuild(t),c=()=>{t.remove()};this.addCommands({cmd:i,undo:c,mustExec:!1})}getNextId(){return this.#o.getId()}get#f(){return s.#p.get(this.#o.getMode())}#A(t){const i=this.#f;return i?new i.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#f?.canCreateNewEmptyEditor()}pasteEditor(t,i){this.#o.updateToolbar(t),this.#o.updateMode(t);const{offsetX:c,offsetY:p}=this.#m(),y=this.getNextId(),S=this.#A({parent:this,id:y,x:c,y:p,uiManager:this.#o,isCentered:!0,...i});S&&this.add(S)}deserialize(t){return s.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#o)||null}createAndAddNewEditor(t,i,c={}){const p=this.getNextId(),y=this.#A({parent:this,id:p,x:t.offsetX,y:t.offsetY,uiManager:this.#o,isCentered:i,...c});return y&&this.add(y),y}#m(){const{x:t,y:i,width:c,height:p}=this.div.getBoundingClientRect(),y=Math.max(0,t),S=Math.max(0,i),L=Math.min(window.innerWidth,t+c),M=Math.min(window.innerHeight,i+p),O=(y+L)/2-t,N=(S+M)/2-i,[B,q]=this.viewport.rotation%180===0?[O,N]:[N,O];return{offsetX:B,offsetY:q}}addNewEditor(){this.createAndAddNewEditor(this.#m(),!0)}setSelected(t){this.#o.setSelected(t)}toggleSelected(t){this.#o.toggleSelected(t)}isSelected(t){return this.#o.isSelected(t)}unselect(t){this.#o.unselect(t)}pointerup(t){const{isMac:i}=w.FeatureTest.platform;if(!(t.button!==0||t.ctrlKey&&i)&&t.target===this.div&&this.#h){if(this.#h=!1,!this.#e){this.#e=!0;return}if(this.#o.getMode()===w.AnnotationEditorType.STAMP){this.#o.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#o.getMode()===w.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#h){this.#h=!1;return}const{isMac:i}=w.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&i||t.target!==this.div)return;this.#h=!0;const c=this.#o.getActive();this.#e=!c||c.isEmpty()}findNewParent(t,i,c){const p=this.#o.findParent(i,c);return p===null||p===this?!1:(p.changeParent(t),!0)}destroy(){this.#o.getActive()?.parent===this&&(this.#o.commitOrRemove(),this.#o.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#l.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#l.clear(),this.#o.removeLayer(this)}#v(){this.#d=!0;for(const t of this.#l.values())t.isEmpty()&&t.remove();this.#d=!1}render({viewport:t}){this.viewport=t,(0,r.setLayerDimensions)(this.div,t);for(const i of this.#o.getEditors(this.pageIndex))this.add(i),i.rebuild();this.updateMode()}update({viewport:t}){this.#o.commitOrRemove(),this.#v();const i=this.viewport.rotation,c=t.rotation;if(this.viewport=t,(0,r.setLayerDimensions)(this.div,{rotation:c}),i!==c)for(const p of this.#l.values())p.rotate(c);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:t,pageHeight:i}=this.viewport.rawDims;return[t,i]}get scale(){return this.#o.viewParameters.realScale}}},259:(ct,st,$)=>{$.d(st,{ColorPicker:()=>V});var w=$(292),z=$(830),_=$(419);class V{#t=this.#g.bind(this);#e=this.#A.bind(this);#s=null;#n=null;#r;#i=null;#a=!1;#l=!1;#h=null;#d;#u=null;#c;static get _keyboardManager(){return(0,w.shadow)(this,"_keyboardManager",new z.KeyboardManager([[["Escape","mac+Escape"],V.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],V.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],V.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],V.prototype._moveToPrevious],[["Home","mac+Home"],V.prototype._moveToBeginning],[["End","mac+End"],V.prototype._moveToEnd]]))}constructor({editor:C=null,uiManager:x=null}){C?(this.#l=!1,this.#c=w.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.#h=C):(this.#l=!0,this.#c=w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR),this.#u=C?._uiManager||x,this.#d=this.#u._eventBus,this.#r=C?.color||this.#u?.highlightColors.values().next().value||"#FFFF98"}renderButton(){const C=this.#s=document.createElement("button");C.className="colorPicker",C.tabIndex="0",C.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),C.setAttribute("aria-haspopup",!0),C.addEventListener("click",this.#f.bind(this)),C.addEventListener("keydown",this.#t);const x=this.#n=document.createElement("span");return x.className="swatch",x.setAttribute("aria-hidden",!0),x.style.backgroundColor=this.#r,C.append(x),C}renderMainDropdown(){const C=this.#i=this.#o();return C.setAttribute("aria-orientation","horizontal"),C.setAttribute("aria-labelledby","highlightColorPickerLabel"),C}#o(){const C=document.createElement("div");C.addEventListener("contextmenu",_.noContextMenu),C.className="dropdown",C.role="listbox",C.setAttribute("aria-multiselectable",!1),C.setAttribute("aria-orientation","vertical"),C.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[x,v]of this.#u.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",v),r.title=x,r.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${x}`);const d=document.createElement("span");r.append(d),d.className="swatch",d.style.backgroundColor=v,r.setAttribute("aria-selected",v===this.#r),r.addEventListener("click",this.#p.bind(this,v)),C.append(r)}return C.addEventListener("keydown",this.#t),C}#p(C,x){x.stopPropagation(),this.#d.dispatch("switchannotationeditorparams",{source:this,type:this.#c,value:C})}_colorSelectFromKeyboard(C){if(C.target===this.#s){this.#f(C);return}const x=C.target.getAttribute("data-color");x&&this.#p(x,C)}_moveToNext(C){if(!this.#m){this.#f(C);return}if(C.target===this.#s){this.#i.firstChild?.focus();return}C.target.nextSibling?.focus()}_moveToPrevious(C){if(C.target===this.#i?.firstChild||C.target===this.#s){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#f(C),C.target.previousSibling?.focus()}_moveToBeginning(C){if(!this.#m){this.#f(C);return}this.#i.firstChild?.focus()}_moveToEnd(C){if(!this.#m){this.#f(C);return}this.#i.lastChild?.focus()}#g(C){V._keyboardManager.exec(this,C)}#f(C){if(this.#m){this.hideDropdown();return}if(this.#a=C.detail===0,window.addEventListener("pointerdown",this.#e),this.#i){this.#i.classList.remove("hidden");return}const x=this.#i=this.#o();this.#s.append(x)}#A(C){this.#i?.contains(C.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),window.removeEventListener("pointerdown",this.#e)}get#m(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#l){if(!this.#m){this.#h?.unselect();return}this.hideDropdown(),this.#s.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(C){if(this.#n&&(this.#n.style.backgroundColor=C),!this.#i)return;const x=this.#u.highlightColors.values();for(const v of this.#i.children)v.setAttribute("aria-selected",x.next().value===C)}destroy(){this.#s?.remove(),this.#s=null,this.#n=null,this.#i?.remove(),this.#i=null}}},310:(ct,st,$)=>{$.d(st,{AnnotationEditor:()=>C});var w=$(830),z=$(292),_=$(419);class V{#t="";#e=!1;#s=null;#n=null;#r=null;#i=!1;#a=null;static _l10nPromise=null;constructor(r){this.#a=r}static initialize(r){V._l10nPromise||=r}async render(){const r=this.#s=document.createElement("button");r.className="altText";const d=await V._l10nPromise.get("pdfjs-editor-alt-text-button-label");r.textContent=d,r.setAttribute("aria-label",d),r.tabIndex="0",r.addEventListener("contextmenu",_.noContextMenu),r.addEventListener("pointerdown",b=>b.stopPropagation());const l=b=>{b.preventDefault(),this.#a._uiManager.editAltText(this.#a)};return r.addEventListener("click",l,{capture:!0}),r.addEventListener("keydown",b=>{b.target===r&&b.key==="Enter"&&(this.#i=!0,l(b))}),await this.#l(),r}finish(){this.#s&&(this.#s.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return!this.#t&&!this.#e}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:r,decorative:d}){this.#t===r&&this.#e===d||(this.#t=r,this.#e=d,this.#l())}toggle(r=!1){this.#s&&(!r&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#s.disabled=!r)}destroy(){this.#s?.remove(),this.#s=null,this.#n=null}async#l(){const r=this.#s;if(!r)return;if(!this.#t&&!this.#e){r.classList.remove("done"),this.#n?.remove();return}r.classList.add("done"),V._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(b=>{r.setAttribute("aria-label",b)});let d=this.#n;if(!d){this.#n=d=document.createElement("span"),d.className="tooltip",d.setAttribute("role","tooltip");const b=d.id=`alt-text-tooltip-${this.#a.id}`;r.setAttribute("aria-describedby",b);const s=100;r.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#n.classList.add("show"),this.#a._reportTelemetry({action:"alt_text_tooltip"})},s)}),r.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#n?.classList.remove("show")})}d.innerText=this.#e?await V._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#t,d.parentNode||r.append(d),this.#a.getImageForAltText()?.setAttribute("aria-describedby",d.id)}}var P=$(362);class C{#t=null;#e=null;#s=!1;#n=!1;#r=null;#i=null;#a=this.focusin.bind(this);#l=this.focusout.bind(this);#h=null;#d="";#u=!1;#c=null;#o=!1;#p=!1;#g=!1;#f=null;#A=0;#m=0;#v=null;_initialOptions=Object.create(null);_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#w=!1;#C=C._zIndex++;static _borderLineWidth=-1;static _colorManager=new w.ColorManager;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const r=C.prototype._resizeWithKeyboard,d=w.AnnotationEditorUIManager.TRANSLATE_SMALL,l=w.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,z.shadow)(this,"_resizerKeyboardManager",new w.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],r,{args:[-d,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],r,{args:[-l,0]}],[["ArrowRight","mac+ArrowRight"],r,{args:[d,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],r,{args:[l,0]}],[["ArrowUp","mac+ArrowUp"],r,{args:[0,-d]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],r,{args:[0,-l]}],[["ArrowDown","mac+ArrowDown"],r,{args:[0,d]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],r,{args:[0,l]}],[["Escape","mac+Escape"],C.prototype._stopResizingWithKeyboard]]))}constructor(r){this.constructor===C&&(0,z.unreachable)("Cannot initialize AnnotationEditor."),this.parent=r.parent,this.id=r.id,this.width=this.height=null,this.pageIndex=r.parent.pageIndex,this.name=r.name,this.div=null,this._uiManager=r.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=r.isCentered,this._structTreeParentId=null;const{rotation:d,rawDims:{pageWidth:l,pageHeight:b,pageX:s,pageY:g}}=this.parent.viewport;this.rotation=d,this.pageRotation=(360+d-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[l,b],this.pageTranslation=[s,g];const[t,i]=this.parentDimensions;this.x=r.x/t,this.y=r.y/i,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,z.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(r){const d=new x({id:r.parent.getNextId(),parent:r.parent,uiManager:r._uiManager});d.annotationElementId=r.annotationElementId,d.deleted=!0,d._uiManager.addToAnnotationStorage(d)}static initialize(r,d,l){if(C._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(s=>[s,r.get(s.replaceAll(/([A-Z])/g,g=>`-${g.toLowerCase()}`))])),l?.strings)for(const s of l.strings)C._l10nPromise.set(s,r.get(s));if(C._borderLineWidth!==-1)return;const b=getComputedStyle(document.documentElement);C._borderLineWidth=parseFloat(b.getPropertyValue("--outline-width"))||0}static updateDefaultParams(r,d){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(r){return!1}static paste(r,d){(0,z.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(r){this.#w=r,this.div?.classList.toggle("draggable",r)}get isEnterHandled(){return!0}center(){const[r,d]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*d/(r*2),this.y+=this.width*r/(d*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*d/(r*2),this.y-=this.width*r/(d*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(r){this._uiManager.addCommands(r)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#C}setParent(r){r!==null?(this.pageIndex=r.pageIndex,this.pageDimensions=r.pageDimensions):this.#D(),this.parent=r}focusin(r){this._focusEventsAllowed&&(this.#u?this.#u=!1:this.parent.setSelected(this))}focusout(r){!this._focusEventsAllowed||!this.isAttachedToDOM||r.relatedTarget?.closest(`#${this.id}`)||(r.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(r,d,l,b){const[s,g]=this.parentDimensions;[l,b]=this.screenToPageTranslation(l,b),this.x=(r+l)/s,this.y=(d+b)/g,this.fixAndSetPosition()}#k([r,d],l,b){[l,b]=this.screenToPageTranslation(l,b),this.x+=l/r,this.y+=b/d,this.fixAndSetPosition()}translate(r,d){this.#k(this.parentDimensions,r,d)}translateInPage(r,d){this.#c||=[this.x,this.y],this.#k(this.pageDimensions,r,d),this.div.scrollIntoView({block:"nearest"})}drag(r,d){this.#c||=[this.x,this.y];const[l,b]=this.parentDimensions;if(this.x+=r/l,this.y+=d/b,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:c,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,c,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:s,y:g}=this;const[t,i]=this.getBaseTranslation();s+=t,g+=i,this.div.style.left=`${(100*s).toFixed(2)}%`,this.div.style.top=`${(100*g).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#c&&(this.#c[0]!==this.x||this.#c[1]!==this.y)}getBaseTranslation(){const[r,d]=this.parentDimensions,{_borderLineWidth:l}=C,b=l/r,s=l/d;switch(this.rotation){case 90:return[-b,s];case 180:return[b,s];case 270:return[b,-s];default:return[-b,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(r=this.rotation){const[d,l]=this.pageDimensions;let{x:b,y:s,width:g,height:t}=this;if(g*=d,t*=l,b*=d,s*=l,this._mustFixPosition)switch(r){case 0:b=Math.max(0,Math.min(d-g,b)),s=Math.max(0,Math.min(l-t,s));break;case 90:b=Math.max(0,Math.min(d-t,b)),s=Math.min(l,Math.max(g,s));break;case 180:b=Math.min(d,Math.max(g,b)),s=Math.min(l,Math.max(t,s));break;case 270:b=Math.min(d,Math.max(t,b)),s=Math.max(0,Math.min(l-g,s));break}this.x=b/=d,this.y=s/=l;const[i,c]=this.getBaseTranslation();b+=i,s+=c;const{style:p}=this.div;p.left=`${(100*b).toFixed(2)}%`,p.top=`${(100*s).toFixed(2)}%`,this.moveInDOM()}static#I(r,d,l){switch(l){case 90:return[d,-r];case 180:return[-r,-d];case 270:return[-d,r];default:return[r,d]}}screenToPageTranslation(r,d){return C.#I(r,d,this.parentRotation)}pageTranslationToScreen(r,d){return C.#I(r,d,360-this.parentRotation)}#L(r){switch(r){case 90:{const[d,l]=this.pageDimensions;return[0,-d/l,l/d,0]}case 180:return[-1,0,0,-1];case 270:{const[d,l]=this.pageDimensions;return[0,d/l,-l/d,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:r,pageDimensions:[d,l]}=this,b=d*r,s=l*r;return z.FeatureTest.isCSSRoundSupported?[Math.round(b),Math.round(s)]:[b,s]}setDims(r,d){const[l,b]=this.parentDimensions;this.div.style.width=`${(100*r/l).toFixed(2)}%`,this.#n||(this.div.style.height=`${(100*d/b).toFixed(2)}%`)}fixDims(){const{style:r}=this.div,{height:d,width:l}=r,b=l.endsWith("%"),s=!this.#n&&d.endsWith("%");if(b&&s)return;const[g,t]=this.parentDimensions;b||(r.width=`${(100*parseFloat(l)/g).toFixed(2)}%`),!this.#n&&!s&&(r.height=`${(100*parseFloat(d)/t).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#y(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const r=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(const d of r){const l=document.createElement("div");this.#r.append(l),l.classList.add("resizer",d),l.setAttribute("data-resizer-name",d),l.addEventListener("pointerdown",this.#b.bind(this,d)),l.addEventListener("contextmenu",_.noContextMenu),l.tabIndex=-1}this.div.prepend(this.#r)}#b(r,d){d.preventDefault();const{isMac:l}=z.FeatureTest.platform;if(d.button!==0||d.ctrlKey&&l)return;this.#e?.toggle(!1);const b=this.#E.bind(this,r),s=this._isDraggable;this._isDraggable=!1;const g={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",b,g),window.addEventListener("contextmenu",_.noContextMenu);const t=this.x,i=this.y,c=this.width,p=this.height,y=this.parent.div.style.cursor,S=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(d.target).cursor;const L=()=>{this.parent.togglePointerEvents(!0),this.#e?.toggle(!0),this._isDraggable=s,window.removeEventListener("pointerup",L),window.removeEventListener("blur",L),window.removeEventListener("pointermove",b,g),window.removeEventListener("contextmenu",_.noContextMenu),this.parent.div.style.cursor=y,this.div.style.cursor=S,this.#S(t,i,c,p)};window.addEventListener("pointerup",L),window.addEventListener("blur",L)}#S(r,d,l,b){const s=this.x,g=this.y,t=this.width,i=this.height;s===r&&g===d&&t===l&&i===b||this.addCommands({cmd:()=>{this.width=t,this.height=i,this.x=s,this.y=g;const[c,p]=this.parentDimensions;this.setDims(c*t,p*i),this.fixAndSetPosition()},undo:()=>{this.width=l,this.height=b,this.x=r,this.y=d;const[c,p]=this.parentDimensions;this.setDims(c*l,p*b),this.fixAndSetPosition()},mustExec:!0})}#E(r,d){const[l,b]=this.parentDimensions,s=this.x,g=this.y,t=this.width,i=this.height,c=C.MIN_SIZE/l,p=C.MIN_SIZE/b,y=m=>Math.round(m*1e4)/1e4,S=this.#L(this.rotation),L=(m,h)=>[S[0]*m+S[2]*h,S[1]*m+S[3]*h],M=this.#L(360-this.rotation),O=(m,h)=>[M[0]*m+M[2]*h,M[1]*m+M[3]*h];let N,B,q=!1,nt=!1;switch(r){case"topLeft":q=!0,N=(m,h)=>[0,0],B=(m,h)=>[m,h];break;case"topMiddle":N=(m,h)=>[m/2,0],B=(m,h)=>[m/2,h];break;case"topRight":q=!0,N=(m,h)=>[m,0],B=(m,h)=>[0,h];break;case"middleRight":nt=!0,N=(m,h)=>[m,h/2],B=(m,h)=>[0,h/2];break;case"bottomRight":q=!0,N=(m,h)=>[m,h],B=(m,h)=>[0,0];break;case"bottomMiddle":N=(m,h)=>[m/2,h],B=(m,h)=>[m/2,0];break;case"bottomLeft":q=!0,N=(m,h)=>[0,h],B=(m,h)=>[m,0];break;case"middleLeft":nt=!0,N=(m,h)=>[0,h/2],B=(m,h)=>[m,h/2];break}const j=N(t,i),H=B(t,i);let G=L(...H);const Y=y(s+G[0]),tt=y(g+G[1]);let Z=1,at=1,[lt,pt]=this.screenToPageTranslation(d.movementX,d.movementY);if([lt,pt]=O(lt/l,pt/b),q){const m=Math.hypot(t,i);Z=at=Math.max(Math.min(Math.hypot(H[0]-j[0]-lt,H[1]-j[1]-pt)/m,1/t,1/i),c/t,p/i)}else nt?Z=Math.max(c,Math.min(1,Math.abs(H[0]-j[0]-lt)))/t:at=Math.max(p,Math.min(1,Math.abs(H[1]-j[1]-pt)))/i;const dt=y(t*Z),ot=y(i*at);G=L(...B(dt,ot));const ut=Y-G[0],et=tt-G[1];this.width=dt,this.height=ot,this.x=ut,this.y=et,this.setDims(l*dt,b*ot),this.fixAndSetPosition()}altTextFinish(){this.#e?.finish()}async addEditToolbar(){return this.#h||this.#p?this.#h:(this.#h=new P.EditorToolbar(this),this.div.append(this.#h.render()),this.#e&&this.#h.addAltTextButton(await this.#e.render()),this.#h)}removeEditToolbar(){this.#h&&(this.#h.remove(),this.#h=null,this.#e?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#e||(V.initialize(C._l10nPromise),this.#e=new V(this),await this.addEditToolbar())}get altTextData(){return this.#e?.data}set altTextData(r){this.#e&&(this.#e.data=r)}hasAltText(){return!this.#e?.isEmpty()}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#s?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.div.addEventListener("focusin",this.#a),this.div.addEventListener("focusout",this.#l);const[r,d]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*d/r).toFixed(2)}%`,this.div.style.maxHeight=`${(100*r/d).toFixed(2)}%`);const[l,b]=this.getInitialTranslation();return this.translate(l,b),(0,w.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(r){const{isMac:d}=z.FeatureTest.platform;if(r.button!==0||r.ctrlKey&&d){r.preventDefault();return}if(this.#u=!0,this._isDraggable){this.#T(r);return}this.#R(r)}#R(r){const{isMac:d}=z.FeatureTest.platform;r.ctrlKey&&!d||r.shiftKey||r.metaKey&&d?this.parent.toggleSelected(this):this.parent.setSelected(this)}#T(r){const d=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let l,b;d&&(this.div.classList.add("moving"),l={passive:!0,capture:!0},this.#A=r.clientX,this.#m=r.clientY,b=g=>{const{clientX:t,clientY:i}=g,[c,p]=this.screenToPageTranslation(t-this.#A,i-this.#m);this.#A=t,this.#m=i,this._uiManager.dragSelectedEditors(c,p)},window.addEventListener("pointermove",b,l));const s=()=>{window.removeEventListener("pointerup",s),window.removeEventListener("blur",s),d&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",b,l)),this.#u=!1,this._uiManager.endDragSession()||this.#R(r)};window.addEventListener("pointerup",s),window.addEventListener("blur",s)}moveInDOM(){this.#f&&clearTimeout(this.#f),this.#f=setTimeout(()=>{this.#f=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(r,d,l){r.changeParent(this),this.x=d,this.y=l,this.fixAndSetPosition()}getRect(r,d,l=this.rotation){const b=this.parentScale,[s,g]=this.pageDimensions,[t,i]=this.pageTranslation,c=r/b,p=d/b,y=this.x*s,S=this.y*g,L=this.width*s,M=this.height*g;switch(l){case 0:return[y+c+t,g-S-p-M+i,y+c+L+t,g-S-p+i];case 90:return[y+p+t,g-S+c+i,y+p+M+t,g-S+c+L+i];case 180:return[y-c-L+t,g-S+p+i,y-c+t,g-S+p+M+i];case 270:return[y-p-M+t,g-S-c-L+i,y-p+t,g-S-c+i];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(r,d){const[l,b,s,g]=r,t=s-l,i=g-b;switch(this.rotation){case 0:return[l,d-g,t,i];case 90:return[l,d-b,i,t];case 180:return[s,d-b,t,i];case 270:return[s,d-g,i,t];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#p=!0}disableEditMode(){this.#p=!1}isInEditMode(){return this.#p}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#a),this.div?.addEventListener("focusout",this.#l)}rotate(r){}serialize(r=!1,d=null){(0,z.unreachable)("An editor must be serializable")}static deserialize(r,d,l){const b=new this.prototype.constructor({parent:d,id:d.getNextId(),uiManager:l});b.rotation=r.rotation;const[s,g]=b.pageDimensions,[t,i,c,p]=b.getRectInCurrentCoords(r.rect,g);return b.x=t/s,b.y=i/g,b.width=c/s,b.height=p/g,b}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.div.removeEventListener("focusin",this.#a),this.div.removeEventListener("focusout",this.#l),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#f&&(clearTimeout(this.#f),this.#f=null),this.#D(),this.removeEditToolbar(),this.#v){for(const r of this.#v.values())clearTimeout(r);this.#v=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#y(),this.#r.classList.remove("hidden"),(0,w.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(r){if(!this.isResizable||r.target!==this.div||r.key!=="Enter")return;this._uiManager.setSelected(this),this.#i={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const d=this.#r.children;if(!this.#t){this.#t=Array.from(d);const g=this.#M.bind(this),t=this.#F.bind(this);for(const i of this.#t){const c=i.getAttribute("data-resizer-name");i.setAttribute("role","spinbutton"),i.addEventListener("keydown",g),i.addEventListener("blur",t),i.addEventListener("focus",this.#_.bind(this,c)),C._l10nPromise.get(`pdfjs-editor-resizer-label-${c}`).then(p=>i.setAttribute("aria-label",p))}}const l=this.#t[0];let b=0;for(const g of d){if(g===l)break;b++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(s!==b){if(s<b)for(let t=0;t<b-s;t++)this.#r.append(this.#r.firstChild);else if(s>b)for(let t=0;t<s-b;t++)this.#r.firstChild.before(this.#r.lastChild);let g=0;for(const t of d){const c=this.#t[g++].getAttribute("data-resizer-name");C._l10nPromise.get(`pdfjs-editor-resizer-label-${c}`).then(p=>t.setAttribute("aria-label",p))}}this.#P(0),this.#g=!0,this.#r.firstChild.focus({focusVisible:!0}),r.preventDefault(),r.stopImmediatePropagation()}#M(r){C._resizerKeyboardManager.exec(this,r)}#F(r){this.#g&&r.relatedTarget?.parentNode!==this.#r&&this.#D()}#_(r){this.#d=this.#g?r:""}#P(r){if(this.#t)for(const d of this.#t)d.tabIndex=r}_resizeWithKeyboard(r,d){this.#g&&this.#E(this.#d,{movementX:r,movementY:d})}#D(){if(this.#g=!1,this.#P(-1),this.#i){const{savedX:r,savedY:d,savedWidth:l,savedHeight:b}=this.#i;this.#S(r,d,l,b),this.#i=null}}_stopResizingWithKeyboard(){this.#D(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this.#h){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#h?.show()});return}this.#h?.show()}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this.#h?.hide()}updateParams(r,d){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#o}set isEditing(r){this.#o=r,this.parent&&(r?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(r,d){this.#n=!0;const l=r/d,{style:b}=this.div;b.aspectRatio=l,b.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(r,d=!1){if(d){this.#v||=new Map;const{action:l}=r;let b=this.#v.get(l);b&&clearTimeout(b),b=setTimeout(()=>{this._reportTelemetry(r),this.#v.delete(l),this.#v.size===0&&(this.#v=null)},C._telemetryTimeout),this.#v.set(l,b);return}r.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:r}})}show(r=this._isVisible){this.div.classList.toggle("hidden",!r),this._isVisible=r}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}renderAnnotationElement(r){let d=r.container.querySelector(".annotationContent");if(!d)d=document.createElement("div"),d.classList.add("annotationContent",this.editorType),r.container.prepend(d);else if(d.nodeName==="CANVAS"){const l=d;d=document.createElement("div"),d.classList.add("annotationContent",this.editorType),l.before(d)}return d}resetAnnotationElement(r){const{firstChild:d}=r.container;d.nodeName==="DIV"&&d.classList.contains("annotationContent")&&d.remove()}}class x extends C{constructor(r){super(r),this.annotationElementId=r.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},61:(ct,st,$)=>{$.d(st,{FreeOutliner:()=>P,Outliner:()=>z});var w=$(292);class z{#t;#e=[];#s=[];constructor(v,r=0,d=0,l=!0){let b=1/0,s=-1/0,g=1/0,t=-1/0;const c=10**-4;for(const{x:N,y:B,width:q,height:nt}of v){const j=Math.floor((N-r)/c)*c,H=Math.ceil((N+q+r)/c)*c,G=Math.floor((B-r)/c)*c,Y=Math.ceil((B+nt+r)/c)*c,tt=[j,G,Y,!0],Z=[H,G,Y,!1];this.#e.push(tt,Z),b=Math.min(b,j),s=Math.max(s,H),g=Math.min(g,G),t=Math.max(t,Y)}const p=s-b+2*d,y=t-g+2*d,S=b-d,L=g-d,M=this.#e.at(l?-1:-2),O=[M[0],M[2]];for(const N of this.#e){const[B,q,nt]=N;N[0]=(B-S)/p,N[1]=(q-L)/y,N[2]=(nt-L)/y}this.#t={x:S,y:L,width:p,height:y,lastPoint:O}}getOutlines(){this.#e.sort((r,d)=>r[0]-d[0]||r[1]-d[1]||r[2]-d[2]);const v=[];for(const r of this.#e)r[3]?(v.push(...this.#l(r)),this.#i(r)):(this.#a(r),v.push(...this.#l(r)));return this.#n(v)}#n(v){const r=[],d=new Set;for(const s of v){const[g,t,i]=s;r.push([g,t,s],[g,i,s])}r.sort((s,g)=>s[1]-g[1]||s[0]-g[0]);for(let s=0,g=r.length;s<g;s+=2){const t=r[s][2],i=r[s+1][2];t.push(i),i.push(t),d.add(t),d.add(i)}const l=[];let b;for(;d.size>0;){const s=d.values().next().value;let[g,t,i,c,p]=s;d.delete(s);let y=g,S=t;for(b=[g,i],l.push(b);;){let L;if(d.has(c))L=c;else if(d.has(p))L=p;else break;d.delete(L),[g,t,i,c,p]=L,y!==g&&(b.push(y,S,g,S===t?t:i),y=g),S=S===t?i:t}b.push(y,S)}return new V(l,this.#t)}#r(v){const r=this.#s;let d=0,l=r.length-1;for(;d<=l;){const b=d+l>>1,s=r[b][0];if(s===v)return b;s<v?d=b+1:l=b-1}return l+1}#i([,v,r]){const d=this.#r(v);this.#s.splice(d,0,[v,r])}#a([,v,r]){const d=this.#r(v);for(let l=d;l<this.#s.length;l++){const[b,s]=this.#s[l];if(b!==v)break;if(b===v&&s===r){this.#s.splice(l,1);return}}for(let l=d-1;l>=0;l--){const[b,s]=this.#s[l];if(b!==v)break;if(b===v&&s===r){this.#s.splice(l,1);return}}}#l(v){const[r,d,l]=v,b=[[r,d,l]],s=this.#r(l);for(let g=0;g<s;g++){const[t,i]=this.#s[g];for(let c=0,p=b.length;c<p;c++){const[,y,S]=b[c];if(!(i<=y||S<=t)){if(y>=t){if(S>i)b[c][1]=i;else{if(p===1)return[];b.splice(c,1),c--,p--}continue}b[c][2]=t,S>i&&b.push([r,i,S])}}}return b}}class _{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(v,r){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof C}}class V extends _{#t;#e;constructor(v,r){super(),this.#e=v,this.#t=r}toSVGPath(){const v=[];for(const r of this.#e){let[d,l]=r;v.push(`M${d} ${l}`);for(let b=2;b<r.length;b+=2){const s=r[b],g=r[b+1];s===d?(v.push(`V${g}`),l=g):g===l&&(v.push(`H${s}`),d=s)}v.push("Z")}return v.join(" ")}serialize([v,r,d,l],b){const s=[],g=d-v,t=l-r;for(const i of this.#e){const c=new Array(i.length);for(let p=0;p<i.length;p+=2)c[p]=v+i[p]*g,c[p+1]=l-i[p+1]*t;s.push(c)}return s}get box(){return this.#t}}class P{#t;#e=[];#s;#n;#r=[];#i=new Float64Array(18);#a;#l;#h;#d;#u;#c;#o=[];static#p=8;static#g=2;static#f=P.#p+P.#g;constructor({x:v,y:r},d,l,b,s,g=0){this.#t=d,this.#c=b*l,this.#n=s,this.#i.set([NaN,NaN,NaN,NaN,v,r],6),this.#s=g,this.#d=P.#p*l,this.#h=P.#f*l,this.#u=l,this.#o.push(v,r)}get free(){return!0}isEmpty(){return isNaN(this.#i[8])}#A(){const v=this.#i.subarray(4,6),r=this.#i.subarray(16,18),[d,l,b,s]=this.#t;return[(this.#a+(v[0]-r[0])/2-d)/b,(this.#l+(v[1]-r[1])/2-l)/s,(this.#a+(r[0]-v[0])/2-d)/b,(this.#l+(r[1]-v[1])/2-l)/s]}add({x:v,y:r}){this.#a=v,this.#l=r;const[d,l,b,s]=this.#t;let[g,t,i,c]=this.#i.subarray(8,12);const p=v-i,y=r-c,S=Math.hypot(p,y);if(S<this.#h)return!1;const L=S-this.#d,M=L/S,O=M*p,N=M*y;let B=g,q=t;g=i,t=c,i+=O,c+=N,this.#o?.push(v,r);const nt=-N/L,j=O/L,H=nt*this.#c,G=j*this.#c;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([i+H,c+G],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([i-H,c-G],16),isNaN(this.#i[6])?(this.#r.length===0&&(this.#i.set([g+H,t+G],2),this.#r.push(NaN,NaN,NaN,NaN,(g+H-d)/b,(t+G-l)/s),this.#i.set([g-H,t-G],14),this.#e.push(NaN,NaN,NaN,NaN,(g-H-d)/b,(t-G-l)/s)),this.#i.set([B,q,g,t,i,c],6),!this.isEmpty()):(this.#i.set([B,q,g,t,i,c],6),Math.abs(Math.atan2(q-t,B-g)-Math.atan2(N,O))<Math.PI/2?([g,t,i,c]=this.#i.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((g+i)/2-d)/b,((t+c)/2-l)/s),[g,t,B,q]=this.#i.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((B+g)/2-d)/b,((q+t)/2-l)/s),!0):([B,q,g,t,i,c]=this.#i.subarray(0,6),this.#r.push(((B+5*g)/6-d)/b,((q+5*t)/6-l)/s,((5*g+i)/6-d)/b,((5*t+c)/6-l)/s,((g+i)/2-d)/b,((t+c)/2-l)/s),[i,c,g,t,B,q]=this.#i.subarray(12,18),this.#e.push(((B+5*g)/6-d)/b,((q+5*t)/6-l)/s,((5*g+i)/6-d)/b,((5*t+c)/6-l)/s,((g+i)/2-d)/b,((t+c)/2-l)/s),!0))}toSVGPath(){if(this.isEmpty())return"";const v=this.#r,r=this.#e,d=this.#i.subarray(4,6),l=this.#i.subarray(16,18),[b,s,g,t]=this.#t,[i,c,p,y]=this.#A();if(isNaN(this.#i[6])&&!this.isEmpty())return`M${(this.#i[2]-b)/g} ${(this.#i[3]-s)/t} L${(this.#i[4]-b)/g} ${(this.#i[5]-s)/t} L${i} ${c} L${p} ${y} L${(this.#i[16]-b)/g} ${(this.#i[17]-s)/t} L${(this.#i[14]-b)/g} ${(this.#i[15]-s)/t} Z`;const S=[];S.push(`M${v[4]} ${v[5]}`);for(let L=6;L<v.length;L+=6)isNaN(v[L])?S.push(`L${v[L+4]} ${v[L+5]}`):S.push(`C${v[L]} ${v[L+1]} ${v[L+2]} ${v[L+3]} ${v[L+4]} ${v[L+5]}`);S.push(`L${(d[0]-b)/g} ${(d[1]-s)/t} L${i} ${c} L${p} ${y} L${(l[0]-b)/g} ${(l[1]-s)/t}`);for(let L=r.length-6;L>=6;L-=6)isNaN(r[L])?S.push(`L${r[L+4]} ${r[L+5]}`):S.push(`C${r[L]} ${r[L+1]} ${r[L+2]} ${r[L+3]} ${r[L+4]} ${r[L+5]}`);return S.push(`L${r[4]} ${r[5]} Z`),S.join(" ")}getOutlines(){const v=this.#r,r=this.#e,d=this.#i,l=d.subarray(4,6),b=d.subarray(16,18),[s,g,t,i]=this.#t,c=new Float64Array((this.#o?.length??0)+2);for(let N=0,B=c.length-2;N<B;N+=2)c[N]=(this.#o[N]-s)/t,c[N+1]=(this.#o[N+1]-g)/i;c[c.length-2]=(this.#a-s)/t,c[c.length-1]=(this.#l-g)/i;const[p,y,S,L]=this.#A();if(isNaN(d[6])&&!this.isEmpty()){const N=new Float64Array(36);return N.set([NaN,NaN,NaN,NaN,(d[2]-s)/t,(d[3]-g)/i,NaN,NaN,NaN,NaN,(d[4]-s)/t,(d[5]-g)/i,NaN,NaN,NaN,NaN,p,y,NaN,NaN,NaN,NaN,S,L,NaN,NaN,NaN,NaN,(d[16]-s)/t,(d[17]-g)/i,NaN,NaN,NaN,NaN,(d[14]-s)/t,(d[15]-g)/i],0),new C(N,c,this.#t,this.#u,this.#s,this.#n)}const M=new Float64Array(this.#r.length+24+this.#e.length);let O=v.length;for(let N=0;N<O;N+=2){if(isNaN(v[N])){M[N]=M[N+1]=NaN;continue}M[N]=v[N],M[N+1]=v[N+1]}M.set([NaN,NaN,NaN,NaN,(l[0]-s)/t,(l[1]-g)/i,NaN,NaN,NaN,NaN,p,y,NaN,NaN,NaN,NaN,S,L,NaN,NaN,NaN,NaN,(b[0]-s)/t,(b[1]-g)/i],O),O+=24;for(let N=r.length-6;N>=6;N-=6)for(let B=0;B<6;B+=2){if(isNaN(r[N+B])){M[O]=M[O+1]=NaN,O+=2;continue}M[O]=r[N+B],M[O+1]=r[N+B+1],O+=2}return M.set([NaN,NaN,NaN,NaN,r[4],r[5]],O),new C(M,c,this.#t,this.#u,this.#s,this.#n)}}class C extends _{#t;#e=null;#s;#n;#r;#i;#a;constructor(v,r,d,l,b,s){super(),this.#a=v,this.#r=r,this.#t=d,this.#i=l,this.#s=b,this.#n=s,this.#d(s);const{x:g,y:t,width:i,height:c}=this.#e;for(let p=0,y=v.length;p<y;p+=2)v[p]=(v[p]-g)/i,v[p+1]=(v[p+1]-t)/c;for(let p=0,y=r.length;p<y;p+=2)r[p]=(r[p]-g)/i,r[p+1]=(r[p+1]-t)/c}toSVGPath(){const v=[`M${this.#a[4]} ${this.#a[5]}`];for(let r=6,d=this.#a.length;r<d;r+=6){if(isNaN(this.#a[r])){v.push(`L${this.#a[r+4]} ${this.#a[r+5]}`);continue}v.push(`C${this.#a[r]} ${this.#a[r+1]} ${this.#a[r+2]} ${this.#a[r+3]} ${this.#a[r+4]} ${this.#a[r+5]}`)}return v.push("Z"),v.join(" ")}serialize([v,r,d,l],b){const s=d-v,g=l-r;let t,i;switch(b){case 0:t=this.#l(this.#a,v,l,s,-g),i=this.#l(this.#r,v,l,s,-g);break;case 90:t=this.#h(this.#a,v,r,s,g),i=this.#h(this.#r,v,r,s,g);break;case 180:t=this.#l(this.#a,d,r,-s,g),i=this.#l(this.#r,d,r,-s,g);break;case 270:t=this.#h(this.#a,d,l,-s,-g),i=this.#h(this.#r,d,l,-s,-g);break}return{outline:Array.from(t),points:[Array.from(i)]}}#l(v,r,d,l,b){const s=new Float64Array(v.length);for(let g=0,t=v.length;g<t;g+=2)s[g]=r+v[g]*l,s[g+1]=d+v[g+1]*b;return s}#h(v,r,d,l,b){const s=new Float64Array(v.length);for(let g=0,t=v.length;g<t;g+=2)s[g]=r+v[g+1]*l,s[g+1]=d+v[g]*b;return s}#d(v){const r=this.#a;let d=r[4],l=r[5],b=d,s=l,g=d,t=l,i=d,c=l;const p=v?Math.max:Math.min;for(let O=6,N=r.length;O<N;O+=6){if(isNaN(r[O]))b=Math.min(b,r[O+4]),s=Math.min(s,r[O+5]),g=Math.max(g,r[O+4]),t=Math.max(t,r[O+5]),c<r[O+5]?(i=r[O+4],c=r[O+5]):c===r[O+5]&&(i=p(i,r[O+4]));else{const B=w.Util.bezierBoundingBox(d,l,...r.slice(O,O+6));b=Math.min(b,B[0]),s=Math.min(s,B[1]),g=Math.max(g,B[2]),t=Math.max(t,B[3]),c<B[3]?(i=B[2],c=B[3]):c===B[3]&&(i=p(i,B[2]))}d=r[O+4],l=r[O+5]}const y=b-this.#s,S=s-this.#s,L=g-b+2*this.#s,M=t-s+2*this.#s;this.#e={x:y,y:S,width:L,height:M,lastPoint:[i,c]}}get box(){return this.#e}getNewOutline(v,r){const{x:d,y:l,width:b,height:s}=this.#e,[g,t,i,c]=this.#t,p=b*i,y=s*c,S=d*i+g,L=l*c+t,M=new P({x:this.#r[0]*p+S,y:this.#r[1]*y+L},this.#t,this.#i,v,this.#n,r??this.#s);for(let O=2;O<this.#r.length;O+=2)M.add({x:this.#r[O]*p+S,y:this.#r[O+1]*y+L});return M.getOutlines()}}},362:(ct,st,$)=>{$.d(st,{EditorToolbar:()=>z,HighlightToolbar:()=>_});var w=$(419);class z{#t=null;#e=null;#s;#n=null;constructor(P){this.#s=P}render(){const P=this.#t=document.createElement("div");P.className="editToolbar",P.setAttribute("role","toolbar"),P.addEventListener("contextmenu",w.noContextMenu),P.addEventListener("pointerdown",z.#r);const C=this.#n=document.createElement("div");C.className="buttons",P.append(C);const x=this.#s.toolbarPosition;if(x){const{style:v}=P,r=this.#s._uiManager.direction==="ltr"?1-x[0]:x[0];v.insetInlineEnd=`${100*r}%`,v.top=`calc(${100*x[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),P}static#r(P){P.stopPropagation()}#i(P){this.#s._focusEventsAllowed=!1,P.preventDefault(),P.stopPropagation()}#a(P){this.#s._focusEventsAllowed=!0,P.preventDefault(),P.stopPropagation()}#l(P){P.addEventListener("focusin",this.#i.bind(this),{capture:!0}),P.addEventListener("focusout",this.#a.bind(this),{capture:!0}),P.addEventListener("contextmenu",w.noContextMenu)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden")}#h(){const P=document.createElement("button");P.className="delete",P.tabIndex=0,P.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#s.editorType}-button`),this.#l(P),P.addEventListener("click",C=>{this.#s._uiManager.delete()}),this.#n.append(P)}get#d(){const P=document.createElement("div");return P.className="divider",P}addAltTextButton(P){this.#l(P),this.#n.prepend(P,this.#d)}addColorPicker(P){this.#e=P;const C=P.renderButton();this.#l(C),this.#n.prepend(C,this.#d)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class _{#t=null;#e=null;#s;constructor(P){this.#s=P}#n(){const P=this.#e=document.createElement("div");P.className="editToolbar",P.setAttribute("role","toolbar"),P.addEventListener("contextmenu",w.noContextMenu);const C=this.#t=document.createElement("div");return C.className="buttons",P.append(C),this.#i(),P}#r(P,C){let x=0,v=0;for(const r of P){const d=r.y+r.height;if(d<x)continue;const l=r.x+(C?r.width:0);if(d>x){v=l,x=d;continue}C?l>v&&(v=l):l<v&&(v=l)}return[C?1-v:v,x]}show(P,C,x){const[v,r]=this.#r(C,x),{style:d}=this.#e||=this.#n();P.append(this.#e),d.insetInlineEnd=`${100*v}%`,d.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#i(){const P=document.createElement("button");P.className="highlightButton",P.tabIndex=0,P.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const C=document.createElement("span");P.append(C),C.className="visuallyHidden",C.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label"),P.addEventListener("contextmenu",w.noContextMenu),P.addEventListener("click",()=>{this.#s.highlightSelection("floating_button")}),this.#t.append(P)}}},830:(ct,st,$)=>{$.d(st,{AnnotationEditorUIManager:()=>l,ColorManager:()=>d,KeyboardManager:()=>r,bindEvents:()=>V,opacityToHex:()=>P});var w=$(292),z=$(419),_=$(362);function V(b,s,g){for(const t of g)s.addEventListener(t,b[t].bind(b))}function P(b){return Math.round(Math.min(255,Math.max(1,255*b))).toString(16).padStart(2,"0")}class C{#t=0;constructor(){}get id(){return`${w.AnnotationEditorPrefix}${this.#t++}`}}class x{#t=(0,w.getUuid)();#e=0;#s=null;static get _isSVGFittingCanvas(){const s='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',t=new OffscreenCanvas(1,3).getContext("2d"),i=new Image;i.src=s;const c=i.decode().then(()=>(t.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,w.shadow)(this,"_isSVGFittingCanvas",c)}async#n(s,g){this.#s||=new Map;let t=this.#s.get(s);if(t===null)return null;if(t?.bitmap)return t.refCounter+=1,t;try{t||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof g=="string"?(t.url=g,i=await(0,z.fetchData)(g,"blob")):i=t.file=g,i.type==="image/svg+xml"){const c=x._isSVGFittingCanvas,p=new FileReader,y=new Image,S=new Promise((L,M)=>{y.onload=()=>{t.bitmap=y,t.isSvg=!0,L()},p.onload=async()=>{const O=t.svgUrl=p.result;y.src=await c?`${O}#svgView(preserveAspectRatio(none))`:O},y.onerror=p.onerror=M});p.readAsDataURL(i),await S}else t.bitmap=await createImageBitmap(i);t.refCounter=1}catch(i){console.error(i),t=null}return this.#s.set(s,t),t&&this.#s.set(t.id,t),t}async getFromFile(s){const{lastModified:g,name:t,size:i,type:c}=s;return this.#n(`${g}_${t}_${i}_${c}`,s)}async getFromUrl(s){return this.#n(s,s)}async getFromId(s){this.#s||=new Map;const g=this.#s.get(s);return g?g.bitmap?(g.refCounter+=1,g):g.file?this.getFromFile(g.file):this.getFromUrl(g.url):null}getSvgUrl(s){const g=this.#s.get(s);return g?.isSvg?g.svgUrl:null}deleteId(s){this.#s||=new Map;const g=this.#s.get(s);g&&(g.refCounter-=1,g.refCounter===0&&(g.bitmap=null))}isValidId(s){return s.startsWith(`image_${this.#t}_`)}}class v{#t=[];#e=!1;#s;#n=-1;constructor(s=128){this.#s=s}add({cmd:s,undo:g,post:t,mustExec:i,type:c=NaN,overwriteIfSameType:p=!1,keepUndo:y=!1}){if(i&&s(),this.#e)return;const S={cmd:s,undo:g,post:t,type:c};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(S);return}if(p&&this.#t[this.#n].type===c){y&&(S.undo=this.#t[this.#n].undo),this.#t[this.#n]=S;return}const L=this.#n+1;L===this.#s?this.#t.splice(0,1):(this.#n=L,L<this.#t.length&&this.#t.splice(L)),this.#t.push(S)}undo(){if(this.#n===-1)return;this.#e=!0;const{undo:s,post:g}=this.#t[this.#n];s(),g?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:s,post:g}=this.#t[this.#n];s(),g?.(),this.#e=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}destroy(){this.#t=null}}class r{constructor(s){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:g}=w.FeatureTest.platform;for(const[t,i,c={}]of s)for(const p of t){const y=p.startsWith("mac+");g&&y?(this.callbacks.set(p.slice(4),{callback:i,options:c}),this.allKeys.add(p.split("+").at(-1))):!g&&!y&&(this.callbacks.set(p,{callback:i,options:c}),this.allKeys.add(p.split("+").at(-1)))}}#t(s){s.altKey&&this.buffer.push("alt"),s.ctrlKey&&this.buffer.push("ctrl"),s.metaKey&&this.buffer.push("meta"),s.shiftKey&&this.buffer.push("shift"),this.buffer.push(s.key);const g=this.buffer.join("+");return this.buffer.length=0,g}exec(s,g){if(!this.allKeys.has(g.key))return;const t=this.callbacks.get(this.#t(g));if(!t)return;const{callback:i,options:{bubbles:c=!1,args:p=[],checker:y=null}}=t;y&&!y(s,g)||(i.bind(s,...p,g)(),c||(g.stopPropagation(),g.preventDefault()))}}class d{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const s=new Map([["CanvasText",null],["Canvas",null]]);return(0,z.getColorValues)(s),(0,w.shadow)(this,"_colors",s)}convert(s){const g=(0,z.getRGB)(s);if(!window.matchMedia("(forced-colors: active)").matches)return g;for(const[t,i]of this._colors)if(i.every((c,p)=>c===g[p]))return d._colorsMapping.get(t);return g}getHexCode(s){const g=this._colors.get(s);return g?w.Util.makeHexColor(...g):s}}class l{#t=null;#e=new Map;#s=new Map;#n=null;#r=null;#i=null;#a=new v;#l=0;#h=new Set;#d=null;#u=null;#c=new Set;#o=!1;#p=null;#g=null;#f=null;#A=!1;#m=null;#v=new C;#w=!1;#C=!1;#k=null;#I=null;#L=null;#y=w.AnnotationEditorType.NONE;#b=new Set;#S=null;#E=null;#R=null;#T=this.blur.bind(this);#M=this.focus.bind(this);#F=this.copy.bind(this);#_=this.cut.bind(this);#P=this.paste.bind(this);#D=this.keydown.bind(this);#G=this.keyup.bind(this);#$=this.onEditingAction.bind(this);#X=this.onPageChanging.bind(this);#V=this.onScaleChanging.bind(this);#B=this.#rt.bind(this);#N=this.onRotationChanging.bind(this);#q={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#U=[0,0];#O=null;#z=null;#K=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const s=l.prototype,g=p=>p.#z.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&p.hasSomethingToControl(),t=(p,{target:y})=>{if(y instanceof HTMLInputElement){const{type:S}=y;return S!=="text"&&S!=="number"}return!0},i=this.TRANSLATE_SMALL,c=this.TRANSLATE_BIG;return(0,w.shadow)(this,"_keyboardManager",new r([[["ctrl+a","mac+meta+a"],s.selectAll,{checker:t}],[["ctrl+z","mac+meta+z"],s.undo,{checker:t}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],s.redo,{checker:t}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],s.delete,{checker:t}],[["Enter","mac+Enter"],s.addNewEditorFromKeyboard,{checker:(p,{target:y})=>!(y instanceof HTMLButtonElement)&&p.#z.contains(y)&&!p.isEnterHandled}],[[" ","mac+ "],s.addNewEditorFromKeyboard,{checker:(p,{target:y})=>!(y instanceof HTMLButtonElement)&&p.#z.contains(document.activeElement)}],[["Escape","mac+Escape"],s.unselectAll],[["ArrowLeft","mac+ArrowLeft"],s.translateSelectedEditors,{args:[-i,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],s.translateSelectedEditors,{args:[-c,0],checker:g}],[["ArrowRight","mac+ArrowRight"],s.translateSelectedEditors,{args:[i,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],s.translateSelectedEditors,{args:[c,0],checker:g}],[["ArrowUp","mac+ArrowUp"],s.translateSelectedEditors,{args:[0,-i],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],s.translateSelectedEditors,{args:[0,-c],checker:g}],[["ArrowDown","mac+ArrowDown"],s.translateSelectedEditors,{args:[0,i],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],s.translateSelectedEditors,{args:[0,c],checker:g}]]))}constructor(s,g,t,i,c,p,y,S,L){this.#z=s,this.#K=g,this.#n=t,this._eventBus=i,this._eventBus._on("editingaction",this.#$),this._eventBus._on("pagechanging",this.#X),this._eventBus._on("scalechanging",this.#V),this._eventBus._on("rotationchanging",this.#N),this.#at(),this.#J(),this.#r=c.annotationStorage,this.#p=c.filterFactory,this.#E=p,this.#f=y||null,this.#o=S,this.#L=L||null,this.viewParameters={realScale:z.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#Z(),this.#Q(),this._eventBus._off("editingaction",this.#$),this._eventBus._off("pagechanging",this.#X),this._eventBus._off("scalechanging",this.#V),this._eventBus._off("rotationchanging",this.#N);for(const s of this.#s.values())s.destroy();this.#s.clear(),this.#e.clear(),this.#c.clear(),this.#t=null,this.#b.clear(),this.#a.destroy(),this.#n?.destroy(),this.#m?.hide(),this.#m=null,this.#g&&(clearTimeout(this.#g),this.#g=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this.#ot()}async mlGuess(s){return this.#L?.guess(s)||null}get hasMLManager(){return!!this.#L}get hcmFilter(){return(0,w.shadow)(this,"hcmFilter",this.#E?this.#p.addHCMFilter(this.#E.foreground,this.#E.background):"none")}get direction(){return(0,w.shadow)(this,"direction",getComputedStyle(this.#z).direction)}get highlightColors(){return(0,w.shadow)(this,"highlightColors",this.#f?new Map(this.#f.split(",").map(s=>s.split("=").map(g=>g.trim()))):null)}get highlightColorNames(){return(0,w.shadow)(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,s=>s.reverse())):null)}setMainHighlightColorPicker(s){this.#I=s}editAltText(s){this.#n?.editAltText(this,s)}onPageChanging({pageNumber:s}){this.#l=s-1}focusMainContainer(){this.#z.focus()}findParent(s,g){for(const t of this.#s.values()){const{x:i,y:c,width:p,height:y}=t.div.getBoundingClientRect();if(s>=i&&s<=i+p&&g>=c&&g<=c+y)return t}return null}disableUserSelect(s=!1){this.#K.classList.toggle("noUserSelect",s)}addShouldRescale(s){this.#c.add(s)}removeShouldRescale(s){this.#c.delete(s)}onScaleChanging({scale:s}){this.commitOrRemove(),this.viewParameters.realScale=s*z.PixelsPerInch.PDF_TO_CSS_UNITS;for(const g of this.#c)g.onScaleChanging()}onRotationChanging({pagesRotation:s}){this.commitOrRemove(),this.viewParameters.rotation=s}#Y({anchorNode:s}){return s.nodeType===Node.TEXT_NODE?s.parentElement:s}highlightSelection(s=""){const g=document.getSelection();if(!g||g.isCollapsed)return;const{anchorNode:t,anchorOffset:i,focusNode:c,focusOffset:p}=g,y=g.toString(),L=this.#Y(g).closest(".textLayer"),M=this.getSelectionBoxes(L);if(M){g.empty(),this.#y===w.AnnotationEditorType.NONE&&(this._eventBus.dispatch("showannotationeditorui",{source:this,mode:w.AnnotationEditorType.HIGHLIGHT}),this.showAllEditors("highlight",!0,!0));for(const O of this.#s.values())if(O.hasTextLayer(L)){O.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:s,boxes:M,anchorNode:t,anchorOffset:i,focusNode:c,focusOffset:p,text:y});break}}}#nt(){const s=document.getSelection();if(!s||s.isCollapsed)return;const t=this.#Y(s).closest(".textLayer"),i=this.getSelectionBoxes(t);i&&(this.#m||=new _.HighlightToolbar(this),this.#m.show(t,i,this.direction==="ltr"))}addToAnnotationStorage(s){!s.isEmpty()&&this.#r&&!this.#r.has(s.id)&&this.#r.setValue(s.id,s)}#rt(){const s=document.getSelection();if(!s||s.isCollapsed){this.#S&&(this.#m?.hide(),this.#S=null,this.#x({hasSelectedText:!1}));return}const{anchorNode:g}=s;if(g===this.#S)return;if(!this.#Y(s).closest(".textLayer")){this.#S&&(this.#m?.hide(),this.#S=null,this.#x({hasSelectedText:!1}));return}if(this.#m?.hide(),this.#S=g,this.#x({hasSelectedText:!0}),!(this.#y!==w.AnnotationEditorType.HIGHLIGHT&&this.#y!==w.AnnotationEditorType.NONE)&&(this.#y===w.AnnotationEditorType.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#A=this.isShiftKeyDown,!this.isShiftKeyDown)){const c=p=>{p.type==="pointerup"&&p.button!==0||(window.removeEventListener("pointerup",c),window.removeEventListener("blur",c),p.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",c),window.addEventListener("blur",c)}}#W(s=""){this.#y===w.AnnotationEditorType.HIGHLIGHT?this.highlightSelection(s):this.#o&&this.#nt()}#at(){document.addEventListener("selectionchange",this.#B)}#ot(){document.removeEventListener("selectionchange",this.#B)}#ht(){window.addEventListener("focus",this.#M),window.addEventListener("blur",this.#T)}#Q(){window.removeEventListener("focus",this.#M),window.removeEventListener("blur",this.#T)}blur(){if(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#W("main_toolbar")),!this.hasSelection)return;const{activeElement:s}=document;for(const g of this.#b)if(g.div.contains(s)){this.#k=[g,s],g._focusEventsAllowed=!1;break}}focus(){if(!this.#k)return;const[s,g]=this.#k;this.#k=null,g.addEventListener("focusin",()=>{s._focusEventsAllowed=!0},{once:!0}),g.focus()}#J(){window.addEventListener("keydown",this.#D),window.addEventListener("keyup",this.#G)}#Z(){window.removeEventListener("keydown",this.#D),window.removeEventListener("keyup",this.#G)}#tt(){document.addEventListener("copy",this.#F),document.addEventListener("cut",this.#_),document.addEventListener("paste",this.#P)}#et(){document.removeEventListener("copy",this.#F),document.removeEventListener("cut",this.#_),document.removeEventListener("paste",this.#P)}addEditListeners(){this.#J(),this.#tt()}removeEditListeners(){this.#Z(),this.#et()}copy(s){if(s.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const g=[];for(const t of this.#b){const i=t.serialize(!0);i&&g.push(i)}g.length!==0&&s.clipboardData.setData("application/pdfjs",JSON.stringify(g))}cut(s){this.copy(s),this.delete()}paste(s){s.preventDefault();const{clipboardData:g}=s;for(const c of g.items)for(const p of this.#u)if(p.isHandlingMimeForPasting(c.type)){p.paste(c,this.currentLayer);return}let t=g.getData("application/pdfjs");if(!t)return;try{t=JSON.parse(t)}catch(c){(0,w.warn)(`paste: "${c.message}".`);return}if(!Array.isArray(t))return;this.unselectAll();const i=this.currentLayer;try{const c=[];for(const S of t){const L=i.deserialize(S);if(!L)return;c.push(L)}const p=()=>{for(const S of c)this.#st(S);this.#it(c)},y=()=>{for(const S of c)S.remove()};this.addCommands({cmd:p,undo:y,mustExec:!0})}catch(c){(0,w.warn)(`paste: "${c.message}".`)}}keydown(s){!this.isShiftKeyDown&&s.key==="Shift"&&(this.isShiftKeyDown=!0),this.#y!==w.AnnotationEditorType.NONE&&!this.isEditorHandlingKeyboard&&l._keyboardManager.exec(this,s)}keyup(s){this.isShiftKeyDown&&s.key==="Shift"&&(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#W("main_toolbar")))}onEditingAction({name:s}){switch(s){case"undo":case"redo":case"delete":case"selectAll":this[s]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#x(s){Object.entries(s).some(([t,i])=>this.#q[t]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#q,s)}),this.#y===w.AnnotationEditorType.HIGHLIGHT&&s.hasSelectedEditor===!1&&this.#H([[w.AnnotationEditorParamsType.HIGHLIGHT_FREE,!0]]))}#H(s){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:s})}setEditingState(s){s?(this.#ht(),this.#tt(),this.#x({isEditing:this.#y!==w.AnnotationEditorType.NONE,isEmpty:this.#j(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#Q(),this.#et(),this.#x({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(s){if(!this.#u){this.#u=s;for(const g of this.#u)this.#H(g.defaultPropertiesToUpdate)}}getId(){return this.#v.id}get currentLayer(){return this.#s.get(this.#l)}getLayer(s){return this.#s.get(s)}get currentPageIndex(){return this.#l}addLayer(s){this.#s.set(s.pageIndex,s),this.#w?s.enable():s.disable()}removeLayer(s){this.#s.delete(s.pageIndex)}updateMode(s,g=null,t=!1){if(this.#y!==s){if(this.#y=s,s===w.AnnotationEditorType.NONE){this.setEditingState(!1),this.#ct();return}this.setEditingState(!0),this.#lt(),this.unselectAll();for(const i of this.#s.values())i.updateMode(s);if(!g&&t){this.addNewEditorFromKeyboard();return}if(g){for(const i of this.#e.values())if(i.annotationElementId===g){this.setSelected(i),i.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(s){s!==this.#y&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:s})}updateParams(s,g){if(this.#u){switch(s){case w.AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#I?.updateColor(g);break;case w.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#R||=new Map).set(s,g),this.showAllEditors("highlight",g);break}for(const t of this.#b)t.updateParams(s,g);for(const t of this.#u)t.updateDefaultParams(s,g)}}showAllEditors(s,g,t=!1){for(const c of this.#e.values())c.editorType===s&&c.show(g);(this.#R?.get(w.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL)??!0)!==g&&this.#H([[w.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,g]])}enableWaiting(s=!1){if(this.#C!==s){this.#C=s;for(const g of this.#s.values())s?g.disableClick():g.enableClick(),g.div.classList.toggle("waiting",s)}}#lt(){if(!this.#w){this.#w=!0;for(const s of this.#s.values())s.enable();for(const s of this.#e.values())s.enable()}}#ct(){if(this.unselectAll(),this.#w){this.#w=!1;for(const s of this.#s.values())s.disable();for(const s of this.#e.values())s.disable()}}getEditors(s){const g=[];for(const t of this.#e.values())t.pageIndex===s&&g.push(t);return g}getEditor(s){return this.#e.get(s)}addEditor(s){this.#e.set(s.id,s)}removeEditor(s){s.div.contains(document.activeElement)&&(this.#g&&clearTimeout(this.#g),this.#g=setTimeout(()=>{this.focusMainContainer(),this.#g=null},0)),this.#e.delete(s.id),this.unselect(s),(!s.annotationElementId||!this.#h.has(s.annotationElementId))&&this.#r?.remove(s.id)}addDeletedAnnotationElement(s){this.#h.add(s.annotationElementId),this.addChangedExistingAnnotation(s),s.deleted=!0}isDeletedAnnotationElement(s){return this.#h.has(s)}removeDeletedAnnotationElement(s){this.#h.delete(s.annotationElementId),this.removeChangedExistingAnnotation(s),s.deleted=!1}#st(s){const g=this.#s.get(s.pageIndex);g?g.addOrRebuild(s):(this.addEditor(s),this.addToAnnotationStorage(s))}setActiveEditor(s){this.#t!==s&&(this.#t=s,s&&this.#H(s.propertiesToUpdate))}get#dt(){let s=null;for(s of this.#b);return s}updateUI(s){this.#dt===s&&this.#H(s.propertiesToUpdate)}toggleSelected(s){if(this.#b.has(s)){this.#b.delete(s),s.unselect(),this.#x({hasSelectedEditor:this.hasSelection});return}this.#b.add(s),s.select(),this.#H(s.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}setSelected(s){for(const g of this.#b)g!==s&&g.unselect();this.#b.clear(),this.#b.add(s),s.select(),this.#H(s.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}isSelected(s){return this.#b.has(s)}get firstSelectedEditor(){return this.#b.values().next().value}unselect(s){s.unselect(),this.#b.delete(s),this.#x({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#b.size!==0}get isEnterHandled(){return this.#b.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#a.undo(),this.#x({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#j()})}redo(){this.#a.redo(),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#j()})}addCommands(s){this.#a.add(s),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#j()})}#j(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const s of this.#e.values())return s.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const s=[...this.#b],g=()=>{for(const i of s)i.remove()},t=()=>{for(const i of s)this.#st(i)};this.addCommands({cmd:g,undo:t,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#it(s){for(const g of this.#b)g.unselect();this.#b.clear();for(const g of s)g.isEmpty()||(this.#b.add(g),g.select());this.#x({hasSelectedEditor:this.hasSelection})}selectAll(){for(const s of this.#b)s.commit();this.#it(this.#e.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#y!==w.AnnotationEditorType.NONE))&&this.hasSelection){for(const s of this.#b)s.unselect();this.#b.clear(),this.#x({hasSelectedEditor:!1})}}translateSelectedEditors(s,g,t=!1){if(t||this.commitOrRemove(),!this.hasSelection)return;this.#U[0]+=s,this.#U[1]+=g;const[i,c]=this.#U,p=[...this.#b],y=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#U[0]=this.#U[1]=0,this.addCommands({cmd:()=>{for(const S of p)this.#e.has(S.id)&&S.translateInPage(i,c)},undo:()=>{for(const S of p)this.#e.has(S.id)&&S.translateInPage(-i,-c)},mustExec:!1})},y);for(const S of p)S.translateInPage(s,g)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#d=new Map;for(const s of this.#b)this.#d.set(s,{savedX:s.x,savedY:s.y,savedPageIndex:s.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#d)return!1;this.disableUserSelect(!1);const s=this.#d;this.#d=null;let g=!1;for(const[{x:i,y:c,pageIndex:p},y]of s)y.newX=i,y.newY=c,y.newPageIndex=p,g||=i!==y.savedX||c!==y.savedY||p!==y.savedPageIndex;if(!g)return!1;const t=(i,c,p,y)=>{if(this.#e.has(i.id)){const S=this.#s.get(y);S?i._setParentAndPosition(S,c,p):(i.pageIndex=y,i.x=c,i.y=p)}};return this.addCommands({cmd:()=>{for(const[i,{newX:c,newY:p,newPageIndex:y}]of s)t(i,c,p,y)},undo:()=>{for(const[i,{savedX:c,savedY:p,savedPageIndex:y}]of s)t(i,c,p,y)},mustExec:!0}),!0}dragSelectedEditors(s,g){if(this.#d)for(const t of this.#d.keys())t.drag(s,g)}rebuild(s){if(s.parent===null){const g=this.getLayer(s.pageIndex);g?(g.changeParent(s),g.addOrRebuild(s)):(this.addEditor(s),this.addToAnnotationStorage(s),s.rebuild())}else s.parent.addOrRebuild(s)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#b.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(s){return this.#t===s}getActive(){return this.#t}getMode(){return this.#y}get imageManager(){return(0,w.shadow)(this,"imageManager",new x)}getSelectionBoxes(s){if(!s)return null;const g=document.getSelection();for(let L=0,M=g.rangeCount;L<M;L++)if(!s.contains(g.getRangeAt(L).commonAncestorContainer))return null;const{x:t,y:i,width:c,height:p}=s.getBoundingClientRect();let y;switch(s.getAttribute("data-main-rotation")){case"90":y=(L,M,O,N)=>({x:(M-i)/p,y:1-(L+O-t)/c,width:N/p,height:O/c});break;case"180":y=(L,M,O,N)=>({x:1-(L+O-t)/c,y:1-(M+N-i)/p,width:O/c,height:N/p});break;case"270":y=(L,M,O,N)=>({x:1-(M+N-i)/p,y:(L-t)/c,width:N/p,height:O/c});break;default:y=(L,M,O,N)=>({x:(L-t)/c,y:(M-i)/p,width:O/c,height:N/p});break}const S=[];for(let L=0,M=g.rangeCount;L<M;L++){const O=g.getRangeAt(L);if(!O.collapsed)for(const{x:N,y:B,width:q,height:nt}of O.getClientRects())q===0||nt===0||S.push(y(N,B,q,nt))}return S.length===0?null:S}addChangedExistingAnnotation({annotationElementId:s,id:g}){(this.#i||=new Map).set(s,g)}removeChangedExistingAnnotation({annotationElementId:s}){this.#i?.delete(s)}renderAnnotationElement(s){const g=this.#i?.get(s.data.id);if(!g)return;const t=this.#r.getRawValue(g);t&&(this.#y===w.AnnotationEditorType.NONE&&!t.hasBeenModified||t.renderAnnotationElement(s))}}},94:(ct,st,$)=>{$.d(st,{PDFFetchStream:()=>C});var w=$(292),z=$(490);function _(r,d,l){return{method:"GET",headers:r,signal:l.signal,mode:"cors",credentials:d?"include":"same-origin",redirect:"follow"}}function V(r){const d=new Headers;for(const l in r){const b=r[l];b!==void 0&&d.append(l,b)}return d}function P(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:((0,w.warn)(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class C{constructor(d){this.source=d,this.isHttp=/^https?:/i.test(d.url),this.httpHeaders=this.isHttp&&d.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,w.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new x(this),this._fullRequestReader}getRangeReader(d,l){if(l<=this._progressiveDataLength)return null;const b=new v(this,d,l);return this._rangeRequestReaders.push(b),b}cancelAllRequests(d){this._fullRequestReader?.cancel(d);for(const l of this._rangeRequestReaders.slice(0))l.cancel(d)}}class x{constructor(d){this._stream=d,this._reader=null,this._loaded=0,this._filename=null;const l=d.source;this._withCredentials=l.withCredentials||!1,this._contentLength=l.length,this._headersCapability=Promise.withResolvers(),this._disableRange=l.disableRange||!1,this._rangeChunkSize=l.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!l.disableStream,this._isRangeSupported=!l.disableRange,this._headers=V(this._stream.httpHeaders);const b=l.url;fetch(b,_(this._headers,this._withCredentials,this._abortController)).then(s=>{if(!(0,z.validateResponseStatus)(s.status))throw(0,z.createResponseStatusError)(s.status,b);this._reader=s.body.getReader(),this._headersCapability.resolve();const g=c=>s.headers.get(c),{allowRangeRequests:t,suggestedLength:i}=(0,z.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=t,this._contentLength=i||this._contentLength,this._filename=(0,z.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new w.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:d,done:l}=await this._reader.read();return l?{value:d,done:l}:(this._loaded+=d.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:P(d),done:!1})}cancel(d){this._reader?.cancel(d),this._abortController.abort()}}class v{constructor(d,l,b){this._stream=d,this._reader=null,this._loaded=0;const s=d.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController,this._headers=V(this._stream.httpHeaders),this._headers.append("Range",`bytes=${l}-${b-1}`);const g=s.url;fetch(g,_(this._headers,this._withCredentials,this._abortController)).then(t=>{if(!(0,z.validateResponseStatus)(t.status))throw(0,z.createResponseStatusError)(t.status,g);this._readCapability.resolve(),this._reader=t.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:d,done:l}=await this._reader.read();return l?{value:d,done:l}:(this._loaded+=d.byteLength,this.onProgress?.({loaded:this._loaded}),{value:P(d),done:!1})}cancel(d){this._reader?.cancel(d),this._abortController.abort()}}},10:(ct,st,$)=>{$.d(st,{FontFaceObject:()=>_,FontLoader:()=>z});var w=$(292);class z{#t=new Set;constructor({ownerDocument:P=globalThis.document,styleElement:C=null}){this._document=P,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(P){this.nativeFontFaces.add(P),this._document.fonts.add(P)}removeNativeFontFace(P){this.nativeFontFaces.delete(P),this._document.fonts.delete(P)}insertRule(P){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const C=this.styleElement.sheet;C.insertRule(P,C.cssRules.length)}clear(){for(const P of this.nativeFontFaces)this._document.fonts.delete(P);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:P,_inspectFont:C}){if(!(!P||this.#t.has(P.loadedName))){if((0,w.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:x,src:v,style:r}=P,d=new FontFace(x,v,r);this.addNativeFontFace(d);try{await d.load(),this.#t.add(x),C?.(P)}catch{(0,w.warn)(`Cannot load system font: ${P.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(d)}return}(0,w.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(P){if(P.attached||P.missingFile&&!P.systemFontInfo)return;if(P.attached=!0,P.systemFontInfo){await this.loadSystemFont(P);return}if(this.isFontLoadingAPISupported){const x=P.createNativeFontFace();if(x){this.addNativeFontFace(x);try{await x.loaded}catch(v){throw(0,w.warn)(`Failed to load font '${x.family}': '${v}'.`),P.disableFontFace=!0,v}}return}const C=P.createFontFaceRule();if(C){if(this.insertRule(C),this.isSyncFontLoadingSupported)return;await new Promise(x=>{const v=this._queueLoadingCallback(x);this._prepareFontLoadEvent(P,v)})}}get isFontLoadingAPISupported(){const P=!!this._document?.fonts;return(0,w.shadow)(this,"isFontLoadingAPISupported",P)}get isSyncFontLoadingSupported(){let P=!1;return(w.isNodeJS||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(P=!0),(0,w.shadow)(this,"isSyncFontLoadingSupported",P)}_queueLoadingCallback(P){function C(){for((0,w.assert)(!v.done,"completeRequest() cannot be called twice."),v.done=!0;x.length>0&&x[0].done;){const r=x.shift();setTimeout(r.callback,0)}}const{loadingRequests:x}=this,v={done:!1,complete:C,callback:P};return x.push(v),v}get _loadTestFont(){const P=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,w.shadow)(this,"_loadTestFont",P)}_prepareFontLoadEvent(P,C){function x(N,B){return N.charCodeAt(B)<<24|N.charCodeAt(B+1)<<16|N.charCodeAt(B+2)<<8|N.charCodeAt(B+3)&255}function v(N,B,q,nt){const j=N.substring(0,B),H=N.substring(B+q);return j+nt+H}let r,d;const l=this._document.createElement("canvas");l.width=1,l.height=1;const b=l.getContext("2d");let s=0;function g(N,B){if(++s>30){(0,w.warn)("Load test font never loaded."),B();return}if(b.font="30px "+N,b.fillText(".",0,20),b.getImageData(0,0,1,1).data[3]>0){B();return}setTimeout(g.bind(null,N,B))}const t=`lt${Date.now()}${this.loadTestFontId++}`;let i=this._loadTestFont;i=v(i,976,t.length,t);const p=16,y=1482184792;let S=x(i,p);for(r=0,d=t.length-3;r<d;r+=4)S=S-y+x(t,r)|0;r<t.length&&(S=S-y+x(t+"XXX",r)|0),i=v(i,p,4,(0,w.string32)(S));const L=`url(data:font/opentype;base64,${btoa(i)});`,M=`@font-face {font-family:"${t}";src:${L}}`;this.insertRule(M);const O=this._document.createElement("div");O.style.visibility="hidden",O.style.width=O.style.height="10px",O.style.position="absolute",O.style.top=O.style.left="0px";for(const N of[P.loadedName,t]){const B=this._document.createElement("span");B.textContent="Hi",B.style.fontFamily=N,O.append(B)}this._document.body.append(O),g(t,()=>{O.remove(),C.complete()})}}class _{constructor(P,{disableFontFace:C=!1,ignoreErrors:x=!1,inspectFont:v=null}){this.compiledGlyphs=Object.create(null);for(const r in P)this[r]=P[r];this.disableFontFace=C===!0,this.ignoreErrors=x===!0,this._inspectFont=v}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let P;if(!this.cssFontInfo)P=new FontFace(this.loadedName,this.data,{});else{const C={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(C.style=`oblique ${this.cssFontInfo.italicAngle}deg`),P=new FontFace(this.cssFontInfo.fontFamily,this.data,C)}return this._inspectFont?.(this),P}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const P=(0,w.bytesToString)(this.data),C=`url(data:${this.mimetype};base64,${btoa(P)});`;let x;if(!this.cssFontInfo)x=`@font-face {font-family:"${this.loadedName}";src:${C}}`;else{let v=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(v+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),x=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${v}src:${C}}`}return this._inspectFont?.(this,C),x}getPathGenerator(P,C){if(this.compiledGlyphs[C]!==void 0)return this.compiledGlyphs[C];let x;try{x=P.get(this.loadedName+"_path_"+C)}catch(r){if(!this.ignoreErrors)throw r;(0,w.warn)(`getPathGenerator - ignoring character: "${r}".`)}if(!Array.isArray(x)||x.length===0)return this.compiledGlyphs[C]=function(r,d){};const v=[];for(let r=0,d=x.length;r<d;)switch(x[r++]){case w.FontRenderOps.BEZIER_CURVE_TO:{const[l,b,s,g,t,i]=x.slice(r,r+6);v.push(c=>c.bezierCurveTo(l,b,s,g,t,i)),r+=6}break;case w.FontRenderOps.MOVE_TO:{const[l,b]=x.slice(r,r+2);v.push(s=>s.moveTo(l,b)),r+=2}break;case w.FontRenderOps.LINE_TO:{const[l,b]=x.slice(r,r+2);v.push(s=>s.lineTo(l,b)),r+=2}break;case w.FontRenderOps.QUADRATIC_CURVE_TO:{const[l,b,s,g]=x.slice(r,r+4);v.push(t=>t.quadraticCurveTo(l,b,s,g)),r+=4}break;case w.FontRenderOps.RESTORE:v.push(l=>l.restore());break;case w.FontRenderOps.SAVE:v.push(l=>l.save());break;case w.FontRenderOps.SCALE:(0,w.assert)(v.length===2,"Scale command is only valid at the third position.");break;case w.FontRenderOps.TRANSFORM:{const[l,b,s,g,t,i]=x.slice(r,r+6);v.push(c=>c.transform(l,b,s,g,t,i)),r+=6}break;case w.FontRenderOps.TRANSLATE:{const[l,b]=x.slice(r,r+2);v.push(s=>s.translate(l,b)),r+=2}break}return this.compiledGlyphs[C]=function(d,l){v[0](d),v[1](d),d.scale(l,-l);for(let b=2,s=v.length;b<s;b++)v[b](d)}}}},62:(ct,st,$)=>{$.d(st,{Metadata:()=>z});var w=$(292);class z{#t;#e;constructor({parsedData:V,rawData:P}){this.#t=V,this.#e=P}getRaw(){return this.#e}get(V){return this.#t.get(V)??null}getAll(){return(0,w.objectFromMap)(this.#t)}has(V){return this.#t.has(V)}}},457:(ct,st,$)=>{$.d(st,{PDFNetworkStream:()=>x});var w=$(292),z=$(490);const _=200,V=206;function P(d){const l=d.response;return typeof l!="string"?l:(0,w.stringToBytes)(l).buffer}class C{constructor(l,b={}){this.url=l,this.isHttp=/^https?:/i.test(l),this.httpHeaders=this.isHttp&&b.httpHeaders||Object.create(null),this.withCredentials=b.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(l,b,s){const g={begin:l,end:b};for(const t in s)g[t]=s[t];return this.request(g)}requestFull(l){return this.request(l)}request(l){const b=new XMLHttpRequest,s=this.currXhrId++,g=this.pendingRequests[s]={xhr:b};b.open("GET",this.url),b.withCredentials=this.withCredentials;for(const t in this.httpHeaders){const i=this.httpHeaders[t];i!==void 0&&b.setRequestHeader(t,i)}return this.isHttp&&"begin"in l&&"end"in l?(b.setRequestHeader("Range",`bytes=${l.begin}-${l.end-1}`),g.expectedStatus=V):g.expectedStatus=_,b.responseType="arraybuffer",l.onError&&(b.onerror=function(t){l.onError(b.status)}),b.onreadystatechange=this.onStateChange.bind(this,s),b.onprogress=this.onProgress.bind(this,s),g.onHeadersReceived=l.onHeadersReceived,g.onDone=l.onDone,g.onError=l.onError,g.onProgress=l.onProgress,b.send(null),s}onProgress(l,b){const s=this.pendingRequests[l];s&&s.onProgress?.(b)}onStateChange(l,b){const s=this.pendingRequests[l];if(!s)return;const g=s.xhr;if(g.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),g.readyState!==4||!(l in this.pendingRequests))return;if(delete this.pendingRequests[l],g.status===0&&this.isHttp){s.onError?.(g.status);return}const t=g.status||_;if(!(t===_&&s.expectedStatus===V)&&t!==s.expectedStatus){s.onError?.(g.status);return}const c=P(g);if(t===V){const p=g.getResponseHeader("Content-Range"),y=/bytes (\d+)-(\d+)\/(\d+)/.exec(p);s.onDone({begin:parseInt(y[1],10),chunk:c})}else c?s.onDone({begin:0,chunk:c}):s.onError?.(g.status)}getRequestXhr(l){return this.pendingRequests[l].xhr}isPendingRequest(l){return l in this.pendingRequests}abortRequest(l){const b=this.pendingRequests[l].xhr;delete this.pendingRequests[l],b.abort()}}class x{constructor(l){this._source=l,this._manager=new C(l.url,{httpHeaders:l.httpHeaders,withCredentials:l.withCredentials}),this._rangeChunkSize=l.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(l){const b=this._rangeRequestReaders.indexOf(l);b>=0&&this._rangeRequestReaders.splice(b,1)}getFullReader(){return(0,w.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new v(this._manager,this._source),this._fullRequestReader}getRangeReader(l,b){const s=new r(this._manager,l,b);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(l){this._fullRequestReader?.cancel(l);for(const b of this._rangeRequestReaders.slice(0))b.cancel(l)}}class v{constructor(l,b){this._manager=l;const s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=b.url,this._fullRequestId=l.requestFull(s),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=b.disableRange||!1,this._contentLength=b.length,this._rangeChunkSize=b.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const l=this._fullRequestId,b=this._manager.getRequestXhr(l),s=i=>b.getResponseHeader(i),{allowRangeRequests:g,suggestedLength:t}=(0,z.validateRangeRequestCapabilities)({getResponseHeader:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=t||this._contentLength,this._filename=(0,z.extractFilenameFromHeader)(s),this._isRangeSupported&&this._manager.abortRequest(l),this._headersReceivedCapability.resolve()}_onDone(l){if(l&&(this._requests.length>0?this._requests.shift().resolve({value:l.chunk,done:!1}):this._cachedChunks.push(l.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(l){this._storedError=(0,z.createResponseStatusError)(l,this._url),this._headersReceivedCapability.reject(this._storedError);for(const b of this._requests)b.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(l){this.onProgress?.({loaded:l.loaded,total:l.lengthComputable?l.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const l=Promise.withResolvers();return this._requests.push(l),l.promise}cancel(l){this._done=!0,this._headersReceivedCapability.reject(l);for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class r{constructor(l,b,s){this._manager=l;const g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=l.url,this._requestId=l.requestRange(b,s,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(l){const b=l.chunk;this._requests.length>0?this._requests.shift().resolve({value:b,done:!1}):this._queuedChunk=b,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(l){this._storedError=(0,z.createResponseStatusError)(l,this._url);for(const b of this._requests)b.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(l){this.isStreamingSupported||this.onProgress?.({loaded:l.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const b=this._queuedChunk;return this._queuedChunk=null,{value:b,done:!1}}if(this._done)return{value:void 0,done:!0};const l=Promise.withResolvers();return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},490:(ct,st,$)=>{$.d(st,{createResponseStatusError:()=>C,extractFilenameFromHeader:()=>P,validateRangeRequestCapabilities:()=>V,validateResponseStatus:()=>x});var w=$(292);function z(v){let r=!0,d=l("filename\\*","i").exec(v);if(d){d=d[1];let p=t(d);return p=unescape(p),p=i(p),p=c(p),s(p)}if(d=g(v),d){const p=c(d);return s(p)}if(d=l("filename","i").exec(v),d){d=d[1];let p=t(d);return p=c(p),s(p)}function l(p,y){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function b(p,y){if(p){if(!/^[\x00-\xFF]+$/.test(y))return y;try{const S=new TextDecoder(p,{fatal:!0}),L=(0,w.stringToBytes)(y);y=S.decode(L),r=!1}catch{}}return y}function s(p){return r&&/[\x80-\xff]/.test(p)&&(p=b("utf-8",p),r&&(p=b("iso-8859-1",p))),p}function g(p){const y=[];let S;const L=l("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(S=L.exec(p))!==null;){let[,O,N,B]=S;if(O=parseInt(O,10),O in y){if(O===0)break;continue}y[O]=[N,B]}const M=[];for(let O=0;O<y.length&&O in y;++O){let[N,B]=y[O];B=t(B),N&&(B=unescape(B),O===0&&(B=i(B))),M.push(B)}return M.join("")}function t(p){if(p.startsWith('"')){const y=p.slice(1).split('\\"');for(let S=0;S<y.length;++S){const L=y[S].indexOf('"');L!==-1&&(y[S]=y[S].slice(0,L),y.length=S+1),y[S]=y[S].replaceAll(/\\(.)/g,"$1")}p=y.join('"')}return p}function i(p){const y=p.indexOf("'");if(y===-1)return p;const S=p.slice(0,y),M=p.slice(y+1).replace(/^[^']*'/,"");return b(S,M)}function c(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,S,L,M){if(L==="q"||L==="Q")return M=M.replaceAll("_"," "),M=M.replaceAll(/=([0-9a-fA-F]{2})/g,function(O,N){return String.fromCharCode(parseInt(N,16))}),b(S,M);try{M=atob(M)}catch{}return b(S,M)})}return""}var _=$(419);function V({getResponseHeader:v,isHttp:r,rangeChunkSize:d,disableRange:l}){const b={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(v("Content-Length"),10);return!Number.isInteger(s)||(b.suggestedLength=s,s<=2*d)||l||!r||v("Accept-Ranges")!=="bytes"||(v("Content-Encoding")||"identity")!=="identity"||(b.allowRangeRequests=!0),b}function P(v){const r=v("Content-Disposition");if(r){let d=z(r);if(d.includes("%"))try{d=decodeURIComponent(d)}catch{}if((0,_.isPdfFile)(d))return d}return null}function C(v,r){return v===404||v===0&&r.startsWith("file:")?new w.MissingPDFException('Missing PDF "'+r+'".'):new w.UnexpectedResponseException(`Unexpected server response (${v}) while retrieving PDF "${r}".`,v)}function x(v){return v===200||v===206}},786:(ct,st,$)=>{$.a(ct,async(w,z)=>{try{let d=function(y){const S=v.parse(y);return S.protocol==="file:"||S.host?S:/^[a-z]:[/\\]/i.test(y)?v.parse(`file:///${y}`):(S.host||(S.protocol="file:"),S)},g=function(y,S){return{protocol:y.protocol,auth:y.auth,host:y.hostname,port:y.port,path:y.path,method:"GET",headers:S}};$.d(st,{PDFNodeStream:()=>l});var _=$(292),V=$(490);let P,C,x,v;_.isNodeJS&&(P=await Ft(()=>import("./BIHI7g3E.js"),[],import.meta.url),C=await Ft(()=>import("./BIHI7g3E.js"),[],import.meta.url),x=await Ft(()=>import("./BIHI7g3E.js"),[],import.meta.url),v=await Ft(()=>import("./BIHI7g3E.js"),[],import.meta.url));const r=/^file:\/\/\/[a-zA-Z]:\//;class l{constructor(S){this.source=S,this.url=d(S.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&S.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,_.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new c(this):new t(this),this._fullRequestReader}getRangeReader(S,L){if(L<=this._progressiveDataLength)return null;const M=this.isFsUrl?new p(this,S,L):new i(this,S,L);return this._rangeRequestReaders.push(M),M}cancelAllRequests(S){this._fullRequestReader?.cancel(S);for(const L of this._rangeRequestReaders.slice(0))L.cancel(S)}}class b{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null;const L=S.source;this._contentLength=L.length,this._loaded=0,this._filename=null,this._disableRange=L.disableRange||!1,this._rangeChunkSize=L.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!L.disableStream,this._isRangeSupported=!L.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=S.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",L=>{this._error(L)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new _.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class s{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const L=S.source;this._isStreamingSupported=!L.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=S.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",L=>{this._error(L)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class t extends b{constructor(S){super(S);const L=M=>{if(M.statusCode===404){const q=new _.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=q,this._headersCapability.reject(q);return}this._headersCapability.resolve(),this._setReadableStream(M);const O=q=>this._readableStream.headers[q.toLowerCase()],{allowRangeRequests:N,suggestedLength:B}=(0,V.validateRangeRequestCapabilities)({getResponseHeader:O,isHttp:S.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=N,this._contentLength=B||this._contentLength,this._filename=(0,V.extractFilenameFromHeader)(O)};this._request=null,this._url.protocol==="http:"?this._request=C.request(g(this._url,S.httpHeaders),L):this._request=x.request(g(this._url,S.httpHeaders),L),this._request.on("error",M=>{this._storedError=M,this._headersCapability.reject(M)}),this._request.end()}}class i extends s{constructor(S,L,M){super(S),this._httpHeaders={};for(const N in S.httpHeaders){const B=S.httpHeaders[N];B!==void 0&&(this._httpHeaders[N]=B)}this._httpHeaders.Range=`bytes=${L}-${M-1}`;const O=N=>{if(N.statusCode===404){const B=new _.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=B;return}this._setReadableStream(N)};this._request=null,this._url.protocol==="http:"?this._request=C.request(g(this._url,this._httpHeaders),O):this._request=x.request(g(this._url,this._httpHeaders),O),this._request.on("error",N=>{this._storedError=N}),this._request.end()}}class c extends b{constructor(S){super(S);let L=decodeURIComponent(this._url.path);r.test(this._url.href)&&(L=L.replace(/^\//,"")),P.promises.lstat(L).then(M=>{this._contentLength=M.size,this._setReadableStream(P.createReadStream(L)),this._headersCapability.resolve()},M=>{M.code==="ENOENT"&&(M=new _.MissingPDFException(`Missing PDF "${L}".`)),this._storedError=M,this._headersCapability.reject(M)})}}class p extends s{constructor(S,L,M){super(S);let O=decodeURIComponent(this._url.path);r.test(this._url.href)&&(O=O.replace(/^\//,"")),this._setReadableStream(P.createReadStream(O,{start:L,end:M-1}))}}z()}catch(P){z(P)}},1)},573:(ct,st,$)=>{$.a(ct,async(w,z)=>{try{$.d(st,{NodeCMapReaderFactory:()=>l,NodeCanvasFactory:()=>d,NodeFilterFactory:()=>r,NodeStandardFontDataFactory:()=>b});var _=$(583),V=$(292);let P,C,x;if(V.isNodeJS){P=await Ft(()=>import("./BIHI7g3E.js"),[],import.meta.url);try{C=await Ft(()=>import("./BIHI7g3E.js"),[],import.meta.url)}catch{}try{x=await Ft(()=>import("./-EVKqUhF.js"),[],import.meta.url)}catch{}}const v=function(s){return P.promises.readFile(s).then(g=>new Uint8Array(g))};class r extends _.BaseFilterFactory{}class d extends _.BaseCanvasFactory{_createCanvas(g,t){return C.createCanvas(g,t)}}class l extends _.BaseCMapReaderFactory{_fetchData(g,t){return v(g).then(i=>({cMapData:i,compressionType:t}))}}class b extends _.BaseStandardFontDataFactory{_fetchData(g){return v(g)}}z()}catch(P){z(P)}},1)},626:(ct,st,$)=>{$.d(st,{OptionalContentConfig:()=>P});var w=$(292),z=$(651);const _=Symbol("INTERNAL");class V{#t=!1;#e=!1;#s=!1;#n=!0;constructor(x,{name:v,intent:r,usage:d}){this.#t=!!(x&w.RenderingIntentFlag.DISPLAY),this.#e=!!(x&w.RenderingIntentFlag.PRINT),this.name=v,this.intent=r,this.usage=d}get visible(){if(this.#s)return this.#n;if(!this.#n)return!1;const{print:x,view:v}=this.usage;return this.#t?v?.viewState!=="OFF":this.#e?x?.printState!=="OFF":!0}_setVisible(x,v,r=!1){x!==_&&(0,w.unreachable)("Internal method `_setVisible` called."),this.#s=r,this.#n=v}}class P{#t=null;#e=new Map;#s=null;#n=null;constructor(x,v=w.RenderingIntentFlag.DISPLAY){if(this.renderingIntent=v,this.name=null,this.creator=null,x!==null){this.name=x.name,this.creator=x.creator,this.#n=x.order;for(const r of x.groups)this.#e.set(r.id,new V(v,r));if(x.baseState==="OFF")for(const r of this.#e.values())r._setVisible(_,!1);for(const r of x.on)this.#e.get(r)._setVisible(_,!0);for(const r of x.off)this.#e.get(r)._setVisible(_,!1);this.#s=this.getHash()}}#r(x){const v=x.length;if(v<2)return!0;const r=x[0];for(let d=1;d<v;d++){const l=x[d];let b;if(Array.isArray(l))b=this.#r(l);else if(this.#e.has(l))b=this.#e.get(l).visible;else return(0,w.warn)(`Optional content group not found: ${l}`),!0;switch(r){case"And":if(!b)return!1;break;case"Or":if(b)return!0;break;case"Not":return!b;default:return!0}}return r==="And"}isVisible(x){if(this.#e.size===0)return!0;if(!x)return(0,w.info)("Optional content group not defined."),!0;if(x.type==="OCG")return this.#e.has(x.id)?this.#e.get(x.id).visible:((0,w.warn)(`Optional content group not found: ${x.id}`),!0);if(x.type==="OCMD"){if(x.expression)return this.#r(x.expression);if(!x.policy||x.policy==="AnyOn"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(this.#e.get(v).visible)return!0}return!1}else if(x.policy==="AllOn"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(!this.#e.get(v).visible)return!1}return!0}else if(x.policy==="AnyOff"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(!this.#e.get(v).visible)return!0}return!1}else if(x.policy==="AllOff"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(this.#e.get(v).visible)return!1}return!0}return(0,w.warn)(`Unknown optional content policy ${x.policy}.`),!0}return(0,w.warn)(`Unknown group type ${x.type}.`),!0}setVisibility(x,v=!0){const r=this.#e.get(x);if(!r){(0,w.warn)(`Optional content group not found: ${x}`);return}r._setVisible(_,!!v,!0),this.#t=null}setOCGState({state:x,preserveRB:v}){let r;for(const d of x){switch(d){case"ON":case"OFF":case"Toggle":r=d;continue}const l=this.#e.get(d);if(l)switch(r){case"ON":l._setVisible(_,!0);break;case"OFF":l._setVisible(_,!1);break;case"Toggle":l._setVisible(_,!l.visible);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,w.objectFromMap)(this.#e):null}getGroup(x){return this.#e.get(x)||null}getHash(){if(this.#t!==null)return this.#t;const x=new z.MurmurHash3_64;for(const[v,r]of this.#e)x.update(`${v}:${r.visible}`);return this.#t=x.hexdigest()}}},814:(ct,st,$)=>{$.d(st,{cleanupTextLayer:()=>r,renderTextLayer:()=>t,updateTextLayer:()=>i});var w=$(292),z=$(419);const _=1e5,V=30,P=.8,C=new Map;let x=null;function v(){if(!x){const c=document.createElement("canvas");c.className="hiddenCanvasElement",document.body.append(c),x=c.getContext("2d",{alpha:!1})}return x}function r(){x?.canvas.remove(),x=null}function d(c){const p=C.get(c);if(p)return p;const y=v(),S=y.font;y.canvas.width=y.canvas.height=V,y.font=`${V}px ${c}`;const L=y.measureText("");let M=L.fontBoundingBoxAscent,O=Math.abs(L.fontBoundingBoxDescent);if(M){const B=M/(M+O);return C.set(c,B),y.canvas.width=y.canvas.height=0,y.font=S,B}y.strokeStyle="red",y.clearRect(0,0,V,V),y.strokeText("g",0,0);let N=y.getImageData(0,0,V,V).data;O=0;for(let B=N.length-1-3;B>=0;B-=4)if(N[B]>0){O=Math.ceil(B/4/V);break}y.clearRect(0,0,V,V),y.strokeText("A",0,V),N=y.getImageData(0,0,V,V).data,M=0;for(let B=0,q=N.length;B<q;B+=4)if(N[B]>0){M=V-Math.floor(B/4/V);break}if(y.canvas.width=y.canvas.height=0,y.font=S,M){const B=M/(M+O);return C.set(c,B),B}return C.set(c,P),P}function l(c,p,y){const S=document.createElement("span"),L={angle:0,canvasWidth:0,hasText:p.str!=="",hasEOL:p.hasEOL,fontSize:0};c._textDivs.push(S);const M=w.Util.transform(c._transform,p.transform);let O=Math.atan2(M[1],M[0]);const N=y[p.fontName];N.vertical&&(O+=Math.PI/2);const B=c._fontInspectorEnabled&&N.fontSubstitution||N.fontFamily,q=Math.hypot(M[2],M[3]),nt=q*d(B);let j,H;O===0?(j=M[4],H=M[5]-nt):(j=M[4]+nt*Math.sin(O),H=M[5]-nt*Math.cos(O));const G="calc(var(--scale-factor)*",Y=S.style;c._container===c._rootContainer?(Y.left=`${(100*j/c._pageWidth).toFixed(2)}%`,Y.top=`${(100*H/c._pageHeight).toFixed(2)}%`):(Y.left=`${G}${j.toFixed(2)}px)`,Y.top=`${G}${H.toFixed(2)}px)`),Y.fontSize=`${G}${q.toFixed(2)}px)`,Y.fontFamily=B,L.fontSize=q,S.setAttribute("role","presentation"),S.textContent=p.str,S.dir=p.dir,c._fontInspectorEnabled&&(S.dataset.fontName=N.fontSubstitutionLoadedName||p.fontName),O!==0&&(L.angle=O*(180/Math.PI));let tt=!1;if(p.str.length>1)tt=!0;else if(p.str!==" "&&p.transform[0]!==p.transform[3]){const Z=Math.abs(p.transform[0]),at=Math.abs(p.transform[3]);Z!==at&&Math.max(Z,at)/Math.min(Z,at)>1.5&&(tt=!0)}tt&&(L.canvasWidth=N.vertical?p.height:p.width),c._textDivProperties.set(S,L),c._isReadableStream&&c._layoutText(S)}function b(c){const{div:p,scale:y,properties:S,ctx:L,prevFontSize:M,prevFontFamily:O}=c,{style:N}=p;let B="";if(S.canvasWidth!==0&&S.hasText){const{fontFamily:q}=N,{canvasWidth:nt,fontSize:j}=S;(M!==j||O!==q)&&(L.font=`${j*y}px ${q}`,c.prevFontSize=j,c.prevFontFamily=q);const{width:H}=L.measureText(p.textContent);H>0&&(B=`scaleX(${nt*y/H})`)}S.angle!==0&&(B=`rotate(${S.angle}deg) ${B}`),B.length>0&&(N.transform=B)}function s(c){if(c._canceled)return;const p=c._textDivs,y=c._capability;if(p.length>_){y.resolve();return}if(!c._isReadableStream)for(const L of p)c._layoutText(L);y.resolve()}class g{constructor({textContentSource:p,container:y,viewport:S,textDivs:L,textDivProperties:M,textContentItemsStr:O}){this._textContentSource=p,this._isReadableStream=p instanceof ReadableStream,this._container=this._rootContainer=y,this._textDivs=L||[],this._textContentItemsStr=O||[],this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=M||new WeakMap,this._canceled=!1,this._capability=Promise.withResolvers(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:S.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:v()};const{pageWidth:N,pageHeight:B,pageX:q,pageY:nt}=S.rawDims;this._transform=[1,0,0,-1,-q,nt+B],this._pageWidth=N,this._pageHeight=B,(0,z.setLayerDimensions)(y,S),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new w.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new w.AbortException("TextLayer task cancelled."))}_processItems(p,y){for(const S of p){if(S.str===void 0){if(S.type==="beginMarkedContentProps"||S.type==="beginMarkedContent"){const L=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),S.id!==null&&this._container.setAttribute("id",`${S.id}`),L.append(this._container)}else S.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(S.str),l(this,S,y)}}_layoutText(p){const y=this._layoutTextParams.properties=this._textDivProperties.get(p);if(this._layoutTextParams.div=p,b(this._layoutTextParams),y.hasText&&this._container.append(p),y.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),this._container.append(S)}}_render(){const{promise:p,resolve:y,reject:S}=Promise.withResolvers();let L=Object.create(null);if(this._isReadableStream){const M=()=>{this._reader.read().then(({value:O,done:N})=>{if(N){y();return}Object.assign(L,O.styles),this._processItems(O.items,L),M()},S)};this._reader=this._textContentSource.getReader(),M()}else if(this._textContentSource){const{items:M,styles:O}=this._textContentSource;this._processItems(M,O),y()}else throw new Error('No "textContentSource" parameter specified.');p.then(()=>{L=null,s(this)},this._capability.reject)}}function t(c){const p=new g(c);return p._render(),p}function i({container:c,viewport:p,textDivs:y,textDivProperties:S,mustRotate:L=!0,mustRescale:M=!0}){if(L&&(0,z.setLayerDimensions)(c,{rotation:p.rotation}),M){const O=v(),B={prevFontSize:null,prevFontFamily:null,div:null,scale:p.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:O};for(const q of y)B.properties=S.get(q),B.div=q,b(B)}}},585:(ct,st,$)=>{$.d(st,{PDFDataTransportStream:()=>_});var w=$(292),z=$(419);class _{constructor(x,{disableRange:v=!1,disableStream:r=!1}){(0,w.assert)(x,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:d,initialData:l,progressiveDone:b,contentDispositionFilename:s}=x;if(this._queuedChunks=[],this._progressiveDone=b,this._contentDispositionFilename=s,l?.length>0){const g=l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer;this._queuedChunks.push(g)}this._pdfDataRangeTransport=x,this._isStreamingSupported=!r,this._isRangeSupported=!v,this._contentLength=d,this._fullRequestReader=null,this._rangeReaders=[],x.addRangeListener((g,t)=>{this._onReceiveData({begin:g,chunk:t})}),x.addProgressListener((g,t)=>{this._onProgress({loaded:g,total:t})}),x.addProgressiveReadListener(g=>{this._onReceiveData({chunk:g})}),x.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),x.transportReady()}_onReceiveData({begin:x,chunk:v}){const r=v instanceof Uint8Array&&v.byteLength===v.buffer.byteLength?v.buffer:new Uint8Array(v).buffer;if(x===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{const d=this._rangeReaders.some(function(l){return l._begin!==x?!1:(l._enqueue(r),!0)});(0,w.assert)(d,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(x){x.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:x.loaded}):this._fullRequestReader?.onProgress?.({loaded:x.loaded,total:x.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(x){const v=this._rangeReaders.indexOf(x);v>=0&&this._rangeReaders.splice(v,1)}getFullReader(){(0,w.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const x=this._queuedChunks;return this._queuedChunks=null,new V(this,x,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(x,v){if(v<=this._progressiveDataLength)return null;const r=new P(this,x,v);return this._pdfDataRangeTransport.requestDataRange(x,v),this._rangeReaders.push(r),r}cancelAllRequests(x){this._fullRequestReader?.cancel(x);for(const v of this._rangeReaders.slice(0))v.cancel(x);this._pdfDataRangeTransport.abort()}}class V{constructor(x,v,r=!1,d=null){this._stream=x,this._done=r||!1,this._filename=(0,z.isPdfFile)(d)?d:null,this._queuedChunks=v||[],this._loaded=0;for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._requests=[],this._headersReady=Promise.resolve(),x._fullRequestReader=this,this.onProgress=null}_enqueue(x){this._done||(this._requests.length>0?this._requests.shift().resolve({value:x,done:!1}):this._queuedChunks.push(x),this._loaded+=x.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const x=Promise.withResolvers();return this._requests.push(x),x.promise}cancel(x){this._done=!0;for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class P{constructor(x,v,r){this._stream=x,this._begin=v,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(x){if(!this._done){if(this._requests.length===0)this._queuedChunk=x;else{this._requests.shift().resolve({value:x,done:!1});for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const v=this._queuedChunk;return this._queuedChunk=null,{value:v,done:!1}}if(this._done)return{value:void 0,done:!0};const x=Promise.withResolvers();return this._requests.push(x),x.promise}cancel(x){this._done=!0;for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},164:(ct,st,$)=>{$.d(st,{GlobalWorkerOptions:()=>w});class w{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(_){if(!(typeof Worker<"u"&&_ instanceof Worker)&&_!==null)throw new Error("Invalid `workerPort` type.");this.#t=_}static get workerSrc(){return this.#e}static set workerSrc(_){if(typeof _!="string")throw new Error("Invalid `workerSrc` type.");this.#e=_}}},284:(ct,st,$)=>{$.d(st,{XfaLayer:()=>z});var w=$(50);class z{static setupStorage(V,P,C,x,v){const r=x.getValue(P,{value:null});switch(C.name){case"textarea":if(r.value!==null&&(V.textContent=r.value),v==="print")break;V.addEventListener("input",d=>{x.setValue(P,{value:d.target.value})});break;case"input":if(C.attributes.type==="radio"||C.attributes.type==="checkbox"){if(r.value===C.attributes.xfaOn?V.setAttribute("checked",!0):r.value===C.attributes.xfaOff&&V.removeAttribute("checked"),v==="print")break;V.addEventListener("change",d=>{x.setValue(P,{value:d.target.checked?d.target.getAttribute("xfaOn"):d.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&V.setAttribute("value",r.value),v==="print")break;V.addEventListener("input",d=>{x.setValue(P,{value:d.target.value})})}break;case"select":if(r.value!==null){V.setAttribute("value",r.value);for(const d of C.children)d.attributes.value===r.value?d.attributes.selected=!0:d.attributes.hasOwnProperty("selected")&&delete d.attributes.selected}V.addEventListener("input",d=>{const l=d.target.options,b=l.selectedIndex===-1?"":l[l.selectedIndex].value;x.setValue(P,{value:b})});break}}static setAttributes({html:V,element:P,storage:C=null,intent:x,linkService:v}){const{attributes:r}=P,d=V instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${x}`);for(const[l,b]of Object.entries(r))if(b!=null)switch(l){case"class":b.length&&V.setAttribute(l,b.join(" "));break;case"dataId":break;case"id":V.setAttribute("data-element-id",b);break;case"style":Object.assign(V.style,b);break;case"textContent":V.textContent=b;break;default:(!d||l!=="href"&&l!=="newWindow")&&V.setAttribute(l,b)}d&&v.addLinkAttributes(V,r.href,r.newWindow),C&&r.dataId&&this.setupStorage(V,r.dataId,P,C)}static render(V){const P=V.annotationStorage,C=V.linkService,x=V.xfaHtml,v=V.intent||"display",r=document.createElement(x.name);x.attributes&&this.setAttributes({html:r,element:x,intent:v,linkService:C});const d=v!=="richText",l=V.div;if(l.append(r),V.viewport){const g=`matrix(${V.viewport.transform.join(",")})`;l.style.transform=g}d&&l.setAttribute("class","xfaLayer xfaFont");const b=[];if(x.children.length===0){if(x.value){const g=document.createTextNode(x.value);r.append(g),d&&w.XfaText.shouldBuildText(x.name)&&b.push(g)}return{textDivs:b}}const s=[[x,-1,r]];for(;s.length>0;){const[g,t,i]=s.at(-1);if(t+1===g.children.length){s.pop();continue}const c=g.children[++s.at(-1)[1]];if(c===null)continue;const{name:p}=c;if(p==="#text"){const S=document.createTextNode(c.value);b.push(S),i.append(S);continue}const y=c?.attributes?.xmlns?document.createElementNS(c.attributes.xmlns,p):document.createElement(p);if(i.append(y),c.attributes&&this.setAttributes({html:y,element:c,storage:P,intent:v,linkService:C}),c.children?.length>0)s.push([c,-1,y]);else if(c.value){const S=document.createTextNode(c.value);d&&w.XfaText.shouldBuildText(p)&&b.push(S),y.append(S)}}for(const g of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:b}}static update(V){const P=`matrix(${V.viewport.transform.join(",")})`;V.div.style.transform=P,V.div.hidden=!1}}},50:(ct,st,$)=>{$.d(st,{XfaText:()=>w});class w{static textContent(_){const V=[],P={items:V,styles:Object.create(null)};function C(x){if(!x)return;let v=null;const r=x.name;if(r==="#text")v=x.value;else if(w.shouldBuildText(r))x?.attributes?.textContent?v=x.attributes.textContent:x.value&&(v=x.value);else return;if(v!==null&&V.push({str:v}),!!x.children)for(const d of x.children)C(d)}return C(_),P}static shouldBuildText(_){return!(_==="textarea"||_==="input"||_==="option"||_==="select")}}},228:(ct,st,$)=>{$.a(ct,async(w,z)=>{try{$.d(st,{AbortException:()=>_.AbortException,AnnotationEditorLayer:()=>x.AnnotationEditorLayer,AnnotationEditorParamsType:()=>_.AnnotationEditorParamsType,AnnotationEditorType:()=>_.AnnotationEditorType,AnnotationEditorUIManager:()=>v.AnnotationEditorUIManager,AnnotationLayer:()=>r.AnnotationLayer,AnnotationMode:()=>_.AnnotationMode,CMapCompressionType:()=>_.CMapCompressionType,ColorPicker:()=>d.ColorPicker,DOMSVGFactory:()=>P.DOMSVGFactory,DrawLayer:()=>l.DrawLayer,FeatureTest:()=>_.FeatureTest,GlobalWorkerOptions:()=>b.GlobalWorkerOptions,ImageKind:()=>_.ImageKind,InvalidPDFException:()=>_.InvalidPDFException,MissingPDFException:()=>_.MissingPDFException,OPS:()=>_.OPS,Outliner:()=>s.Outliner,PDFDataRangeTransport:()=>V.PDFDataRangeTransport,PDFDateString:()=>P.PDFDateString,PDFWorker:()=>V.PDFWorker,PasswordResponses:()=>_.PasswordResponses,PermissionFlag:()=>_.PermissionFlag,PixelsPerInch:()=>P.PixelsPerInch,RenderingCancelledException:()=>P.RenderingCancelledException,UnexpectedResponseException:()=>_.UnexpectedResponseException,Util:()=>_.Util,VerbosityLevel:()=>_.VerbosityLevel,XfaLayer:()=>g.XfaLayer,build:()=>V.build,createValidAbsoluteUrl:()=>_.createValidAbsoluteUrl,fetchData:()=>P.fetchData,getDocument:()=>V.getDocument,getFilenameFromUrl:()=>P.getFilenameFromUrl,getPdfFilenameFromUrl:()=>P.getPdfFilenameFromUrl,getXfaPageViewport:()=>P.getXfaPageViewport,isDataScheme:()=>P.isDataScheme,isPdfFile:()=>P.isPdfFile,noContextMenu:()=>P.noContextMenu,normalizeUnicode:()=>_.normalizeUnicode,renderTextLayer:()=>C.renderTextLayer,setLayerDimensions:()=>P.setLayerDimensions,shadow:()=>_.shadow,updateTextLayer:()=>C.updateTextLayer,version:()=>V.version});var _=$(292),V=$(831),P=$(419),C=$(814),x=$(731),v=$(830),r=$(976),d=$(259),l=$(47),b=$(164),s=$(61),g=$(284),t=w([V]);V=(t.then?(await t)():t)[0];const i="4.2.67",c="49b388101";z()}catch(i){z(i)}})},178:(ct,st,$)=>{$.d(st,{MessageHandler:()=>P});var w=$(292);const z={UNKNOWN:0,DATA:1,ERROR:2},_={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function V(C){switch(C instanceof Error||typeof C=="object"&&C!==null||(0,w.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),C.name){case"AbortException":return new w.AbortException(C.message);case"MissingPDFException":return new w.MissingPDFException(C.message);case"PasswordException":return new w.PasswordException(C.message,C.code);case"UnexpectedResponseException":return new w.UnexpectedResponseException(C.message,C.status);case"UnknownErrorException":return new w.UnknownErrorException(C.message,C.details);default:return new w.UnknownErrorException(C.message,C.toString())}}class P{constructor(x,v,r){this.sourceName=x,this.targetName=v,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=d=>{const l=d.data;if(l.targetName!==this.sourceName)return;if(l.stream){this.#e(l);return}if(l.callback){const s=l.callbackId,g=this.callbackCapabilities[s];if(!g)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],l.callback===z.DATA)g.resolve(l.data);else if(l.callback===z.ERROR)g.reject(V(l.reason));else throw new Error("Unexpected callback case");return}const b=this.actionHandler[l.action];if(!b)throw new Error(`Unknown action from worker: ${l.action}`);if(l.callbackId){const s=this.sourceName,g=l.sourceName;new Promise(function(t){t(b(l.data))}).then(function(t){r.postMessage({sourceName:s,targetName:g,callback:z.DATA,callbackId:l.callbackId,data:t})},function(t){r.postMessage({sourceName:s,targetName:g,callback:z.ERROR,callbackId:l.callbackId,reason:V(t)})});return}if(l.streamId){this.#t(l);return}b(l.data)},r.addEventListener("message",this._onComObjOnMessage)}on(x,v){const r=this.actionHandler;if(r[x])throw new Error(`There is already an actionName called "${x}"`);r[x]=v}send(x,v,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:x,data:v},r)}sendWithPromise(x,v,r){const d=this.callbackId++,l=Promise.withResolvers();this.callbackCapabilities[d]=l;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:x,callbackId:d,data:v},r)}catch(b){l.reject(b)}return l.promise}sendWithStream(x,v,r,d){const l=this.streamId++,b=this.sourceName,s=this.targetName,g=this.comObj;return new ReadableStream({start:t=>{const i=Promise.withResolvers();return this.streamControllers[l]={controller:t,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},g.postMessage({sourceName:b,targetName:s,action:x,streamId:l,data:v,desiredSize:t.desiredSize},d),i.promise},pull:t=>{const i=Promise.withResolvers();return this.streamControllers[l].pullCall=i,g.postMessage({sourceName:b,targetName:s,stream:_.PULL,streamId:l,desiredSize:t.desiredSize}),i.promise},cancel:t=>{(0,w.assert)(t instanceof Error,"cancel must have a valid reason");const i=Promise.withResolvers();return this.streamControllers[l].cancelCall=i,this.streamControllers[l].isClosed=!0,g.postMessage({sourceName:b,targetName:s,stream:_.CANCEL,streamId:l,reason:V(t)}),i.promise}},r)}#t(x){const v=x.streamId,r=this.sourceName,d=x.sourceName,l=this.comObj,b=this,s=this.actionHandler[x.action],g={enqueue(t,i=1,c){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=i,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),l.postMessage({sourceName:r,targetName:d,stream:_.ENQUEUE,streamId:v,chunk:t},c)},close(){this.isCancelled||(this.isCancelled=!0,l.postMessage({sourceName:r,targetName:d,stream:_.CLOSE,streamId:v}),delete b.streamSinks[v])},error(t){(0,w.assert)(t instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,l.postMessage({sourceName:r,targetName:d,stream:_.ERROR,streamId:v,reason:V(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:x.desiredSize,ready:null};g.sinkCapability.resolve(),g.ready=g.sinkCapability.promise,this.streamSinks[v]=g,new Promise(function(t){t(s(x.data,g))}).then(function(){l.postMessage({sourceName:r,targetName:d,stream:_.START_COMPLETE,streamId:v,success:!0})},function(t){l.postMessage({sourceName:r,targetName:d,stream:_.START_COMPLETE,streamId:v,reason:V(t)})})}#e(x){const v=x.streamId,r=this.sourceName,d=x.sourceName,l=this.comObj,b=this.streamControllers[v],s=this.streamSinks[v];switch(x.stream){case _.START_COMPLETE:x.success?b.startCall.resolve():b.startCall.reject(V(x.reason));break;case _.PULL_COMPLETE:x.success?b.pullCall.resolve():b.pullCall.reject(V(x.reason));break;case _.PULL:if(!s){l.postMessage({sourceName:r,targetName:d,stream:_.PULL_COMPLETE,streamId:v,success:!0});break}s.desiredSize<=0&&x.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=x.desiredSize,new Promise(function(g){g(s.onPull?.())}).then(function(){l.postMessage({sourceName:r,targetName:d,stream:_.PULL_COMPLETE,streamId:v,success:!0})},function(g){l.postMessage({sourceName:r,targetName:d,stream:_.PULL_COMPLETE,streamId:v,reason:V(g)})});break;case _.ENQUEUE:if((0,w.assert)(b,"enqueue should have stream controller"),b.isClosed)break;b.controller.enqueue(x.chunk);break;case _.CLOSE:if((0,w.assert)(b,"close should have stream controller"),b.isClosed)break;b.isClosed=!0,b.controller.close(),this.#s(b,v);break;case _.ERROR:(0,w.assert)(b,"error should have stream controller"),b.controller.error(V(x.reason)),this.#s(b,v);break;case _.CANCEL_COMPLETE:x.success?b.cancelCall.resolve():b.cancelCall.reject(V(x.reason)),this.#s(b,v);break;case _.CANCEL:if(!s)break;new Promise(function(g){g(s.onCancel?.(V(x.reason)))}).then(function(){l.postMessage({sourceName:r,targetName:d,stream:_.CANCEL_COMPLETE,streamId:v,success:!0})},function(g){l.postMessage({sourceName:r,targetName:d,stream:_.CANCEL_COMPLETE,streamId:v,reason:V(g)})}),s.sinkCapability.reject(V(x.reason)),s.isCancelled=!0,delete this.streamSinks[v];break;default:throw new Error("Unexpected stream case")}}async#s(x,v){await Promise.allSettled([x.startCall?.promise,x.pullCall?.promise,x.cancelCall?.promise]),delete this.streamControllers[v]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},651:(ct,st,$)=>{$.d(st,{MurmurHash3_64:()=>V});const w=3285377520,z=4294901760,_=65535;class V{constructor(C){this.h1=C?C&4294967295:w,this.h2=C?C&4294967295:w}update(C){let x,v;if(typeof C=="string"){x=new Uint8Array(C.length*2),v=0;for(let S=0,L=C.length;S<L;S++){const M=C.charCodeAt(S);M<=255?x[v++]=M:(x[v++]=M>>>8,x[v++]=M&255)}}else if(ArrayBuffer.isView(C))x=C.slice(),v=x.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=v>>2,d=v-r*4,l=new Uint32Array(x.buffer,0,r);let b=0,s=0,g=this.h1,t=this.h2;const i=3432918353,c=461845907,p=i&_,y=c&_;for(let S=0;S<r;S++)S&1?(b=l[S],b=b*i&z|b*p&_,b=b<<15|b>>>17,b=b*c&z|b*y&_,g^=b,g=g<<13|g>>>19,g=g*5+3864292196):(s=l[S],s=s*i&z|s*p&_,s=s<<15|s>>>17,s=s*c&z|s*y&_,t^=s,t=t<<13|t>>>19,t=t*5+3864292196);switch(b=0,d){case 3:b^=x[r*4+2]<<16;case 2:b^=x[r*4+1]<<8;case 1:b^=x[r*4],b=b*i&z|b*p&_,b=b<<15|b>>>17,b=b*c&z|b*y&_,r&1?g^=b:t^=b}this.h1=g,this.h2=t}hexdigest(){let C=this.h1,x=this.h2;return C^=x>>>1,C=C*3981806797&z|C*36045&_,x=x*4283543511&z|((x<<16|C>>>16)*2950163797&z)>>>16,C^=x>>>1,C=C*444984403&z|C*60499&_,x=x*3301882366&z|((x<<16|C>>>16)*3120437893&z)>>>16,C^=x>>>1,(C>>>0).toString(16).padStart(8,"0")+(x>>>0).toString(16).padStart(8,"0")}}},292:(ct,st,$)=>{$.d(st,{AbortException:()=>dt,AnnotationBorderStyleType:()=>t,AnnotationEditorParamsType:()=>d,AnnotationEditorPrefix:()=>v,AnnotationEditorType:()=>r,AnnotationMode:()=>x,AnnotationPrefix:()=>R,AnnotationType:()=>g,BaseException:()=>G,CMapCompressionType:()=>c,FONT_IDENTITY_MATRIX:()=>_,FeatureTest:()=>n,FontRenderOps:()=>D,FormatError:()=>pt,IDENTITY_MATRIX:()=>z,ImageKind:()=>s,InvalidPDFException:()=>Z,LINE_FACTOR:()=>P,MAX_IMAGE_SIZE_TO_CACHE:()=>V,MissingPDFException:()=>at,OPS:()=>p,PasswordException:()=>Y,PasswordResponses:()=>y,PermissionFlag:()=>l,RenderingIntentFlag:()=>C,TextRenderingMode:()=>b,UnexpectedResponseException:()=>lt,UnknownErrorException:()=>tt,Util:()=>o,VerbosityLevel:()=>i,assert:()=>q,bytesToString:()=>ot,createValidAbsoluteUrl:()=>j,getUuid:()=>k,getVerbosityLevel:()=>M,info:()=>O,isNodeJS:()=>w,normalizeUnicode:()=>E,objectFromMap:()=>m,setVerbosityLevel:()=>L,shadow:()=>H,string32:()=>et,stringToBytes:()=>ut,unreachable:()=>B,warn:()=>N});const w=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),z=[1,0,0,1,0,0],_=[.001,0,0,.001,0,0],V=1e7,P=1.35,C={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},x={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},v="pdfjs_internal_editor_",r={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},d={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},l={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},b={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},s={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},g={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},i={ERRORS:0,WARNINGS:1,INFOS:5},c={NONE:0,BINARY:1},p={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},y={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let S=i.WARNINGS;function L(I){Number.isInteger(I)&&(S=I)}function M(){return S}function O(I){S>=i.INFOS&&console.log(`Info: ${I}`)}function N(I){S>=i.WARNINGS&&console.log(`Warning: ${I}`)}function B(I){throw new Error(I)}function q(I,F){I||B(F)}function nt(I){switch(I?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function j(I,F=null,T=null){if(!I)return null;try{if(T&&typeof I=="string"&&(T.addDefaultProtocol&&I.startsWith("www.")&&I.match(/\./g)?.length>=2&&(I=`http://${I}`),T.tryConvertEncoding))try{I=a(I)}catch{}const U=F?new URL(I,F):new URL(I);if(nt(U))return U}catch{}return null}function H(I,F,T,U=!1){return Object.defineProperty(I,F,{value:T,enumerable:!U,configurable:!0,writable:!1}),T}const G=function(){function F(T,U){this.constructor===F&&B("Cannot initialize BaseException."),this.message=T,this.name=U}return F.prototype=new Error,F.constructor=F,F}();class Y extends G{constructor(F,T){super(F,"PasswordException"),this.code=T}}class tt extends G{constructor(F,T){super(F,"UnknownErrorException"),this.details=T}}class Z extends G{constructor(F){super(F,"InvalidPDFException")}}class at extends G{constructor(F){super(F,"MissingPDFException")}}class lt extends G{constructor(F,T){super(F,"UnexpectedResponseException"),this.status=T}}class pt extends G{constructor(F){super(F,"FormatError")}}class dt extends G{constructor(F){super(F,"AbortException")}}function ot(I){(typeof I!="object"||I?.length===void 0)&&B("Invalid argument for bytesToString");const F=I.length,T=8192;if(F<T)return String.fromCharCode.apply(null,I);const U=[];for(let K=0;K<F;K+=T){const X=Math.min(K+T,F),W=I.subarray(K,X);U.push(String.fromCharCode.apply(null,W))}return U.join("")}function ut(I){typeof I!="string"&&B("Invalid argument for stringToBytes");const F=I.length,T=new Uint8Array(F);for(let U=0;U<F;++U)T[U]=I.charCodeAt(U)&255;return T}function et(I){return String.fromCharCode(I>>24&255,I>>16&255,I>>8&255,I&255)}function m(I){const F=Object.create(null);for(const[T,U]of I)F[T]=U;return F}function h(){const I=new Uint8Array(4);return I[0]=1,new Uint32Array(I.buffer,0,1)[0]===1}function e(){try{return new Function(""),!0}catch{return!1}}class n{static get isLittleEndian(){return H(this,"isLittleEndian",h())}static get isEvalSupported(){return H(this,"isEvalSupported",e())}static get isOffscreenCanvasSupported(){return H(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?H(this,"platform",{isMac:navigator.platform.includes("Mac")}):H(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return H(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const f=Array.from(Array(256).keys(),I=>I.toString(16).padStart(2,"0"));class o{static makeHexColor(F,T,U){return`#${f[F]}${f[T]}${f[U]}`}static scaleMinMax(F,T){let U;F[0]?(F[0]<0&&(U=T[0],T[0]=T[2],T[2]=U),T[0]*=F[0],T[2]*=F[0],F[3]<0&&(U=T[1],T[1]=T[3],T[3]=U),T[1]*=F[3],T[3]*=F[3]):(U=T[0],T[0]=T[1],T[1]=U,U=T[2],T[2]=T[3],T[3]=U,F[1]<0&&(U=T[1],T[1]=T[3],T[3]=U),T[1]*=F[1],T[3]*=F[1],F[2]<0&&(U=T[0],T[0]=T[2],T[2]=U),T[0]*=F[2],T[2]*=F[2]),T[0]+=F[4],T[1]+=F[5],T[2]+=F[4],T[3]+=F[5]}static transform(F,T){return[F[0]*T[0]+F[2]*T[1],F[1]*T[0]+F[3]*T[1],F[0]*T[2]+F[2]*T[3],F[1]*T[2]+F[3]*T[3],F[0]*T[4]+F[2]*T[5]+F[4],F[1]*T[4]+F[3]*T[5]+F[5]]}static applyTransform(F,T){const U=F[0]*T[0]+F[1]*T[2]+T[4],K=F[0]*T[1]+F[1]*T[3]+T[5];return[U,K]}static applyInverseTransform(F,T){const U=T[0]*T[3]-T[1]*T[2],K=(F[0]*T[3]-F[1]*T[2]+T[2]*T[5]-T[4]*T[3])/U,X=(-F[0]*T[1]+F[1]*T[0]+T[4]*T[1]-T[5]*T[0])/U;return[K,X]}static getAxialAlignedBoundingBox(F,T){const U=this.applyTransform(F,T),K=this.applyTransform(F.slice(2,4),T),X=this.applyTransform([F[0],F[3]],T),W=this.applyTransform([F[2],F[1]],T);return[Math.min(U[0],K[0],X[0],W[0]),Math.min(U[1],K[1],X[1],W[1]),Math.max(U[0],K[0],X[0],W[0]),Math.max(U[1],K[1],X[1],W[1])]}static inverseTransform(F){const T=F[0]*F[3]-F[1]*F[2];return[F[3]/T,-F[1]/T,-F[2]/T,F[0]/T,(F[2]*F[5]-F[4]*F[3])/T,(F[4]*F[1]-F[5]*F[0])/T]}static singularValueDecompose2dScale(F){const T=[F[0],F[2],F[1],F[3]],U=F[0]*T[0]+F[1]*T[2],K=F[0]*T[1]+F[1]*T[3],X=F[2]*T[0]+F[3]*T[2],W=F[2]*T[1]+F[3]*T[3],rt=(U+W)/2,J=Math.sqrt((U+W)**2-4*(U*W-X*K))/2,Q=rt+J||1,it=rt-J||1;return[Math.sqrt(Q),Math.sqrt(it)]}static normalizeRect(F){const T=F.slice(0);return F[0]>F[2]&&(T[0]=F[2],T[2]=F[0]),F[1]>F[3]&&(T[1]=F[3],T[3]=F[1]),T}static intersect(F,T){const U=Math.max(Math.min(F[0],F[2]),Math.min(T[0],T[2])),K=Math.min(Math.max(F[0],F[2]),Math.max(T[0],T[2]));if(U>K)return null;const X=Math.max(Math.min(F[1],F[3]),Math.min(T[1],T[3])),W=Math.min(Math.max(F[1],F[3]),Math.max(T[1],T[3]));return X>W?null:[U,X,K,W]}static#t(F,T,U,K,X,W,rt,J,Q,it){if(Q<=0||Q>=1)return;const ht=1-Q,gt=Q*Q,bt=gt*Q,At=ht*(ht*(ht*F+3*Q*T)+3*gt*U)+bt*K,mt=ht*(ht*(ht*X+3*Q*W)+3*gt*rt)+bt*J;it[0]=Math.min(it[0],At),it[1]=Math.min(it[1],mt),it[2]=Math.max(it[2],At),it[3]=Math.max(it[3],mt)}static#e(F,T,U,K,X,W,rt,J,Q,it,ht,gt){if(Math.abs(Q)<1e-12){Math.abs(it)>=1e-12&&this.#t(F,T,U,K,X,W,rt,J,-ht/it,gt);return}const bt=it**2-4*ht*Q;if(bt<0)return;const At=Math.sqrt(bt),mt=2*Q;this.#t(F,T,U,K,X,W,rt,J,(-it+At)/mt,gt),this.#t(F,T,U,K,X,W,rt,J,(-it-At)/mt,gt)}static bezierBoundingBox(F,T,U,K,X,W,rt,J,Q){return Q?(Q[0]=Math.min(Q[0],F,rt),Q[1]=Math.min(Q[1],T,J),Q[2]=Math.max(Q[2],F,rt),Q[3]=Math.max(Q[3],T,J)):Q=[Math.min(F,rt),Math.min(T,J),Math.max(F,rt),Math.max(T,J)],this.#e(F,U,X,rt,T,K,W,J,3*(-F+3*(U-X)+rt),6*(F-2*U+X),3*(U-F),Q),this.#e(F,U,X,rt,T,K,W,J,3*(-T+3*(K-W)+J),6*(T-2*K+W),3*(K-T),Q),Q}}function a(I){return decodeURIComponent(escape(I))}let u=null,A=null;function E(I){return u||(u=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,A=new Map([["","t"]])),I.replaceAll(u,(F,T,U)=>T?T.normalize("NFKC"):A.get(U))}function k(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const I=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(I);else for(let F=0;F<32;F++)I[F]=Math.floor(Math.random()*255);return ot(I)}const R="pdfjs_internal_id_",D={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8}}},Vt={};function Pt(ct){var st=Vt[ct];if(st!==void 0)return st.exports;var $=Vt[ct]={exports:{}};return $t[ct]($,$.exports,Pt),$.exports}(()=>{var ct=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",st=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",$=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",w=_=>{_&&_.d<1&&(_.d=1,_.forEach(V=>V.r--),_.forEach(V=>V.r--?V.r++:V()))},z=_=>_.map(V=>{if(V!==null&&typeof V=="object"){if(V[ct])return V;if(V.then){var P=[];P.d=0,V.then(v=>{C[st]=v,w(P)},v=>{C[$]=v,w(P)});var C={};return C[ct]=v=>v(P),C}}var x={};return x[ct]=v=>{},x[st]=V,x});Pt.a=(_,V,P)=>{var C;P&&((C=[]).d=-1);var x=new Set,v=_.exports,r,d,l,b=new Promise((s,g)=>{l=g,d=s});b[st]=v,b[ct]=s=>(C&&s(C),x.forEach(s),b.catch(g=>{})),_.exports=b,V(s=>{r=z(s);var g,t=()=>r.map(c=>{if(c[$])throw c[$];return c[st]}),i=new Promise(c=>{g=()=>c(t),g.r=0;var p=y=>y!==C&&!x.has(y)&&(x.add(y),y&&!y.d&&(g.r++,y.push(g)));r.map(y=>y[ct](p))});return g.r?i:t()},s=>(s?l(b[$]=s):d(v),w(C))),C&&C.d<0&&(C.d=0)}})();Pt.d=(ct,st)=>{for(var $ in st)Pt.o(st,$)&&!Pt.o(ct,$)&&Object.defineProperty(ct,$,{enumerable:!0,get:st[$]})};Pt.o=(ct,st)=>Object.prototype.hasOwnProperty.call(ct,st);var ft=Pt(228);ft=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=ft);var Yt=ft.AbortException,Wt=ft.AnnotationEditorLayer,qt=ft.AnnotationEditorParamsType,Kt=ft.AnnotationEditorType,Qt=ft.AnnotationEditorUIManager,Jt=ft.AnnotationLayer,Zt=ft.AnnotationMode,te=ft.CMapCompressionType,ee=ft.ColorPicker,se=ft.DOMSVGFactory,ie=ft.DrawLayer,ne=ft.FeatureTest,re=ft.GlobalWorkerOptions,ae=ft.ImageKind,oe=ft.InvalidPDFException,he=ft.MissingPDFException,le=ft.OPS,ce=ft.Outliner,de=ft.PDFDataRangeTransport,ue=ft.PDFDateString,fe=ft.PDFWorker,pe=ft.PasswordResponses,ge=ft.PermissionFlag,me=ft.PixelsPerInch,be=ft.RenderingCancelledException,Ae=ft.UnexpectedResponseException,ve=ft.Util,ye=ft.VerbosityLevel,we=ft.XfaLayer,Se=ft.build,Ee=ft.createValidAbsoluteUrl,xe=ft.fetchData,Te=ft.getDocument,Ce=ft.getFilenameFromUrl,ke=ft.getPdfFilenameFromUrl,Re=ft.getXfaPageViewport,Fe=ft.isDataScheme,Pe=ft.isPdfFile,Le=ft.noContextMenu,Me=ft.normalizeUnicode,Ie=ft.renderTextLayer,_e=ft.setLayerDimensions,De=ft.shadow,Ne=ft.updateTextLayer,Oe=ft.version;export{Yt as AbortException,Wt as AnnotationEditorLayer,qt as AnnotationEditorParamsType,Kt as AnnotationEditorType,Qt as AnnotationEditorUIManager,Jt as AnnotationLayer,Zt as AnnotationMode,te as CMapCompressionType,ee as ColorPicker,se as DOMSVGFactory,ie as DrawLayer,ne as FeatureTest,re as GlobalWorkerOptions,ae as ImageKind,oe as InvalidPDFException,he as MissingPDFException,le as OPS,ce as Outliner,de as PDFDataRangeTransport,ue as PDFDateString,fe as PDFWorker,pe as PasswordResponses,ge as PermissionFlag,me as PixelsPerInch,be as RenderingCancelledException,Ae as UnexpectedResponseException,ve as Util,ye as VerbosityLevel,we as XfaLayer,Se as build,Ee as createValidAbsoluteUrl,xe as fetchData,Te as getDocument,Ce as getFilenameFromUrl,ke as getPdfFilenameFromUrl,Re as getXfaPageViewport,Fe as isDataScheme,Pe as isPdfFile,Le as noContextMenu,Me as normalizeUnicode,Ie as renderTextLayer,_e as setLayerDimensions,De as shadow,Ne as updateTextLayer,Oe as version};
